!function(root){function System(){this.stateKey="#",this.bootModule=null,this.modules={},this.onLoadQueue=[],this.notYetStarted=[],this.onModuleLoaded={},this.modulesHashes={},this.hashChecker=null,this.firstTime=!1,this.scopeServices=[],this.inited=!1,this.app=null}root.Galaxy=new System,Galaxy.GalaxySystem=System;var importedLibraries={};System.prototype.on=function(id,handler){this.app.on.call(this.app,id,handler)},System.prototype.start=function(){var _this=this;if(!_this.inited)throw new Error("Galaxy is not initialized");var detect=function(){if(_this.app.oldHash!==window.location.hash||_this.app.newListenerAdded){var oldParsedHash=_this.parseHash(_this.app.oldHash),parsedHash=_this.parseHash(window.location.hash);if(_this.setModuleHashValue(parsedHash.navigation,parsedHash.params,parsedHash.hash),oldParsedHash.params["#"]!==parsedHash.params["#"]){var temp=Galaxy.utility.clone(parsedHash.params);if(delete oldParsedHash.params["#"],delete temp["#"],JSON.stringify(temp)===JSON.stringify(oldParsedHash.params)&&"{}"!==JSON.stringify(temp))return Galaxy.app.setParam("#",parsedHash.params["#"]);Galaxy.modulesHashes[parsedHash.params["#"]]=parsedHash.hash}_this.app.hashChanged(parsedHash.navigation,parsedHash.params,parsedHash.hash,parsedHash.navigation[_this.app.stateKey]),_this.app.oldHash=parsedHash.hash,_this.app.newListenerAdded=!1}};detect(),clearInterval(this.hashChecker),this.hashChecker=setInterval(function(){detect()},50)},System.prototype.setModuleHashValue=function(navigation,parameters,hashValue,init){var nav=parameters["#"];return nav?Galaxy.modulesHashes[nav]&&Galaxy.app.activeModule!==Galaxy.modules["system/"+nav]&&Galaxy.app.activeModule&&"#"===Galaxy.app.activeModule.stateKey?Galaxy.modulesHashes[nav]:this.firstTime?Galaxy.modulesHashes[nav]?(Galaxy.modulesHashes[nav]&&(Galaxy.modulesHashes[nav]=hashValue),hashValue):(Galaxy.modulesHashes[nav]="#"+nav,Galaxy.modulesHashes[nav]):(Galaxy.modulesHashes[nav]=hashValue,this.firstTime=!0,Galaxy.modulesHashes[nav]):hashValue},System.prototype.parseHash=function(hash){var navigation={},params={},paramters=hash.replace(/^#([^&]*)\/?/gim,function(m,v){return navigation["#"]=v.split("/").filter(Boolean),params["#"]=v,""});return paramters.replace(/([^&]*)=([^&]*)/g,function(m,k,v){navigation[k]=v.split("/").filter(Boolean),params[k]=v}),{hash:hash,navigation:navigation,params:params}};var CONTENT_PARSERS={};CONTENT_PARSERS["text/html"]=function(content){for(var scripts=[],imports=[],raw=Galaxy.utility.parseHTML(content),html=raw.filter(function(e){if(e.nodeType===Node.ELEMENT_NODE){var scriptTags=Array.prototype.slice.call(e.querySelectorAll("script"));scriptTags.forEach(function(tag){scripts.push(tag.innerHTML),tag.parentNode.removeChild(tag)})}return e.tagName&&"script"===e.tagName.toLowerCase()?(scripts.push(e.innerHTML),!1):!e.tagName||"import"!==e.tagName.toLowerCase()||(imports.push({name:e.getAttribute("name"),from:e.getAttribute("from"),fresh:e.hasAttribute("fresh")}),!1)}),temp=document.createElement("div"),i=0,len=html.length;i<len;i++)html[i]=temp.appendChild(html[i]);document.getElementsByTagName("body")[0].appendChild(temp);var uiView=temp.querySelectorAll("ui-view,[ui-view]");return temp.parentNode.removeChild(temp),{html:html,imports:imports,views:uiView,script:scripts.join("\n")}};var javascriptParser=function(content){return{html:[],imports:[],views:[],script:content}};CONTENT_PARSERS["text/javascript"]=javascriptParser,CONTENT_PARSERS["application/javascript"]=javascriptParser,System.prototype.parseModuleContent=function(module,content,contentType){var parser=CONTENT_PARSERS[contentType.toLowerCase()];return parser?parser(content):(console.log("Resource is not a valid html file:",module.url,contentType),{html:[],imports:[],views:[],script:""})},System.prototype.compileModuleContent=function(module,moduleContent,invokers,onDone){function doneImporting(module,scope,imports,moduleContent){imports.splice(imports.indexOf(module.url)-1,1),0===imports.length&&onDone(module,scope,moduleContent)}var scopeUIViews={};Array.prototype.forEach.call(moduleContent.views,function(node,i){scopeUIViews[node.getAttribute("ui-view")||"view_"+i]=node});var scope=new Galaxy.GalaxyScope(module,moduleContent.html,scopeUIViews);module=new Galaxy.GalaxyModule(module,scope),Galaxy.modules[module.systemId]=module,module.scopeServices=[];var imports=Array.prototype.slice.call(moduleContent.imports,0),scriptContent=moduleContent.script||"";if(scriptContent=scriptContent.replace(/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm,""),moduleContent.script=scriptContent.replace(/Scope\.import\(['|"](.*)['|"]\)\;/gm,function(match,path){var query=path.match(/([\S]+)/gm);return imports.push({url:query[query.length-1],fresh:query.indexOf("new")!==-1}),"Scope.imports['"+query[query.length-1]+"']"}),module.services=module.services||{},imports.length){var importsCopy=imports.slice(0);return imports.forEach(function(item,i){var scopeService=Galaxy.getScopeService(item.url);if(scopeService){var scopeServiceHandler=scopeService.handler.call(null,scope,module);importedLibraries[item.url]={name:item.url,module:scopeServiceHandler.pre()},module.scopeServices.push(scopeServiceHandler),doneImporting(module,scope,importsCopy,moduleContent)}else importedLibraries[item.url]&&!item.fresh?doneImporting(module,scope,importsCopy,moduleContent):Galaxy.load({name:item.name,url:item.url,fresh:item.fresh,parentScope:scope,invokers:invokers,temporary:!0},function(loaded){doneImporting(module,scope,importsCopy,moduleContent)})}),!1}onDone(module,scope,moduleContent)},System.prototype.load=function(module,onDone){function moduleLoaded(module,scope,filtered){for(var item in importedLibraries)if(importedLibraries.hasOwnProperty(item)){var asset=importedLibraries[item];asset.module&&(scope.imports[asset.name]=asset.module)}var html=document.createDocumentFragment();scope.html.forEach(function(item){html.appendChild(item)}),scope.html=html,html._scope=scope;var currentComponentScripts=filtered.script;delete filtered.script,module.scope=scope;var componentScript=new Function("Scope",currentComponentScripts);componentScript.call(null,scope),module.scopeServices.forEach(function(item){item.post()}),delete module.scopeServices;for(var htmlNodes=[],i=0,len=html.childNodes.length;i<len;i++)htmlNodes.push(html.childNodes[i]);scope.html=htmlNodes,importedLibraries[module.url]?module.fresh?importedLibraries[module.url].module=scope.export:scope.imports[module.name]=importedLibraries[module.url].module:importedLibraries[module.url]={name:module.name||module.url,module:scope.export};var currentModule=Galaxy.modules[module.systemId];(module.temporary||scope._doNotRegister)&&(delete scope._doNotRegister,currentModule={id:module.id,scope:scope}),"function"==typeof Galaxy.onModuleLoaded[module.systemId]&&(Galaxy.onModuleLoaded[module.systemId].call(this,currentModule,scope.html),delete Galaxy.onModuleLoaded[module.systemId]),delete Galaxy.onLoadQueue[module.systemId]}var _this=this;module.id=module.id||"noid-"+(new Date).valueOf()+"-"+Math.round(performance.now()),module.systemId=module.parentScope?module.parentScope.systemId+"/"+module.id:module.id,Galaxy.onModuleLoaded[module.systemId]=onDone;var moduleExist=Galaxy.modules[module.systemId],invokers=[module.url];if(module.invokers){if(module.invokers.indexOf(module.url)!==-1)throw new Error("circular dependencies: \n"+module.invokers.join("\n")+"\nwanna load: "+module.url);invokers=module.invokers,invokers.push(module.url)}if(moduleExist){var ol=Galaxy.onModuleLoaded[module.systemId];return void("function"==typeof ol&&window.requestAnimationFrame(function(){ol.call(_this,moduleExist,moduleExist.scope.html),delete Galaxy.onModuleLoaded[module.systemId]}))}Galaxy.onLoadQueue[module.systemId]||(Galaxy.onLoadQueue[module.systemId]=!0,fetch(module.url+"?"+Galaxy.utility.serialize(module.params||{})).then(function(response){var contentType=response.headers.get("content-type").split(";")[0]||"text/html";response.text().then(function(htmlText){var parsedContent=_this.parseModuleContent(module,htmlText,contentType);window.requestAnimationFrame(function(){_this.compileModuleContent(module,parsedContent,invokers,moduleLoaded)})})}))},System.prototype.setURLHash=function(hash){hash=hash.replace(/^#\/?/gim,"");var navigation={},params={};hash.replace(/([^&]*)=([^&]*)/g,function(m,k,v){navigation[k]=v.split("/").filter(Boolean),params[k]=v})},System.prototype.getHashParam=function(key,hashName){var asNumber=parseFloat(this.app.params[key]);return asNumber||this.app.params[key]||null},System.prototype.getHashNav=function(key,hashName){return this.app.navigation[key]||[]},System.prototype.setHashParameters=function(parameters,replace,clean){var newParams=Galaxy.utility.clone(parameters);this.lastHashParams=parameters;var hashValue=window.location.hash,nav=parameters["#"];nav&&!Galaxy.modulesHashes[nav]?Galaxy.modulesHashes[nav]=hashValue="#"+nav:nav&&Galaxy.modulesHashes[nav]&&(hashValue=Galaxy.modulesHashes[nav]);var newHash="";hashValue=hashValue.replace(/^#([^&]*)\/?/gim,function(m,v){null!==newParams["#"]&&"undefined"!=typeof newParams["#"]?(newHash+="#"+newParams["#"]+"&",delete newParams["#"]):newParams.hasOwnProperty("#")||clean||(newHash+="#"+v+"&")}),hashValue.replace(/([^&]*)=([^&]*)/g,function(m,k,v){null!==newParams[k]&&"undefined"!=typeof newParams[k]?(newHash+=k+"="+newParams[k],newHash+="&",delete newParams[k]):newParams.hasOwnProperty(k)||clean||(newHash+=k+"="+v,newHash+="&")});for(var key in newParams)if(newParams.hasOwnProperty(key)){var value=newParams[key];key&&value&&(newHash+=key+"="+value+"&")}newHash=newHash.replace(/\&$/,""),replace?window.location.replace((""+window.location).split("#")[0]+newHash):window.location.hash=newHash.replace(/\&$/,"")},System.prototype.setParamIfNull=function(param,value){this.app.setParamIfNull(param,value)},System.prototype.getScopeService=function(name){return this.scopeServices.filter(function(service){return service.name===name})[0]},System.prototype.registerScopeService=function(name,handler){if("function"!=typeof handler)throw"scope service should be a function";this.scopeServices.push({name:name,handler:handler})},System.prototype.init=function(mods){if(this.inited)throw new Error("Galaxy is initialized already");this.bootModule=new Galaxy.GalaxyModule({id:"system",systemId:"system",domain:this},null),this.app=new Galaxy.GalaxyStateHandler(this.bootModule),this.app.oldHash=window.location.hash,this.app.params=this.parseHash(window.location.hash).params,this.app.init(mods),this.app.started=!0,this.inited=!0},System.prototype.boot=function(bootModule,onDone){var _this=this;_this.init(),bootModule.domain=this,bootModule.id="system",_this.load(bootModule,function(module){_this.bootModule=module,onDone.call(null,module),_this.start(),_this.bootModule.start(),_this.app=_this.bootModule.services["galaxy/scope-state"]||_this.app})}}(this),function(galaxy){function GalaxyUI(){}galaxy.GalaxyUI=GalaxyUI,galaxy.ui=new galaxy.GalaxyUI,GalaxyUI.prototype.setContent=function(parent,nodes){var parentNode=parent;if("string"==typeof parent&&(parentNode=document.querySelector(parent)),!parentNode)throw new Error("parent element can not be null: "+parent+"\r\n try to set ui-view on your target element and refrence it via Scope.views");var children=Array.prototype.slice.call(parentNode.childNodes);children.forEach(function(child){parentNode.removeChild(child)}),nodes.hasOwnProperty("length")||(nodes=[nodes]);for(var i=0,len=nodes.length;i<len;i++){var item=nodes[i];parentNode.appendChild(item)}},GalaxyUI.prototype.clone=function(obj){var target={};for(var i in obj)obj.hasOwnProperty(i)&&(target[i]=obj[i]);return target},GalaxyUI.prototype.getCenterPoint=function(rect){document.activeElement.getBoundingClientRect();return{left:rect.left+rect.width/2,top:rect.top+rect.height/2}},GalaxyUI.prototype.utility={layoutPositions:["fixed","absolute","relative"]},GalaxyUI.prototype.utility.toTreeObject=function(element){var jsTree={_:element,_children:[]},indexIndicator={};for(var index in element.childNodes){var node=element.childNodes[index];if(node.nodeType===Node.ELEMENT_NODE){var key=node.nodeName.toLowerCase();indexIndicator[key]?(indexIndicator[key]++,jsTree[key+"_"+indexIndicator[key]]=galaxy.ui.utility.toTreeObject(node)):(indexIndicator[key]=1,jsTree[node.nodeName.toLowerCase()]=galaxy.ui.utility.toTreeObject(node)),jsTree._children.push(node)}}return jsTree},GalaxyUI.prototype.utility.getContentHeight=function(element,withPaddings){var height=0,children=element.children,elementCSS=window.getComputedStyle(element,null);GalaxyUI.prototype.utility.layoutPositions.indexOf(elementCSS.position)===-1&&(element.style.position="relative");for(var index=0,length=children.length;index<length;index++)if(!children[index].__ui_neutral){var cs=window.getComputedStyle(children[index],null);if("absolute"!==cs.position){var dimension=children[index].offsetTop+children[index].offsetHeight,marginBottom=parseInt(cs.marginBottom||0);height=dimension+marginBottom>height?dimension+marginBottom:height}}return withPaddings&&(height+=parseInt(window.getComputedStyle(element).paddingBottom||0)),element.style.position="",height},GalaxyUI.prototype.utility.findParent=function(node,name){var parent=node.parentNode;return parent?parent.nodeName.toUpperCase()===name.toUpperCase()?parent:GalaxyUI.prototype.utility.findParent(parent,name):null},GalaxyUI.prototype.animations={}}(Galaxy),function(self){"use strict";function normalizeName(name){if("string"!=typeof name&&(name=String(name)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(name))throw new TypeError("Invalid character in header field name");return name.toLowerCase()}function normalizeValue(value){return"string"!=typeof value&&(value=String(value)),value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return support.iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach(function(value,name){this.append(name,value)},this):Array.isArray(headers)?headers.forEach(function(header){this.append(header[0],header[1])},this):headers&&Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}function consumed(body){return body.bodyUsed?Promise.reject(new TypeError("Already read")):void(body.bodyUsed=!0)}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function readBlobAsText(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsText(blob),promise}function readArrayBufferAsText(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){if(this._bodyInit=body,body)if("string"==typeof body)this._bodyText=body;else if(support.blob&&Blob.prototype.isPrototypeOf(body))this._bodyBlob=body;else if(support.formData&&FormData.prototype.isPrototypeOf(body))this._bodyFormData=body;else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body))this._bodyText=body.toString();else if(support.arrayBuffer&&support.blob&&isDataView(body))this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!support.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(body)&&!isArrayBufferView(body))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=bufferClone(body)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof body?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed)throw new TypeError("Already read");this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers(input.headers)),this.method=input.method,this.mode=input.mode,body||null==input._bodyInit||(body=input._bodyInit,input.bodyUsed=!0)}else this.url=String(input);if(this.credentials=options.credentials||this.credentials||"omit",!options.headers&&this.headers||(this.headers=new Headers(options.headers)),this.method=normalizeMethod(options.method||this.method||"GET"),this.mode=options.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(body)}function decode(body){var form=new FormData;return body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("="),name=split.shift().replace(/\+/g," "),value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}}),form}function parseHeaders(rawHeaders){var headers=new Headers,preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/," ");return preProcessedHeaders.split(/\r?\n/).forEach(function(line){var parts=line.split(":"),key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}}),headers}function Response(bodyInit,options){options||(options={}),this.type="default",this.status="status"in options?options.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in options?options.statusText:"OK",this.headers=new Headers(options.headers),this.url=options.url||"",this._initBody(bodyInit)}if(!self.fetch){var support={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isDataView=function(obj){return obj&&DataView.prototype.isPrototypeOf(obj)},isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+","+value:value},Headers.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach(function(value,name){items.push(name)}),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach(function(value){items.push(value)}),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach(function(value,name){items.push([name,value])}),iteratorFor(items)},support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:""});return response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1)throw new RangeError("Invalid status code");return new Response(null,{status:status,headers:{location:url}})},self.Headers=Headers,self.Request=Request,self.Response=Response,self.fetch=function(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init),xhr=new XMLHttpRequest;xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))},xhr.onerror=function(){reject(new TypeError("Network request failed"))},xhr.ontimeout=function(){reject(new TypeError("Network request failed"))},xhr.open(request.method,request.url,!0),"include"===request.credentials&&(xhr.withCredentials=!0),"responseType"in xhr&&support.blob&&(xhr.responseType="blob"),request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)}),xhr.send("undefined"==typeof request._bodyInit?null:request._bodyInit)})},self.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),function(){function Helpers(){}Galaxy.GalaxyHelpers=Helpers,Galaxy.helpers=new Galaxy.GalaxyHelpers}(),function(){function GalaxyModule(module,scope){this.id=module.id,this.systemId=module.systemId,this.url=module.url||null,this.services=module.services||{},this.domain=module.domain,this.scope=scope}Galaxy.GalaxyModule=GalaxyModule,GalaxyModule.prototype.init=function(){for(var key in this.services){var service=this.services[key];"function"==typeof service.onModuleInit&&service.onModuleInit()}},GalaxyModule.prototype.start=function(){for(var key in this.services){var service=this.services[key];"function"==typeof service.onModuleStart&&service.onModuleStart()}}}(),function(root){function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;return 0===self._state?void self._deferreds.push(deferred):(self._handled=!0,void Promise._immediateFn(function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(1===self._state?resolve:reject)(deferred.promise,self._value);var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}))}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(bind(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn(function(){self._handled||Promise._unhandledRejectionFn(self._value)});for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn(function(value){done||(done=!0,resolve(self,value))},function(reason){done||(done=!0,reject(self,reason))})}catch(ex){if(done)return;done=!0,reject(self,ex)}}var setTimeoutFunc=setTimeout;Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0===--remaining&&resolve(args)}catch(ex){reject(ex)}}if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise._immediateFn="function"==typeof setImmediate&&function(fn){setImmediate(fn)}||function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function(fn){Promise._unhandledRejectionFn=fn},"undefined"!=typeof module&&module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(this),function(){function GalaxyScope(module,html,views){this.systemId=module.systemId,this.parentScope=module.parentScope||null,this.html=html,this.views=views,this.imports={}}Galaxy.GalaxyScope=GalaxyScope,GalaxyScope.prototype.loadModuleInto=function(module,view){module.parentScope=this,Galaxy.load(module,function(module){Galaxy.ui.setContent(view,module.scope.html),module.start()})}}(),function(){function GalaxyStateHandler(module){this.module=module,this.module.services["galaxy/scope-state"]=this,this.id=module.id,this.systemId=module.systemId,this.domain=module.domain,this.inited=!1,this.started=!1,this.active=!1,this.newListenerAdded=!1,this.stateKey="#",this.navigation={},this.params={},this.hashListeners=[],this.globalHashListeners=[],this.data={},this.html="",this.oldHash="",this.onInit=null,this.onStart=null,this.onStop=null}Galaxy.GalaxyStateHandler=GalaxyStateHandler,GalaxyStateHandler.prototype.onModuleStart=function(){this.start()},GalaxyStateHandler.prototype.init=function(){this.inited=!0,this.trigger("onInit")},GalaxyStateHandler.prototype.start=function(){this.started=!0,this.active=!0,this.trigger("onStart");var newNav=Galaxy.utility.extend(!0,{},this.domain.app.navigation),st="system/"+this.domain.app.params[this.stateKey],napPath=0===st.indexOf(this.systemId)?st.substr(this.systemId.length).split("/").filter(Boolean):[];newNav[this.stateKey]=napPath;this.domain.app.params;this.navigation={},this.params={};var index=this.domain.notYetStarted.indexOf(this.systemId);index>-1&&this.domain.notYetStarted.splice(index,1),this.domain.app.newListenerAdded=!0},GalaxyStateHandler.prototype.dispose=function(){},GalaxyStateHandler.prototype.on=function(id,handler){this.hashListeners.push({id:id,handler:handler}),this.newListenerAdded=!0},GalaxyStateHandler.prototype.onGlobal=function(id,handler){this.globalHashListeners.push({id:id,handler:handler})},GalaxyStateHandler.prototype.getNav=function(key){return this.domain.getHashNav(key)},GalaxyStateHandler.prototype.setNav=function(value,key){var pathKey=key||"#",pathValue=null===value||void 0===value?"":value;this.setParam(pathKey,(this.systemId+"/").replace("system/","")+pathValue)},GalaxyStateHandler.prototype.getParam=function(key){return this.domain.getHashParam(key)},GalaxyStateHandler.prototype.setParam=function(key,value,replace){var paramObject={};paramObject[key]=value,this.domain.setHashParameters(paramObject,replace)},GalaxyStateHandler.prototype.setParamIfNull=function(param,value){if(!this.domain.getHashParam(param)){var paramObject={};paramObject[param]=value,this.domain.setHashParameters(paramObject,!0)}},GalaxyStateHandler.prototype.setParamIfNot=function(param,value){if(this.domain.getHashParam(param)!==value){var paramObject={};paramObject[param]=value,this.domain.setHashParameters(paramObject,!0)}},GalaxyStateHandler.prototype.trigger=function(event,args){"function"==typeof this[event]&&this[event].apply(this,args)},GalaxyStateHandler.prototype.hashChanged=function(navigation,params,hashValue,fullNav){var _this=this;if(_this.started!==!1){var moduleNavigation=navigation,fullNavPath=params[_this.stateKey];for(var id in this.domain.modules){var module=this.domain.modules[id],service=module.services["galaxy/scope-state"]||{};0!==("system/"+fullNavPath).indexOf(module.systemId)&&service.active?(service.trigger("onStop"),service.active=!1):module.systemId==="system/"+fullNavPath&&service.active&&(this.domain.app.activeModule=service)}this.hashHandler.call(this,navigation,params);var allNavigation=Galaxy.utility.extend({},this.navigation,navigation),tempNav=_this.navigation;if(_this.navigation=navigation,_this.params=params,this.domain.app.activeModule&&this.active&&this.domain.app.activeModule.systemId===_this.systemId){for(var id in allNavigation)if(allNavigation.hasOwnProperty(id)){var stateHandlers=_this.hashListeners.filter(function(item){return item.id===id});if(stateHandlers.length){if(tempNav[id]){var currentKeyValue=tempNav[id].join("/");if(navigation[id]&&currentKeyValue===navigation[id].join("/"))continue}var parameters=[];parameters.push(null);var navigationValue=navigation[id];if(navigationValue){parameters[0]=navigationValue.join("/");for(var i=0;i<navigationValue.length;i++){var arg=Galaxy.utility.isNumber(navigationValue[i])?parseFloat(navigationValue[i]):navigationValue[i];parameters.push(arg)}}stateHandlers.forEach(function(item){item.handler.apply(_this,parameters)})}}}else if(this.active){var keyStateHandlers=_this.hashListeners.filter(function(item){return item.id===_this.stateKey}),stateKeyNavigationValue=navigation[_this.stateKey];if(keyStateHandlers.length&&stateKeyNavigationValue){var currentKeyValue=tempNav[_this.stateKey]?tempNav[_this.stateKey].join("/"):[];if(currentKeyValue!==stateKeyNavigationValue.join("/")){var args=[];args.push(stateKeyNavigationValue);
for(var i=0,len=stateKeyNavigationValue.length;i<len;++i)args.push(stateKeyNavigationValue[i]);keyStateHandlers.forEach(function(item){item.handler.apply(_this,args)})}}this.domain.app.activeModule=null}for(var id in allNavigation)if(allNavigation.hasOwnProperty(id)){var globalStateHandlers=_this.globalHashListeners.filter(function(item){return item.id===id});if(globalStateHandlers.length){if(tempNav[id]){var currentKeyValue=tempNav[id].join("/");if(navigation[id]&&currentKeyValue===navigation[id].join("/"))continue}if(parameters=[],parameters.push(null),navigationValue=navigation[id]){parameters[0]=navigationValue.join("/");for(var i=0;i<navigationValue.length;i++){var arg=Galaxy.utility.isNumber(navigationValue[i])?parseFloat(navigationValue[i]):navigationValue[i];parameters.push(arg)}}globalStateHandlers.forEach(function(item){item.handler.apply(_this,parameters)})}}if(!this.domain.app.activeModule&&navigation[_this.stateKey]&&navigation[_this.stateKey].length)for(var path="system",i=0,len=navigation[_this.stateKey].length;i<len;i++)path+="/"+navigation[_this.stateKey][i],_this.domain.modules[path]&&_this.domain.modules[path].services["galaxy/scope-state"]&&(_this.domain.app.activeModule=_this.domain.modules[path].services["galaxy/scope-state"],_this.domain.app.activeModule.active=!0,moduleNavigation=Galaxy.utility.extend(!0,{},navigation),moduleNavigation[_this.stateKey]=fullNav.slice(_this.domain.app.activeModule.systemId.split("/").length-1),_this.domain.app.activeModule.hashChanged(moduleNavigation,this.params,hashValue,fullNav));else this.domain.app.activeModule&&this.domain.app.activeModule.systemId===this.systemId+"/"+navigation[this.stateKey][0]&&(moduleNavigation=Galaxy.utility.extend(!0,{},navigation),moduleNavigation[_this.stateKey]=fullNav.slice(_this.domain.app.activeModule.systemId.split("/").length-1),_this.domain.app.activeModule.hashChanged(moduleNavigation,this.params,hashValue,fullNav))}},GalaxyStateHandler.prototype.loadModule=function(module,onDone){Galaxy.loadModule(module,onDone,this.scope)},GalaxyStateHandler.prototype.hashHandler=function(nav,params){}}(),function(galaxy){galaxy.registerScopeService("galaxy/scope-state",function(scope,module){module.domain=module.domain||Galaxy;var stateModule=module.services["galaxy/scope-state"]||new Galaxy.GalaxyStateHandler(module);return{pre:function(){return stateModule},post:function(){stateModule.init()}}})}(Galaxy),function(galaxy){galaxy.utility={clone:function(source){if(null===source||"object"!=typeof source)return source;var copy=source.constructor();for(var property in source)source.hasOwnProperty(property)&&(copy[property]=source[property]);return copy},extend:function(out){var isDeep=!1;out===!0&&(isDeep=!0,out={});for(var i=1;i<arguments.length;i++){var obj=arguments[i];if(obj)for(var key in obj)obj.hasOwnProperty(key)&&("object"==typeof obj[key]&&isDeep?Array.isArray(obj[key])?out[key]=galaxy.utility.extend([],obj[key]):out[key]=galaxy.utility.extend({},obj[key]):out[key]=obj[key])}return out},installModuleStateHandlers:function(module,states){for(var state in states)module.on(state,states[state])},getProperty:function(obj,propString){if(!propString)return obj;for(var prop,props=propString.split("."),i=0,iLen=props.length-1;i<iLen;i++){prop=props[i];var candidate=obj[prop];if(void 0===candidate)break;obj=candidate}return obj[props[i]]},isHTML:function(str){var element=document.createElement("div");element.innerHTML=str;for(var c=element.childNodes,i=c.length;i--;)if(1===c[i].nodeType)return!0;return!1},decorate:function(hostObject){return{with:function(behavior){return Array.prototype.unshift.call(arguments,hostObject),behavior.apply(null,arguments)}}},withHost:function(hostObject){return{behave:function(behavior){if("function"!=typeof behavior)throw"Behavior is not a function: "+behavior;return function(){return Array.prototype.unshift.call(arguments,hostObject),behavior.apply(null,arguments)}}}},isNumber:function(o){return!isNaN(o-0)&&null!==o&&""!==o&&o!==!1},parseHTML:function(htmlString){var container=document.createElement("div");return container.style.position="absolute",container.style.opacity="0",container.innerHTML=htmlString,document.querySelector("body").appendChild(container),document.querySelector("body").removeChild(container),Array.prototype.slice.call(container.childNodes)},serialize:function(obj,prefix){var p,str=[];for(p in obj)if(obj.hasOwnProperty(p)){var k=prefix?prefix+"["+p+"]":p,v=obj[p];str.push(null!==v&&"object"==typeof v?serialize(v,k):encodeURIComponent(k)+"="+encodeURIComponent(v))}return str.join("&")}}}(Galaxy);