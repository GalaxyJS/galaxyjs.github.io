{"version":3,"file":"galaxy.js","sources":["../src/constants.js","../src/observer.js","../src/properties/data.reactive.js","../src/properties/text.property.js","../src/properties/animations.property.js","../src/properties/checked.property.js","../src/properties/class.reactive.js","../src/properties/disabled.property.js","../src/properties/if.reactive.js","../src/uri.js","../src/properties/module.reactive.js","../src/properties/on.property.js","../src/array-change.js","../src/properties/repeat.reactive.js","../src/properties/selected.property.js","../src/properties/style.reactive.js","../src/properties/value.property.js","../src/properties/visible.reactive.js","../src/view-node.js","../src/setters/prop.js","../src/setters/attr.js","../src/setters/reactive.js","../src/reactive-data.js","../src/view.js","../src/router.js","../src/utils.js","../src/scope.js","../src/module.js","../src/core.js","../main.js"],"sourcesContent":["/**\n *\n * @typedef {Object} Galaxy.View.BlueprintProperty\n * @property {string} [key]\n * @property {'attr'|'prop'|'reactive'|'event'|'none'} [type]\n * @property {Function} [getConfig]\n * @property {Function} [install]\n * @property {Function} [beforeActivate]\n * @property {Function} [getSetter]\n * @property {Function} [update]\n */\n/**\n *\n * @type {{[property: string]: Galaxy.View.BlueprintProperty}}\n */\nexport const NODE_BLUEPRINT_PROPERTY_MAP = {\n  tag: {\n    type: 'none'\n  },\n  node: {\n    type: 'none'\n  },\n  props: {\n    type: 'none'\n  },\n  children: {\n    type: 'none'\n  },\n  data_3: {\n    type: 'none',\n    key: 'data',\n  },\n  data_8: {\n    type: 'none',\n    key: 'data',\n  },\n  html: {\n    type: 'prop',\n    key: 'innerHTML'\n  },\n  onchange: {\n    type: 'event'\n  },\n  onclick: {\n    type: 'event'\n  },\n  ondblclick: {\n    type: 'event'\n  },\n  onmouseover: {\n    type: 'event'\n  },\n  onmouseout: {\n    type: 'event'\n  },\n  onkeydown: {\n    type: 'event'\n  },\n  onkeypress: {\n    type: 'event'\n  },\n  onkeyup: {\n    type: 'event'\n  },\n  onmousedown: {\n    type: 'event'\n  },\n  onmouseup: {\n    type: 'event'\n  },\n  onload: {\n    type: 'event'\n  },\n  onabort: {\n    type: 'event'\n  },\n  onerror: {\n    type: 'event'\n  },\n  onfocus: {\n    type: 'event'\n  },\n  onblur: {\n    type: 'event'\n  },\n  onreset: {\n    type: 'event'\n  },\n  onsubmit: {\n    type: 'event'\n  },\n};\n\n// Extracted from MDN\nexport const VALID_TAG_NAMES = [\n  'text',\n  'comment',\n  //\n  'a',\n  'abbr',\n  'acronym',\n  'address',\n  'applet',\n  'area',\n  'article',\n  'aside',\n  'audio',\n  'b',\n  'base',\n  'basefont',\n  'bdi',\n  'bdo',\n  'bgsound',\n  'big',\n  'blink',\n  'blockquote',\n  'body',\n  'br',\n  'button',\n  'canvas',\n  'caption',\n  'center',\n  'cite',\n  'code',\n  'col',\n  'colgroup',\n  'content',\n  'data',\n  'datalist',\n  'dd',\n  'decorator',\n  'del',\n  'details',\n  'dfn',\n  'dir',\n  'div',\n  'dl',\n  'dt',\n  'element',\n  'em',\n  'embed',\n  'fieldset',\n  'figcaption',\n  'figure',\n  'font',\n  'footer',\n  'form',\n  'frame',\n  'frameset',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'head',\n  'header',\n  'hgroup',\n  'hr',\n  'html',\n  'i',\n  'iframe',\n  'img',\n  'input',\n  'ins',\n  'isindex',\n  'kbd',\n  'keygen',\n  'label',\n  'legend',\n  'li',\n  'link',\n  'listing',\n  'main',\n  'map',\n  'mark',\n  'marquee',\n  'menu',\n  'menuitem',\n  'meta',\n  'meter',\n  'nav',\n  'nobr',\n  'noframes',\n  'noscript',\n  'object',\n  'ol',\n  'optgroup',\n  'option',\n  'output',\n  'p',\n  'param',\n  'plaintext',\n  'pre',\n  'progress',\n  'q',\n  'rp',\n  'rt',\n  'ruby',\n  's',\n  'samp',\n  'script',\n  'section',\n  'select',\n  'shadow',\n  'small',\n  'source',\n  'spacer',\n  'span',\n  'strike',\n  'strong',\n  'style',\n  'sub',\n  'summary',\n  'sup',\n  'table',\n  'tbody',\n  'td',\n  'template',\n  'textarea',\n  'tfoot',\n  'th',\n  'thead',\n  'time',\n  'title',\n  'tr',\n  'track',\n  'tt',\n  'u',\n  'ul',\n  'var',\n  'video',\n  'wbr',\n  'xmp'\n];\n","import { def_prop } from './utils';\n\nObserver.notify = function (obj, key, value) {\n  const observers = obj.__observers__;\n\n  if (observers !== undefined) {\n    observers.forEach(function (observer) {\n      observer.notify(key, value);\n    });\n  }\n};\n\n/**\n *\n * @param {Object} context\n * @constructor\n * @memberOf Galaxy\n */\nfunction Observer(context) {\n  this.context = context;\n  this.subjectsActions = {};\n  this.allSubjectAction = [];\n\n  const __observers__ = '__observers__';\n  if (!this.context.hasOwnProperty(__observers__)) {\n    def_prop(context, __observers__, {\n      value: [],\n      writable: true,\n      configurable: true\n    });\n  }\n\n  this.context[__observers__].push(this);\n}\n\nObserver.prototype = {\n  remove: function () {\n    const observers = this.context.__observers__;\n    const index = observers.indexOf(this);\n    if (index !== -1) {\n      observers.splice(index, 1);\n    }\n  },\n  /**\n   *\n   * @param {string} key\n   * @param value\n   */\n  notify: function (key, value) {\n    const _this = this;\n\n    if (_this.subjectsActions.hasOwnProperty(key)) {\n      _this.subjectsActions[key].call(_this.context, value);\n    }\n\n    _this.allSubjectAction.forEach(function (action) {\n      action.call(_this.context, key, value);\n    });\n  },\n  /**\n   *\n   * @param subject\n   * @param action\n   */\n  on: function (subject, action) {\n    this.subjectsActions[subject] = action;\n  },\n  /**\n   *\n   * @param {Function} action\n   */\n  onAll: function (action) {\n    if (this.allSubjectAction.indexOf(action) === -1) {\n      this.allSubjectAction.push(action);\n    }\n  }\n};\n\nexport default Observer;\n","import Observer from '../observer.js';\nimport { bind_subjects_to_data } from '../view.js';\n\nfunction apply_node_dataset(node, value) {\n  if (typeof value === 'object' && value !== null) {\n    const stringifyValue = {};\n    for (const key in value) {\n      const val = value[key];\n      if (typeof val === 'object') {\n        stringifyValue[key] = JSON.stringify(val);\n      } else {\n        stringifyValue[key] = val;\n      }\n    }\n    Object.assign(node.dataset, stringifyValue);\n  } else {\n    node.dataset = null;\n  }\n}\n\n/**\n *\n * @type {Galaxy.View.BlueprintProperty}\n */\nexport const data_property = {\n  type: 'reactive',\n  key: 'data',\n  getConfig: function (scope, value) {\n    if (value !== null && (typeof value !== 'object' || value instanceof Array)) {\n      throw new Error('data property should be an object with explicits keys:\\n' + JSON.stringify(this.blueprint, null, '  '));\n    }\n\n    return {\n      reactiveData: null,\n      subjects: value,\n      scope: scope\n    };\n  },\n  install: function (config) {\n    if (config.scope.data === config.subjects) {\n      throw new Error('It is not allowed to use Scope.data as data value');\n    }\n\n    if (!this.blueprint.module) {\n      config.reactiveData = bind_subjects_to_data(this, config.subjects, config.scope, true);\n      const observer = new Observer(config.reactiveData);\n      observer.onAll(() => {\n        apply_node_dataset(this.node, config.reactiveData);\n      });\n\n      return;\n    }\n\n    Object.assign(this.data, config.subjects);\n    return false;\n  },\n  update: function (config, value, expression) {\n    if (expression) {\n      value = expression();\n    }\n\n    if (config.subjects === value) {\n      value = config.reactiveData;\n    }\n\n    apply_node_dataset(this.node, value);\n  },\n};\n","export const text_3_property = {\n  type: 'prop',\n  key: 'nodeValue'\n};\nexport const text_8_property = {\n  type: 'prop',\n  key: 'nodeValue'\n};\nexport const text_property = {\n  type: 'prop',\n  key: 'text',\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param value\n   */\n  update: function (viewNode, value) {\n    let textValue = typeof value === 'undefined' || value === null ? '' : value;\n    if (textValue instanceof Object) {\n      textValue = JSON.stringify(textValue);\n    }\n\n    const nativeNode = viewNode.node;\n    const textNode = nativeNode['<>text'];\n    if (textNode) {\n      textNode.nodeValue = textValue;\n    } else {\n      const tn = nativeNode['<>text'] = document.createTextNode(textValue);\n      nativeNode.insertBefore(tn, nativeNode.firstChild);\n    }\n  }\n};\n","import { create_in_next_frame, destroy_in_next_frame } from '../view.js';\nimport { EMPTY_CALL } from '../utils.js';\n\n/**\n *\n * @type {Galaxy.View.BlueprintProperty}\n */\nexport let animations_property;\nexport let setupTimeline;\n\nif (!window.gsap) {\n  setupTimeline = function () {};\n  animations_property = {\n    type: 'prop',\n    key: 'animations',\n    /**\n     *\n     * @param {Galaxy.ViewNode} viewNode\n     * @param animationDescriptions\n     */\n    update: function (viewNode, animationDescriptions) {\n      if (animationDescriptions.enter && animationDescriptions.enter.to.onComplete) {\n        viewNode.processEnterAnimation = animationDescriptions.enter.to.onComplete;\n      }\n      viewNode.processLeaveAnimation = (onComplete) => {\n        onComplete();\n      };\n    }\n  };\n\n  window.gsap = {\n    to: function (node, props) {\n      return requestAnimationFrame(() => {\n        if (typeof node === 'string') {\n          node = document.querySelector(node);\n        }\n\n        const style = node.style;\n        if (style) {\n          const keys = Object.keys(props);\n          for (let i = 0, len = keys.length; i < len; i++) {\n            const key = keys[i];\n            const value = props[key];\n            switch (key) {\n              case 'duration':\n              case 'ease':\n                break;\n\n              case 'opacity':\n              case 'z-index':\n                style.setProperty(key, value);\n                break;\n\n              case 'scrollTo':\n                node.scrollTop = typeof value.y === 'string' ? document.querySelector(value.y).offsetTop : value.y;\n                node.scrollLeft = typeof value.x === 'string' ? document.querySelector(value.x).offsetLeft : value.x;\n                break;\n\n              default:\n                style.setProperty(key, typeof value === 'number' && value !== 0 ? value + 'px' : value);\n            }\n          }\n        } else {\n          Object.assign(node, props);\n        }\n      });\n    },\n  };\n\n  console.info('%cIn order to activate animations, load GSAP - GreenSock', 'color: yellowgreen; font-weight: bold;');\n  console.info('%cYou can implement most common animations by loading the following resources before galaxy.js', 'color: yellowgreen;');\n  console.info('https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js');\n  console.info('https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/ScrollToPlugin.min.js');\n  console.info('https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/EasePack.min.js\\n\\n');\n} else {\n\n  function has_parent_enter_animation(viewNode) {\n    if (!viewNode.parent) return false;\n\n    const parent = viewNode.parent;\n    if (parent.blueprint.animations && parent.blueprint.animations.enter && gsap.getTweensOf(parent.node).length) {\n      return true;\n    }\n\n    return has_parent_enter_animation(viewNode.parent);\n  }\n\n  const document_body = document.body;\n\n  animations_property = {\n    type: 'prop',\n    key: 'animations',\n    /**\n     *\n     * @param {Galaxy.ViewNode} viewNode\n     * @param animations\n     */\n    update: function (viewNode, animations) {\n      if (viewNode.virtual || !animations) {\n        return;\n      }\n\n      const enter = animations.enter;\n      if (enter) {\n        viewNode.processEnterAnimation = function () {\n          process_enter_animation(this, enter);\n        };\n      }\n\n      const leave = animations.leave;\n      if (leave) {\n        // We need an empty enter animation in order to have a proper behavior for if\n        if (!enter && viewNode.blueprint.if) {\n          console.warn('The following node has `if` and a `leave` animation but does NOT have a `enter` animation.' +\n            '\\nThis can result in unexpected UI behavior.\\nTry to define a `enter` animation that negates the leave animation to prevent unexpected behavior\\n\\n');\n          console.warn(viewNode.node);\n        }\n\n        viewNode.processLeaveAnimation = function (finalize) {\n          // if(this.blueprint.text === 'leave:timeline:keyframe')\n          //   debugger\n          process_leave_animation(this, leave, finalize);\n        };\n\n        // Hide timeline is the same as leave timeline.\n        // The only difference is that hide timeline will add `display: 'none'` to the node at the end\n        viewNode.populateHideSequence = viewNode.processLeaveAnimation.bind(viewNode, () => {\n          viewNode.node.style.display = 'none';\n        });\n      } else {\n        // By default, imitate leave with parent behavior\n        viewNode.processLeaveAnimation = leave_with_parent.bind(viewNode);\n      }\n\n      const viewNodeCache = viewNode.cache;\n      if (viewNodeCache.class && viewNodeCache.class.observer) {\n        viewNode.rendered.then(function () {\n          const classes = viewNodeCache.class.observer.context;\n\n          // Apply final state for class animations\n          for (const key in classes) {\n            const type = Boolean(classes[key]);\n            const animationConfig = get_class_based_animation_config(animations, type, key);\n            if (animationConfig) {\n              if (animationConfig.to.keyframes instanceof Array) {\n                for (let i = 0, len = animationConfig.to.keyframes.length; i < len; i++) {\n                  gsap.set(viewNode.node, Object.assign({ callbackScope: viewNode }, animationConfig.to.keyframes[i] || {}));\n                }\n              } else {\n                gsap.set(viewNode.node, Object.assign({ callbackScope: viewNode }, animationConfig.to || {}));\n              }\n\n              if (type) {\n                viewNode.node.classList.add(key);\n              } else {\n                viewNode.node.classList.remove(key);\n              }\n            }\n          }\n\n          let oldHash = JSON.stringify(classes);\n          viewNodeCache.class.observer.onAll((className) => {\n            const newHash = JSON.stringify(classes);\n            if (oldHash === newHash) {\n              return;\n            }\n\n            oldHash = newHash;\n            const addOrRemove = Boolean(classes[className]);\n            const animationConfig = get_class_based_animation_config(animations, addOrRemove, className);\n\n            if (animationConfig) {\n              const tweenKey = 'tween:' + className;\n              if (viewNodeCache[tweenKey]) {\n                viewNodeCache[tweenKey].forEach(t => t.kill());\n                Reflect.deleteProperty(viewNodeCache, tweenKey);\n              }\n\n              // if(!viewNode.rendered.resolved) {\n              //   console.log(viewNode.node)\n              // }\n              process_class_animation(viewNode, viewNodeCache, tweenKey, animationConfig, addOrRemove, className);\n            }\n          });\n        });\n      }\n    }\n  };\n\n  function clear_tweens(node) {\n    const tweens = gsap.getTweensOf(node);\n    for (const t of tweens) {\n      if (t.parent) {\n        if (t.parent === gsap.globalTimeline) {\n          // we can not pause the parent timeline if it's the  global timeline\n          t.pause();\n        } else {\n          t.parent.pause();\n        }\n\n        t.parent.remove(t);\n      } else {\n        t.pause();\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {AnimationConfig} animationConfig\n   * @returns {*}\n   */\n  function process_enter_animation(viewNode, animationConfig) {\n    const _node = viewNode.node;\n    if (animationConfig.withParent) {\n      // if parent has an enter animation, then ignore viewNode's animation\n      // so viewNode can enter with its parent\n      if (has_parent_enter_animation(viewNode)) {\n        return gsap.set(_node, Object.assign({}, animationConfig.to || {}));\n      }\n\n      const parent = viewNode.parent;\n      // if enter.withParent flag is there, then only apply animation to the nodes are rendered\n      if (!parent.rendered.resolved) {\n        return;\n      }\n    }\n\n    if (gsap.getTweensOf(_node).length) {\n      gsap.killTweensOf(_node);\n    }\n\n    // if a parent node is rendered detached, then this node won't be in the DOM\n    // therefore, their animations should be ignored.\n    if (!document_body.contains(_node)) {\n      // console.log(_node);\n      // if the node is not part of the DOM/body then probably it's being rendered detached,\n      // and we should skip its enter animation\n      return;\n    }\n\n    AnimationMeta.installGSAPAnimation(viewNode, 'enter', animationConfig);\n  }\n\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {AnimationConfig} animationConfig\n   * @param {Function} [finalize]\n   */\n  function process_leave_animation(viewNode, animationConfig, finalize) {\n    const active = animationConfig.active;\n    if (active === false) {\n      return leave_with_parent.call(viewNode, finalize);\n    }\n\n    const withParentResult = animationConfig.withParent;\n    viewNode.leaveWithParent = withParentResult === true;\n    const _node = viewNode.node;\n\n    if (withParentResult) {\n      // if the leaveWithParent flag is there, then apply animation only to non-transitory nodes\n      const parent = viewNode.parent;\n      if (parent.transitory) {\n        gsap.killTweensOf(_node);\n        // We dump _node, so it gets removed when the leave's animation's origin node is detached.\n        // This fixes a bug where removed elements stay in DOM if the cause of the leave animation is a 'if'\n        return viewNode.dump();\n      }\n    }\n\n    if ('style' in _node) {\n      // in the case which the _viewNode is not visible, then ignore its animation\n      const rect = _node.getBoundingClientRect();\n      if (rect.width === 0 ||\n        rect.height === 0 ||\n        _node.style.opacity === '0' ||\n        _node.style.visibility === 'hidden') {\n        gsap.killTweensOf(_node);\n        return finalize();\n      }\n    }\n\n    clear_tweens(_node);\n    AnimationMeta.installGSAPAnimation(viewNode, 'leave', animationConfig, finalize);\n  }\n\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {Object} viewNodeCache\n   * @param {string} tweenKey\n   * @param {AnimationConfig} animationConfig\n   * @param {boolean} addOrRemove\n   * @param {string} className\n   */\n  function process_class_animation(viewNode, viewNodeCache, tweenKey, animationConfig, addOrRemove, className) {\n    const IN_NEXT_FRAME = addOrRemove ? create_in_next_frame : destroy_in_next_frame;\n    IN_NEXT_FRAME(viewNode.index, (_next) => {\n      const tweenExist = Boolean(viewNodeCache[tweenKey]);\n\n      if (addOrRemove && (!viewNode.node.classList.contains(className) || tweenExist)) {\n        AnimationMeta.setupOnComplete(animationConfig.to || animationConfig.from, () => {\n          viewNode.node.classList.add(className);\n        });\n      } else if (!addOrRemove && (viewNode.node.classList.contains(className) || tweenExist)) {\n        AnimationMeta.setupOnComplete(animationConfig.to || animationConfig.from, () => {\n          viewNode.node.classList.remove(className);\n        });\n      }\n\n      viewNodeCache[tweenKey] = viewNodeCache[tweenKey] || [];\n      viewNodeCache[tweenKey].push(AnimationMeta.installGSAPAnimation(viewNode, null, animationConfig));\n      _next();\n    });\n  }\n\n  /**\n   *\n   * @param {*} animations\n   * @param {boolean} type\n   * @param {string} key\n   * @returns {*}\n   */\n  function get_class_based_animation_config(animations, type, key) {\n    const animationKey = type ? 'add:' + key : 'remove:' + key;\n    return animations[animationKey];\n  }\n\n  function leave_with_parent(finalize) {\n    clear_tweens(this.node);\n\n    if (this.parent.transitory) {\n      this.dump();\n    } else {\n      finalize();\n    }\n  }\n\n  /**\n   *\n   * @typedef {Object} AnimationConfig\n   * @property {boolean} [withParent]\n   * @property {string} [timeline]\n   * @property {string[]} [labels]\n   * @property {Promise} [await]\n   * @property {string|number} [startPosition]\n   * @property {string|number} [position]\n   * @property {object} [from]\n   * @property {object} [to]\n   * @property {string} [addTo]\n   * @property {Function} [onStart]\n   * @property {Function} [onComplete]\n   */\n\n  AnimationMeta.ANIMATIONS = {};\n  AnimationMeta.TIMELINES = {};\n\n  AnimationMeta.createSimpleAnimation = function (viewNode, config, finalize) {\n    finalize = finalize || EMPTY_CALL;\n    const node = viewNode.node;\n    let from = config.from;\n    let to = config.to;\n\n    if (to) {\n      to = Object.assign({}, to);\n      to.onComplete = finalize;\n\n      if (config.onComplete) {\n        const userDefinedOnComplete = config.onComplete;\n        to.onComplete = function () {\n          userDefinedOnComplete();\n          finalize();\n        };\n      }\n    }\n\n    let tween;\n    if (from && to) {\n      tween = gsap.fromTo(node, from, to);\n    } else if (from) {\n      from = Object.assign({}, from);\n      from.onComplete = finalize;\n\n      if (config.onComplete) {\n        const userDefinedOnComplete = config.onComplete;\n        from.onComplete = function () {\n          userDefinedOnComplete();\n          finalize();\n        };\n      }\n\n      tween = gsap.from(node, from);\n    } else if (to) {\n      tween = gsap.to(node, to);\n    } else if (config.onComplete) {\n      const userDefinedOnComplete = config.onComplete;\n      const onComplete = function () {\n        userDefinedOnComplete();\n        finalize();\n      };\n\n      tween = gsap.to(node, {\n        duration: config.duration || 0,\n        onComplete: onComplete\n      });\n    } else {\n\n      tween = gsap.to(node, {\n        duration: config.duration || 0,\n        onComplete: finalize\n      });\n    }\n\n    return tween;\n  };\n\n  /**\n   *\n   * @param stepDescription\n   * @param viewNode\n   * @return {*}\n   */\n  AnimationMeta.addCallbackScope = function (stepDescription, viewNode) {\n    const step = Object.assign({}, stepDescription);\n    step.callbackScope = viewNode;\n\n    return step;\n  };\n\n  AnimationMeta.setupOnComplete = function (description, onComplete) {\n    if (description.onComplete) {\n      const userDefinedOnComplete = description.onComplete;\n      description.onComplete = function () {\n        userDefinedOnComplete.call(this);\n        onComplete();\n      };\n    } else {\n      description.onComplete = () => {\n        onComplete();\n      };\n    }\n  };\n\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {'enter'|'leave'|null} type\n   * @param {AnimationConfig} descriptions\n   * @param {Function} [finalize]\n   */\n  AnimationMeta.installGSAPAnimation = function (viewNode, type, descriptions, finalize) {\n    const from = descriptions.from;\n    let to = descriptions.to;\n\n    if (type !== 'leave' && to && viewNode.node.nodeType !== Node.COMMENT_NODE) {\n      to.clearProps = to.hasOwnProperty('clearProps') ? to.clearProps : 'all';\n    }\n\n    // if (type.indexOf('add:') === 0 || type.indexOf('remove:') === 0) {\n    //   to = Object.assign(to || {}, { overwrite: 'none' });\n    // }\n    /** @type {AnimationConfig} */\n    const newConfig = Object.assign({}, descriptions);\n    newConfig.from = from;\n    newConfig.to = to;\n    let timelineName = newConfig.timeline;\n\n    // let parentAnimationMeta = null;\n    if (timelineName) {\n      const animationMeta = new AnimationMeta(timelineName);\n      // Class animation do not have a type since their `enter` and `leave` states are not the same a\n      // node's `enter` and `leave`. A class can be added or in other word, have an `enter` state while its timeline\n      // is in a `leave` state or vice versa.\n      type = type || animationMeta.type;\n      // By calling 'addTo' first, we can provide a parent for the 'animationMeta.timeline'\n      // if (newConfig.addTo) {\n      //   parentAnimationMeta = new AnimationMeta(newConfig.addTo);\n      //   const children = parentAnimationMeta.timeline.getChildren(false);\n      //   if (children.indexOf(animationMeta.timeline) === -1) {\n      //     parentAnimationMeta.timeline.add(animationMeta.timeline, parentAnimationMeta.parsePosition(newConfig.positionInParent));\n      //   }\n      // }\n\n      // Make sure the await step is added to highest parent as long as that parent is not the 'gsap.globalTimeline'\n      if (newConfig.await && animationMeta.awaits.indexOf(newConfig.await) === -1) {\n        let parentTimeline = animationMeta.timeline;\n        // console.log(parentTimeline.getChildren(false));\n        while (parentTimeline.parent !== gsap.globalTimeline) {\n          if (!parentTimeline.parent) return;\n          parentTimeline = parentTimeline.parent;\n        }\n\n        animationMeta.awaits.push(newConfig.await);\n\n        // The pauseTween will be removed from the parentTimeline by GSAP the moment the pause is hit\n        const pauseTween = parentTimeline.addPause(newConfig.position, () => {\n          if (viewNode.transitory || viewNode.destroyed.resolved) {\n            return parentTimeline.resume();\n          }\n\n          newConfig.await.then(removeAwait);\n        }).recent();\n\n        const removeAwait = ((_pause) => {\n          const index = animationMeta.awaits.indexOf(newConfig.await);\n          if (index !== -1) {\n            animationMeta.awaits.splice(index, 1);\n            // Do not remove the pause if it is already executed\n            if (_pause._initted) {\n              parentTimeline.resume();\n            } else {\n              const children = parentTimeline.getChildren(false);\n              if (children.indexOf(_pause) !== -1) {\n                parentTimeline.remove(_pause);\n              }\n            }\n          }\n        }).bind(null, pauseTween);\n        // We don't want the animation wait for await, if this `viewNode` is destroyed before await gets a chance\n        // to be resolved. Therefore, we need to remove await.\n        viewNode.finalize.push(() => {\n          // if the element is removed before await is resolved, then make sure the element stays hidden\n          if (animationMeta.awaits.indexOf(newConfig.await) !== -1 && viewNode.node.style) {\n            viewNode.node.style.display = 'none';\n          }\n          removeAwait();\n        });\n      }\n\n      // The first tween of an animation type(enter or leave) should use startPosition\n      if (animationMeta.type && animationMeta.type !== type && (newConfig.position && newConfig.position.indexOf('=') !== -1)) {\n        newConfig.position = newConfig.startPosition;\n      }\n\n      // if previous tween was a timeline:start then the next tween should use +=0\n      const children = animationMeta.timeline.getChildren(false);\n      if (children.length) {\n        const lastTween = children[children.length - 1];\n        if (lastTween.data === 'timeline:start') {\n          newConfig.position = '+=0';\n        }\n      }\n\n      animationMeta.type = type;\n      // console.log(newConfig)\n      // const tween = animationMeta.add(viewNode, newConfig, finalize);\n\n      // In the case where the addToAnimationMeta.timeline has no child then animationMeta.timeline would be\n      // its only child and, we have to resume it if it's not playing\n      // if (newConfig.addTo && parentAnimationMeta) {\n      //   if (!parentAnimationMeta.started /*&& parentAnimationMeta.name !== '<user-defined>'*/) {\n      //     parentAnimationMeta.started = true;\n      //     parentAnimationMeta.timeline.resume();\n      //   }\n      // }\n\n      return animationMeta.add(viewNode, newConfig, finalize);\n\n    } else {\n      return AnimationMeta.createSimpleAnimation(viewNode, newConfig, finalize);\n    }\n  };\n\n  const TIMELINE_SETUP_MAP = {};\n  setupTimeline = function (name, labels) {\n    TIMELINE_SETUP_MAP[name] = labels;\n    const animationMeta = AnimationMeta.ANIMATIONS[name];\n    if (animationMeta) {\n      animationMeta.setupLabels(labels);\n    }\n  };\n\n  /**\n   *\n   * @param {string} name\n   * @class\n   */\n  function AnimationMeta(name) {\n    const _this = this;\n    if (name && typeof name !== 'string') {\n      if (name.__am__) {\n        return name.__am__;\n      }\n\n      const onComplete = name.eventCallback('onComplete') || EMPTY_CALL;\n\n      _this.name = '<user-defined>';\n      _this.timeline = name;\n      _this.timeline.__am__ = this;\n      _this.timeline.eventCallback('onComplete', function () {\n        onComplete.call(_this.timeline);\n        _this.onCompletesActions.forEach((action) => {\n          action(_this.timeline);\n        });\n        _this.nodes = [];\n        _this.awaits = [];\n        _this.children = [];\n        _this.onCompletesActions = [];\n      });\n      _this.parsePosition = (p) => p;\n    } else {\n      const exist = AnimationMeta.ANIMATIONS[name];\n      if (exist) {\n        if (!exist.timeline.getChildren().length && !exist.timeline.isActive()) {\n          exist.timeline.clear(false);\n          exist.timeline.invalidate();\n        }\n        return exist;\n      }\n\n      _this.name = name;\n      _this.timeline = gsap.timeline({\n        autoRemoveChildren: true,\n        smoothChildTiming: false,\n        paused: true,\n        onComplete: function () {\n          _this.onCompletesActions.forEach((action) => {\n            action(_this.timeline);\n          });\n          _this.nodes = [];\n          _this.awaits = [];\n          _this.children = [];\n          _this.onCompletesActions = [];\n          AnimationMeta.ANIMATIONS[name] = null;\n        }\n      });\n      _this.timeline.data = { name };\n      _this.labelCounter = 0;\n      _this.labelsMap = {};\n\n      const labels = TIMELINE_SETUP_MAP[name];\n      if (labels) {\n        _this.setupLabels(labels);\n      }\n\n      AnimationMeta.ANIMATIONS[name] = this;\n    }\n\n    _this.type = null;\n    _this.onCompletesActions = [];\n    _this.started = false;\n    _this.configs = {};\n    _this.children = [];\n    _this.nodes = [];\n    _this.awaits = [];\n  }\n\n  AnimationMeta.prototype = {\n    setupLabels: function (labels) {\n      for (const label in labels) {\n        const newLabel = 'label_' + this.labelCounter++;\n        const position = labels[label];\n        this.labelsMap[label] = newLabel;\n        this.timeline.addLabel(newLabel, typeof position === 'number' ? '+=' + position : position);\n      }\n    },\n    parsePosition: function (p) {\n      let position = this.labelsMap[p] || p;\n      let label = null;\n      if (position || typeof position === 'number') {\n        if (position.indexOf('+=') !== -1) {\n          const parts = position.split('+=');\n          label = parts[0];\n        } else if (position.indexOf('-=') !== -1) {\n          const parts = position.split('-=');\n          label = parts[0];\n        }\n      }\n\n      if (label && label !== '<' && label !== '>') {\n        position = position.replace(label, this.labelsMap[label]);\n      }\n      return position;\n    },\n    addOnComplete: function (action) {\n      this.onCompletesActions.push(action);\n    },\n\n    /**\n     *\n     * @param viewNode\n     * @param config {AnimationConfig}\n     * @param finalize\n     */\n    add: function (viewNode, config, finalize) {\n      const _this = this;\n      let tween;\n\n      if (config.from && config.to) {\n        const to = AnimationMeta.addCallbackScope(config.to, viewNode);\n        tween = gsap.fromTo(viewNode.node, config.from, to);\n      } else if (config.from) {\n        const from = AnimationMeta.addCallbackScope(config.from, viewNode);\n        tween = gsap.from(viewNode.node, from);\n      } else {\n        const to = AnimationMeta.addCallbackScope(config.to, viewNode);\n        tween = gsap.to(viewNode.node, to);\n      }\n\n      if (finalize) {\n        if (tween.vars.onComplete) {\n          const userDefinedOnComplete = tween.vars.onComplete;\n          tween.vars.onComplete = function () {\n            userDefinedOnComplete.apply(this, arguments);\n            finalize();\n          };\n        } else {\n          tween.vars.onComplete = finalize;\n        }\n      }\n\n      const position = this.parsePosition(config.position);\n      const tChildren = _this.timeline.getChildren(false);\n      const firstChild = tChildren[0];\n\n      if (tChildren.length === 0) {\n        // if the tween is the very first child then its position can not be negative\n        _this.timeline.add(tween, (position && position.indexOf('-=') === -1) ? position : null);\n      } else if (tChildren.length === 1 && !firstChild.hasOwnProperty('timeline') && firstChild.getChildren(false).length === 0) {\n        // This fix a bug where if the 'enter' animation has addTo, then the 'leave' animation is ignored\n        _this.timeline.clear(false);\n        _this.timeline.add(tween, position);\n      } else {\n        _this.timeline.add(tween, position);\n      }\n\n      if (_this.name === '<user-defined>')\n        return tween;\n\n      if (!_this.started) {\n        _this.started = true;\n        _this.timeline.resume();\n      } else if (_this.timeline.paused()) {\n        _this.timeline.resume();\n      }\n\n      return tween;\n    }\n  };\n}\n","import { get_bindings } from '../view.js';\n\n/**\n *\n * @type {Galaxy.View.BlueprintProperty}\n */\nexport const checked_property = {\n  type: 'prop',\n  key: 'checked',\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {Galaxy.View.ReactiveData} scopeReactiveData\n   * @param prop\n   * @param {Function} expression\n   */\n  beforeActivate: function (viewNode, scopeReactiveData, prop, expression) {\n    if (!scopeReactiveData) {\n      return;\n    }\n\n    if (expression && viewNode.blueprint.tag === 'input') {\n      throw new Error('input.checked property does not support binding expressions ' +\n        'because it must be able to change its data.\\n' +\n        'It uses its bound value as its `model` and expressions can not be used as model.\\n');\n    }\n\n    const bindings = get_bindings(viewNode.blueprint.checked);\n    const id = bindings.propertyKeys[0].split('.').pop();\n    const nativeNode = viewNode.node;\n    nativeNode.addEventListener('change', function () {\n      const data = scopeReactiveData.data[id];\n      if (data instanceof Array && nativeNode.type !== 'radio') {\n        // if the node does not have value attribute, then we take its default value into the account\n        // The default value for checkbox is 'on' but we translate that to true\n        const value = nativeNode.hasAttribute('value') ? nativeNode.value : true;\n        if (data instanceof Array) {\n          if (data.indexOf(value) === -1) {\n            data.push(value);\n          } else {\n            data.splice(data.indexOf(value), 1);\n          }\n        } else {\n          scopeReactiveData.data[id] = [value];\n        }\n      }\n      // if node has a value, then its value will be assigned according to its checked state\n      else if (nativeNode.hasAttribute('value')) {\n        scopeReactiveData.data[id] = nativeNode.checked ? nativeNode.value : null;\n      }\n      // if node has no value, then checked state would be its value\n      else {\n        scopeReactiveData.data[id] = nativeNode.checked;\n      }\n    });\n  },\n  update: function (viewNode, value) {\n    const nativeNode = viewNode.node;\n    viewNode.rendered.then(function () {\n      // if (/]$/.test(nativeNode.name)) {\n      if (value instanceof Array) {\n        if (nativeNode.type === 'radio') {\n          console.error('Inputs with type `radio` can not provide array as a value.');\n          return console.warn('Read about radio input at: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/radio');\n        }\n\n        const nativeValue = nativeNode.hasAttribute('value') ? nativeNode.value : true;\n        nativeNode.checked = value.indexOf(nativeValue) !== -1;\n      } else if (nativeNode.hasAttribute('value')) {\n        nativeNode.checked = value === nativeNode.value;\n      } else {\n        nativeNode.checked = value;\n      }\n    });\n  }\n};\n\n","import { bind_subjects_to_data } from '../view.js';\nimport Observer from '../observer.js';\n\n/**\n *\n * @type {Galaxy.View.BlueprintProperty}\n */\nexport const class_property = {\n  type: 'reactive',\n  key: 'class',\n  getConfig: function (scope, value) {\n    return {\n      scope,\n      subjects: value,\n      reactiveClasses: null,\n      observer: null,\n    };\n  },\n  install: function (config) {\n    if (this.virtual || config.subjects === null || config.subjects instanceof Array || typeof config.subjects !== 'object') {\n      return true;\n    }\n\n    // when value is an object\n    const viewNode = this;\n    const reactiveClasses = config.reactiveClasses = bind_subjects_to_data(viewNode, config.subjects, config.scope, true);\n    const observer = config.observer = new Observer(reactiveClasses);\n    const animations = viewNode.blueprint.animations || {};\n    const gsapExist = !!window.gsap.config;\n    if (viewNode.blueprint.renderConfig.applyClassListAfterRender) {\n      viewNode.rendered.then(() => {\n        // ToDo: Don't know why this is here. It looks redundant\n        // applyClasses(viewNode, reactiveClasses);\n        observer.onAll((k) => {\n          if (gsapExist && (animations['add:' + k] || animations['remove:' + k])) {\n            return;\n          }\n          applyClasses(viewNode, reactiveClasses);\n        });\n      });\n    } else {\n      observer.onAll((k) => {\n        if (gsapExist && (animations['add:' + k] || animations['remove:' + k])) {\n          return;\n        }\n        applyClasses(viewNode, reactiveClasses);\n      });\n    }\n\n    return true;\n  },\n  /**\n   *\n   * @param config\n   * @param value\n   * @param expression\n   * @this Galaxy.ViewNode\n   */\n  update: function (config, value, expression) {\n    if (this.virtual) {\n      return;\n    }\n\n    const viewNode = this;\n    const node = viewNode.node;\n\n    if (expression) {\n      value = expression();\n    }\n\n    if (typeof value === 'string' || value === null || value === undefined) {\n      return node.className = value;\n    } else if (value instanceof Array) {\n      return node.className = value.join(' ');\n    }\n\n    if (config.subjects === value) {\n      value = config.reactiveClasses;\n    }\n\n    // when value is an object\n    if (viewNode.blueprint.renderConfig.applyClassListAfterRender) {\n      viewNode.rendered.then(() => {\n        applyClasses(viewNode, value);\n      });\n    } else {\n      applyClasses(viewNode, value);\n    }\n  }\n};\n\nfunction getClasses(classes) {\n  if (typeof classes === 'string') {\n    return [classes];\n  } else if (classes instanceof Array) {\n    return classes;\n  } else if (classes !== null && typeof classes === 'object') {\n    let newClasses = [];\n\n    for (let key in classes) {\n      if (classes.hasOwnProperty(key) && classes[key]) {\n        newClasses.push(key);\n      }\n    }\n\n    return newClasses;\n  }\n}\n\nfunction applyClasses(viewNode, classes) {\n  const currentClasses = viewNode.node.className || [];\n  const newClasses = getClasses(classes);\n  if (JSON.stringify(currentClasses) === JSON.stringify(newClasses)) {\n    return;\n  }\n\n  // G.View.create_in_next_frame(viewNode.index, (_next) => {\n  viewNode.node.className = newClasses.join(' ');\n  // _next();\n  // });\n}\n\n","import { set_attr } from '../view.js';\n\n/**\n *\n * @type {Galaxy.View.BlueprintProperty}\n */\nexport const disabled_property = {\n  type: 'attr',\n  key: 'disabled',\n  update: function (viewNode, value, attr) {\n    viewNode.rendered.then(() => {\n      if (viewNode.blueprint.tag.toLowerCase() === 'form') {\n        const children = viewNode.node.querySelectorAll('input, textarea, select, button');\n\n        if (value) {\n          Array.prototype.forEach.call(children, input => input.setAttribute('disabled', ''));\n        } else {\n          Array.prototype.forEach.call(children, input => input.removeAttribute('disabled'));\n        }\n      }\n    });\n\n    set_attr(viewNode, value ? '' : null, attr);\n  }\n};\n\n","/**\n *\n * @type {Galaxy.View.BlueprintProperty}\n */\nexport const if_property = {\n  type: 'reactive',\n  key: 'if',\n  getConfig: function () {\n    return {\n      throttleId: 0,\n    };\n  },\n  install: function (config) {\n    return true;\n  },\n  /**\n   *\n   * @this Galaxy.ViewNode\n   * @param config\n   * @param value\n   * @param expression\n   */\n  update: function (config, value, expression) {\n    if (config.throttleId !== 0) {\n      window.clearTimeout(config.throttleId);\n      config.throttleId = 0;\n    }\n\n    if (expression) {\n      value = expression();\n    }\n\n    value = Boolean(value);\n\n    if (!this.rendered.resolved && !this.inDOM) {\n      this.blueprint.renderConfig.renderDetached = !value;\n    }\n\n    // setTimeout is called before requestAnimationTimeFrame\n    config.throttleId = setTimeout(() => {\n      if (this.inDOM !== value) {\n        this.setInDOM(value);\n      }\n    });\n  }\n};\n\n\n","/**\n *\n * @param {string} url\n * @constructor\n */\nfunction GalaxyURI(url) {\n  let urlParser = document.createElement('a');\n  urlParser.href = url;\n  let myRegexp = /\\/([^\\t\\n]+\\/)/g;\n  let match = myRegexp.exec(urlParser.pathname);\n\n  this.parsedURL = urlParser.href;\n  this.path = match ? match[1] : '/';\n  this.base = window.location.pathname;\n  this.protocol = urlParser.protocol;\n}\n\nexport default GalaxyURI;\n","import { EMPTY_CALL } from '../utils.js';\nimport GalaxyURI from '../uri.js';\nimport Scope from '../scope.js';\nimport { create_in_next_frame } from '../view.js';\n\nexport const module_property = {\n  type: 'reactive',\n  key: 'module',\n  getConfig: function (scope) {\n    return {\n      previousModule: null,\n      moduleMeta: null,\n      scope: scope\n    };\n  },\n  install: function () {\n    return true;\n  },\n\n  /**\n   *\n   * @param cache\n   * @param {Galaxy.ModuleMetaData} newModuleMeta\n   * @param expression\n   */\n  update: function handleModule(cache, newModuleMeta, expression) {\n    const _this = this;\n\n    if (expression) {\n      newModuleMeta = expression();\n    }\n\n    if (newModuleMeta === undefined) {\n      return;\n    }\n\n    if (typeof newModuleMeta !== 'object') {\n      return console.error('module property only accept objects as value', newModuleMeta);\n    }\n\n    if (newModuleMeta && cache.moduleMeta && newModuleMeta.path === cache.moduleMeta.path) {\n      return;\n    }\n\n    if (!newModuleMeta || newModuleMeta !== cache.moduleMeta) {\n      // When this node has a `if`, calling `clean_content(this)` inside a destroy_in_next_frame cause the animation\n      // of this node to be executed before the animations of its children, which is not correct.\n      // Calling `clean_content(this)` directly fixes this issue, however it might cause other issues when\n      // this node does not use `if`. Therefore, we make sure both cases are covered.\n      // if (_this.blueprint.hasOwnProperty('if')) {\n      // ToDo: Make this works properly\n      clean_content(_this);\n      if (cache.loadedModule) {\n        cache.loadedModule.destroy();\n        cache.loadedModule = null;\n      }\n    }\n\n    if (!_this.virtual && newModuleMeta && newModuleMeta.path && newModuleMeta !== cache.moduleMeta) {\n      create_in_next_frame(_this.index, (_next) => {\n        module_loader.call(null, _this, cache, newModuleMeta, _next);\n      });\n    }\n    cache.moduleMeta = newModuleMeta;\n  }\n};\n\n/**\n *\n * @param {Galaxy.ViewNode} viewNode\n */\nfunction clean_content(viewNode) {\n  const children = viewNode.getChildNodes();\n  for (let i = 0, len = children.length; i < len; i++) {\n    const vn = children[i];\n    if (vn.processLeaveAnimation === EMPTY_CALL) {\n      vn.processLeaveAnimation = function (finalize) {\n        finalize();\n      };\n    }\n  }\n\n  viewNode.clean(viewNode.hasAnimation(children));\n}\n\n/**\n *\n * @param viewNode\n * @param cache\n * @param {object} moduleMeta\n * @param _next\n */\nfunction module_loader(viewNode, cache, moduleMeta, _next) {\n  // if (cache.module) {\n  //   cache.module.destroy();\n  // }\n  // Check for circular module loading\n  const tempURI = new GalaxyURI(moduleMeta.path);\n  let moduleScope = cache.scope;\n  let currentScope = cache.scope;\n\n  if (typeof moduleMeta.onInvoke === 'function') {\n    moduleMeta.onInvoke.call();\n  }\n\n  while (moduleScope) {\n    // In the case where module is a part of repeat, cache.scope will NOT be an instance of Scope\n    // but its __parent__ will be\n    if (!(currentScope instanceof Scope)) {\n      currentScope = new Scope(cache.scope.__parent__.context, {\n        systemId: 'repeat-item',\n        path: cache.scope.__parent__.uri.parsedURL,\n        parentScope: cache.scope.__parent__\n      });\n    }\n\n    if (tempURI.parsedURL === currentScope.uri.parsedURL) {\n      return console.error('Circular module loading detected and stopped. \\n' + currentScope.uri.parsedURL + ' tries to load itself.');\n    }\n\n    moduleScope = moduleScope.parentScope;\n  }\n\n  currentScope.load(moduleMeta, {\n    element: viewNode\n  }).then(function (module) {\n    cache.loadedModule = module;\n    viewNode.node.setAttribute('module', module.path);\n    module.start();\n\n    if (typeof moduleMeta.onLoad === 'function') {\n      moduleMeta.onLoad.call();\n    }\n\n    _next();\n  }).catch(function (response) {\n    console.error(response);\n    _next();\n  });\n}\n\n","export const on_property = {\n  type: 'prop',\n  key: 'on',\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param events\n   */\n  update: function (viewNode, events) {\n    if (events !== null && typeof events === 'object') {\n      for (let name in events) {\n        if (events.hasOwnProperty(name)) {\n          const handler = function (event) {\n            return events[name].call(viewNode, event, viewNode.data);\n          };\n          viewNode.node.addEventListener(name, handler, false);\n          viewNode.finalize.push(() => {\n            viewNode.node.removeEventListener(name, handler, false);\n          });\n        }\n      }\n    }\n  }\n};\n","let lastId = 0;\n\nfunction ArrayChange() {\n  this.id = lastId++;\n  if (lastId > 100000000) {\n    lastId = 0;\n  }\n  this.init = null;\n  this.original = null;\n  // this.snapshot = [];\n  this.returnValue = null;\n  this.params = [];\n  this.type = 'reset';\n\n  // Object.preventExtensions(this);\n}\n\nArrayChange.prototype = {\n  getInstance: function () {\n    const instance = new ArrayChange();\n    instance.init = this.init;\n    instance.original = this.original;\n    instance.params = this.params.slice(0);\n    instance.type = this.type;\n\n    return instance;\n  }\n};\n\nexport default ArrayChange;\n","import { clone } from '../utils.js';\nimport {\n  create_child_scope,\n  create_in_next_frame, destroy_nodes, get_bindings, get_property_setter_for_node, make_binding,\n  property_rd_lookup,\n} from '../view.js';\nimport ArrayChange from '../array-change.js';\n\nexport const repeat_property = {\n  type: 'reactive',\n  key: 'repeat',\n  getConfig: function (scope, value) {\n    this.virtualize();\n\n    return {\n      changeId: null,\n      previousActionId: null,\n      nodes: [],\n      data: value.data,\n      as: value.as,\n      indexAs: value.indexAs || '_index',\n      oldChanges: {},\n      positions: [],\n      trackMap: [],\n      scope: scope,\n      trackBy: value.trackBy,\n      onComplete: value.onComplete\n    };\n  },\n\n  /**\n   *\n   * @param config Value return by getConfig\n   */\n  install: function (config) {\n    const viewNode = this;\n\n    if (config.data) {\n      if (config.as === 'data') {\n        throw new Error('`data` is an invalid value for repeat.as property. Please choose a different value.`');\n      }\n      viewNode.localPropertyNames.add(config.as);\n      viewNode.localPropertyNames.add(config.indexAs);\n\n      const bindings = get_bindings(config.data);\n      if (bindings.propertyKeys.length) {\n        make_binding(viewNode, 'repeat', undefined, config.scope, bindings, viewNode);\n        bindings.propertyKeys.forEach((path) => {\n          try {\n            const rd = property_rd_lookup(config.scope, path);\n            viewNode.finalize.push(() => {\n              rd.removeNode(viewNode);\n            });\n          } catch (error) {\n            console.error('Could not find: ' + path + '\\n', error);\n          }\n        });\n      } else if (config.data instanceof Array) {\n        const setter = viewNode.setters['repeat'] = get_property_setter_for_node(repeat_property, viewNode, config.data, null);\n        const value = new ArrayChange();\n        value.params = config.data;\n        config.data.changes = value;\n        setter(config.data);\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   *\n   * @this Galaxy.ViewNode\n   * @param config The value returned by getConfig\n   * @param value\n   * @param {Function} expression\n   */\n  update: function (config, value, expression) {\n    let changes = null;\n    if (expression) {\n      value = expression();\n      if (value === undefined) {\n        return;\n      }\n\n      if (value === null) {\n        throw Error('Invalid return type: ' + value + '\\nThe expression function for `repeat.data` must return an instance of Array or Galaxy.View.ArrayChange or undefined');\n      }\n\n      if (value instanceof ArrayChange) {\n        changes = value;\n      } else if (value instanceof Array) {\n        const initialChanges = new ArrayChange();\n        initialChanges.original = value;\n        initialChanges.type = 'reset';\n        initialChanges.params = value;\n        changes = value.changes = initialChanges;\n      } else if (value instanceof Object) {\n        const output = Object.entries(value).map(([key, value]) => ({ key, value }));\n        const initialChanges = new ArrayChange();\n        initialChanges.original = output;\n        initialChanges.type = 'reset';\n        initialChanges.params = output;\n        changes = value.changes = initialChanges;\n      } else {\n        changes = {\n          type: 'reset',\n          params: []\n        };\n      }\n\n      // if (!(changes instanceof Galaxy.View.ArrayChange)) {\n      //   debugger;\n      //   throw new Error('repeat: Expression has to return an ArrayChange instance or null \\n' + config.watch.join(' , ') + '\\n');\n      // }\n    } else {\n      if (value instanceof ArrayChange) {\n        changes = value;\n      } else if (value instanceof Array) {\n        changes = value.changes;\n      } else if (value instanceof Object) {\n        const output = Object.entries(value).map(([key, value]) => ({ key, value }));\n        changes = new ArrayChange();\n        changes.original = output;\n        changes.type = 'reset';\n        changes.params = output;\n      }\n    }\n\n    if (changes && !(changes instanceof ArrayChange)) {\n      return console.warn('%crepeat %cdata is not a type of ArrayChange' +\n        '\\ndata: ' + config.data +\n        '\\n%ctry \\'' + config.data + '.changes\\'\\n', 'color:black;font-weight:bold', null, 'color:green;font-weight:bold');\n    }\n\n    if (!changes || typeof changes === 'string') {\n      changes = {\n        id: 0,\n        type: 'reset',\n        params: []\n      };\n    }\n\n    const node = this;\n    if (changes.id === config.changeId) {\n      return;\n    }\n\n    // Only cancel previous action if the type of new and old changes is reset\n    // if (changes.type === 'reset' && changes.type === config.oldChanges.type && config.previousActionId) {\n    //   cancelAnimationFrame(config.previousActionId);\n    // }\n\n    config.changeId = changes.id;\n    config.oldChanges = changes;\n    processChanges(node, config, prepareChanges(node, config, changes));\n  }\n};\n\nfunction prepareChanges(viewNode, config, changes) {\n  const hasAnimation = viewNode.blueprint.animations && viewNode.blueprint.animations.leave;\n  const trackByKey = config.trackBy;\n  if (trackByKey && changes.type === 'reset') {\n    let newTrackMap;\n    if (trackByKey === true) {\n      newTrackMap = changes.params.map(item => {\n        return item;\n      });\n    } else if (typeof trackByKey === 'string') {\n      newTrackMap = changes.params.map(item => {\n        return item[trackByKey];\n      });\n    }\n\n    // list of nodes that should be removed\n    const hasBeenRemoved = [];\n    config.trackMap = config.trackMap.filter(function (id, i) {\n      if (newTrackMap.indexOf(id) === -1 && config.nodes[i]) {\n        hasBeenRemoved.push(config.nodes[i]);\n        return false;\n      }\n      return true;\n    });\n\n    const newChanges = new ArrayChange();\n    newChanges.init = changes.init;\n    newChanges.type = changes.type;\n    newChanges.original = changes.original;\n    newChanges.params = changes.params;\n    newChanges.__rd__ = changes.__rd__;\n    if (newChanges.type === 'reset' && newChanges.params.length) {\n      newChanges.type = 'push';\n    }\n\n    config.nodes = config.nodes.filter(function (node) {\n      return hasBeenRemoved.indexOf(node) === -1;\n    });\n\n    destroy_nodes(hasBeenRemoved, hasAnimation);\n    return newChanges;\n  } else if (changes.type === 'reset') {\n    const nodesToBeRemoved = config.nodes.slice(0);\n    config.nodes = [];\n    destroy_nodes(nodesToBeRemoved, hasAnimation);\n    const newChanges = Object.assign({}, changes);\n    newChanges.type = 'push';\n    return newChanges;\n  }\n\n  return changes;\n}\n\nfunction processChanges(viewNode, config, changes) {\n  const parentNode = viewNode.parent;\n  // const positions = config.positions;\n  const positions = [];\n  const placeholders = [];\n  const nodeScopeData = config.scope;\n  const trackMap = config.trackMap;\n  const as = config.as;\n  const indexAs = config.indexAs;\n  const nodes = config.nodes;\n  const trackByKey = config.trackBy;\n  const templateBlueprint = viewNode.cloneBlueprint();\n  templateBlueprint.repeat = null;\n\n  let defaultPosition = nodes.length ? nodes[nodes.length - 1].anchor.nextSibling : viewNode.placeholder.nextSibling;\n  let newItems = [];\n  let onEachAction;\n  if (trackByKey === true) {\n    onEachAction = function (vn, p, d) {\n      trackMap.push(d);\n      this.push(vn);\n    };\n  } else if (typeof trackByKey === 'string') {\n    onEachAction = function (vn, p, d) {\n      trackMap.push(d[config.trackBy]);\n      this.push(vn);\n    };\n  } else {\n    onEachAction = function (vn) {\n      this.push(vn);\n    };\n  }\n\n  if (changes.type === 'push') {\n    newItems = changes.params;\n  } else if (changes.type === 'unshift') {\n    defaultPosition = nodes[0] ? nodes[0].anchor : defaultPosition;\n    newItems = changes.params;\n\n    if (trackByKey === true) {\n      onEachAction = function (vn, p, d) {\n        trackMap.unshift(d);\n        this.unshift(vn);\n      };\n    } else {\n      onEachAction = function (vn, p, d) {\n        trackMap.unshift(d[trackByKey]);\n        this.unshift(vn);\n      };\n    }\n  } else if (changes.type === 'splice') {\n    const changeParams = changes.params.slice(0, 2);\n    const removedItems = Array.prototype.splice.apply(nodes, changeParams);\n    destroy_nodes(removedItems.reverse(), viewNode.blueprint.animations && viewNode.blueprint.animations.leave);\n    Array.prototype.splice.apply(trackMap, changeParams);\n\n    const startingIndex = changes.params[0];\n    newItems = changes.params.slice(2);\n    for (let i = 0, len = newItems.length; i < len; i++) {\n      const index = i + startingIndex;\n      positions.push(index);\n      placeholders.push(nodes[index] ? nodes[index].anchor : defaultPosition);\n    }\n\n    if (trackByKey === true) {\n      onEachAction = function (vn, p, d) {\n        trackMap.splice(p, 0, d);\n        this.splice(p, 0, vn);\n      };\n    } else {\n      onEachAction = function (vn, p, d) {\n        trackMap.splice(p, 0, d[trackByKey]);\n        this.splice(p, 0, vn);\n      };\n    }\n  } else if (changes.type === 'pop') {\n    const lastItem = nodes.pop();\n    lastItem && lastItem.destroy();\n    trackMap.pop();\n  } else if (changes.type === 'shift') {\n    const firstItem = nodes.shift();\n    firstItem && firstItem.destroy();\n    trackMap.shift();\n  } else if (changes.type === 'sort' || changes.type === 'reverse') {\n    nodes.forEach(function (viewNode) {\n      viewNode.destroy();\n    });\n\n    config.nodes = [];\n    newItems = changes.original;\n    Array.prototype[changes.type].call(trackMap);\n  }\n\n  const view = viewNode.view;\n  if (newItems instanceof Array) {\n    const newItemsCopy = newItems.slice(0);\n    // let vn;\n    if (trackByKey) {\n      if (trackByKey === true) {\n        for (let i = 0, len = newItems.length; i < len; i++) {\n          const newItemCopy = newItemsCopy[i];\n          const index = trackMap.indexOf(newItemCopy);\n          if (index !== -1) {\n            config.nodes[index].data._index = index;\n            continue;\n          }\n\n          createNode(view, templateBlueprint, nodeScopeData, as, newItemCopy, indexAs, i, parentNode, placeholders[i] || defaultPosition, onEachAction, nodes, positions);\n        }\n      } else {\n        for (let i = 0, len = newItems.length; i < len; i++) {\n          const newItemCopy = newItemsCopy[i];\n          const index = trackMap.indexOf(newItemCopy[trackByKey]);\n          if (index !== -1) {\n            config.nodes[index].data._index = index;\n            continue;\n          }\n\n          createNode(view, templateBlueprint, nodeScopeData, as, newItemCopy, indexAs, i, parentNode, placeholders[i] || defaultPosition, onEachAction, nodes, positions);\n        }\n      }\n    } else {\n      for (let i = 0, len = newItems.length; i < len; i++) {\n        createNode(view, templateBlueprint, nodeScopeData, as, newItemsCopy[i], indexAs, i, parentNode, placeholders[i] || defaultPosition, onEachAction, nodes, positions);\n      }\n    }\n\n    if (config.onComplete) {\n      create_in_next_frame(viewNode.index, (_next) => {\n        config.onComplete(nodes);\n        _next();\n      });\n    }\n  }\n}\n\nfunction createItemDataScope(nodeScopeData, as, itemData) {\n  const itemDataScope = create_child_scope(nodeScopeData);\n  itemDataScope[as] = itemData;\n  return itemDataScope;\n}\n\nfunction createNode(view, templateBlueprint, nodeScopeData, as, newItemsCopy, indexAs, i, parentNode, position, onEachAction, nodes, positions) {\n  const itemDataScope = createItemDataScope(nodeScopeData, as, newItemsCopy);\n  const cns = clone(templateBlueprint);\n  itemDataScope[indexAs] = i;\n\n  const vn = view.createNode(cns, itemDataScope, parentNode, position);\n  onEachAction.call(nodes, vn, positions[i], itemDataScope[as]);\n}\n\n","import { get_bindings } from '../view.js';\n\nexport const selected_property = {\n  type: 'prop',\n  key: 'selected',\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {Galaxy.View.ReactiveData} scopeReactiveData\n   * @param prop\n   * @param {Function} expression\n   */\n  beforeActivate: function (viewNode, scopeReactiveData, prop, expression) {\n    if (!scopeReactiveData) {\n      return;\n    }\n\n    if (expression && viewNode.blueprint.tag === 'select') {\n      throw new Error('select.selected property does not support binding expressions ' +\n        'because it must be able to change its data.\\n' +\n        'It uses its bound value as its `model` and expressions can not be used as model.\\n');\n    }\n\n    // Don't do anything if the node is an option tag\n    if (viewNode.blueprint.tag === 'select') {\n      const bindings = get_bindings(viewNode.blueprint.selected);\n      const id = bindings.propertyKeys[0].split('.').pop();\n      const nativeNode = viewNode.node;\n      nativeNode.addEventListener('change', (event) => {\n        console.log(viewNode.node, 'SELECTED', event);\n      });\n    }\n  },\n  update: function (viewNode, value) {\n    const nativeNode = viewNode.node;\n\n    viewNode.rendered.then(function () {\n      if (nativeNode.value !== value) {\n        if (viewNode.blueprint.tag === 'select') {\n          nativeNode.value = value;\n        } else if (value) {\n          nativeNode.setAttribute('selected', true);\n        } else {\n          nativeNode.removeAttribute('selected');\n        }\n      }\n    });\n  }\n};\n\n","import { bind_subjects_to_data } from '../view.js';\nimport Observer from '../observer.js';\n\nexport const style_3_property = {\n  type: 'prop',\n  key: 'style'\n};\nexport const style_8_property = {\n  type: 'prop',\n  key: 'style'\n};\n\nexport const style_property = {\n  type: 'reactive',\n  key: 'style',\n  getConfig: function (scope, value) {\n    return {\n      scope: scope,\n      subjects: value,\n      reactiveStyle: null\n    };\n  },\n  install: function (config) {\n    if (this.virtual || config.subjects === null || config.subjects instanceof Array || typeof config.subjects !== 'object') {\n      return true;\n    }\n\n    const node = this.node;\n    const reactiveStyle = config.reactiveStyle = bind_subjects_to_data(this, config.subjects, config.scope, true);\n    const observer = new Observer(reactiveStyle);\n    observer.onAll(() => {\n      setStyle(node, reactiveStyle);\n    });\n\n    return true;\n  },\n  /**\n   *\n   * @param config\n   * @param value\n   * @param expression\n   * @this {Galaxy.ViewNode}\n   */\n  update: function (config, value, expression) {\n    if (this.virtual) {\n      return;\n    }\n\n    const _this = this;\n    const node = _this.node;\n\n    if (expression) {\n      value = expression();\n    }\n\n    if (typeof value === 'string') {\n      return node.style = value;\n    } else if (value instanceof Array) {\n      return node.style = value.join(';');\n    }\n\n    if (value instanceof Promise) {\n      value.then(function (_value) {\n        setStyle(node, _value);\n      });\n    } else if (value === null) {\n      return node.removeAttribute('style');\n    }\n\n    if (config.subjects === value) {\n      // return setStyle(node, config.reactiveStyle);\n      value = config.reactiveStyle;\n    }\n\n    setStyle(node, value);\n  }\n};\n\nfunction setStyle(node, value) {\n  if (value instanceof Object) {\n    for (let key in value) {\n      const val = value[key];\n      if (val instanceof Promise) {\n        val.then((v) => {\n          node.style[key] = v;\n        });\n      } else if (typeof val === 'function') {\n        node.style[key] = val.call(node.__vn__, node.__vn__.data);\n      } else {\n        node.style[key] = val;\n      }\n    }\n  } else {\n    node.style = value;\n  }\n}\n\n","import { get_bindings } from '../view.js';\n\nconst IGNORE_TYPES = [\n  'radio',\n  'checkbox',\n  'button',\n  'reset',\n  'submit'\n];\n\nexport const value_config_property = {\n  type: 'none'\n};\n\nexport const value_property = {\n  type: 'prop',\n  key: 'value',\n  /**\n   *\n   * @param {Galaxy.ViewNode} viewNode\n   * @param {Galaxy.View.ReactiveData} scopeReactiveData\n   * @param prop\n   * @param {Function} expression\n   */\n  beforeActivate: function valueUtil(viewNode, scopeReactiveData, prop, expression) {\n    const nativeNode = viewNode.node;\n    if (!scopeReactiveData || IGNORE_TYPES.indexOf(nativeNode.type) !== -1) {\n      return;\n    }\n\n    if (expression) {\n      throw new Error('input.value property does not support binding expressions ' +\n        'because it must be able to change its data.\\n' +\n        'It uses its bound value as its `model` and expressions can not be used as model.\\n');\n    }\n\n    const bindings = get_bindings(viewNode.blueprint.value);\n    const id = bindings.propertyKeys[0].split('.').pop();\n    if (nativeNode.tagName === 'SELECT') {\n      const observer = new MutationObserver(() => {\n        viewNode.rendered.then(() => {\n          // Set the value after the children are rendered\n          nativeNode.value = scopeReactiveData.data[id];\n        });\n      });\n      observer.observe(nativeNode, { childList: true });\n      viewNode.finalize.push(() => {\n        observer.disconnect();\n      });\n      nativeNode.addEventListener('change', createHandler(scopeReactiveData, id));\n    } else if (nativeNode.type === 'number' || nativeNode.type === 'range') {\n      nativeNode.addEventListener('input', createNumberHandler(nativeNode, scopeReactiveData, id));\n    } else {\n      nativeNode.addEventListener('input', createHandler(scopeReactiveData, id));\n    }\n  },\n  update: function (viewNode, value) {\n    // input field parse the value which has been passed to it into a string\n    // that's why we need to parse undefined and null into an empty string\n    if (value !== viewNode.node.value || !viewNode.node.value) {\n      viewNode.node.value = value === undefined || value === null ? '' : value;\n    }\n  }\n};\n\nfunction createNumberHandler(_node, _rd, _id) {\n  return function () {\n    _rd.data[_id] = _node.value ? Number(_node.value) : null;\n  };\n}\n\nfunction createHandler(_rd, _id) {\n  return function (event) {\n    _rd.data[_id] = event.target.value;\n  };\n}\n\n","export const visible_property = {\n  type: 'reactive',\n  key: 'visible',\n  getConfig: function () {\n    return {\n      throttleId: 0,\n    };\n  },\n  install: function () {\n    return true;\n  },\n  update: function (config, value, expression) {\n    if (config.throttleId !== 0) {\n      window.clearTimeout(config.throttleId);\n      config.throttleId = 0;\n    }\n\n    if (expression) {\n      value = expression();\n    }\n\n    // setTimeout is called before requestAnimationTimeFrame\n    config.throttleId = window.setTimeout(() => {\n      if (this.visible !== value) {\n        this.setVisibility(value);\n      }\n    });\n  }\n};\n\n","import { NODE_BLUEPRINT_PROPERTY_MAP } from './constants.js';\nimport { arr_slice, create_comment, create_elem, def_prop, EMPTY_CALL } from './utils.js';\nimport {\n  activate_property_for_node,\n  create_in_next_frame,\n  destroy_in_next_frame, destroy_nodes\n} from './view.js';\nimport { data_property } from './properties/data.reactive.js';\nimport { text_3_property, text_8_property, text_property } from './properties/text.property.js';\nimport { animations_property } from './properties/animations.property.js';\nimport { checked_property } from './properties/checked.property.js';\nimport { class_property } from './properties/class.reactive.js';\nimport { disabled_property } from './properties/disabled.property.js';\nimport { if_property } from './properties/if.reactive.js';\nimport { module_property } from './properties/module.reactive.js';\nimport { on_property } from './properties/on.property.js';\nimport { repeat_property } from './properties/repeat.reactive.js';\nimport { selected_property } from './properties/selected.property.js';\nimport { style_3_property, style_8_property, style_property } from './properties/style.reactive.js';\nimport { value_config_property, value_property } from './properties/value.property.js';\nimport { visible_property } from './properties/visible.reactive.js';\nimport Scope from './scope.js';\n\nNODE_BLUEPRINT_PROPERTY_MAP['data'] = data_property;\nNODE_BLUEPRINT_PROPERTY_MAP['text_3'] = text_3_property;\nNODE_BLUEPRINT_PROPERTY_MAP['text_8'] = text_8_property;\nNODE_BLUEPRINT_PROPERTY_MAP['text'] = text_property;\nNODE_BLUEPRINT_PROPERTY_MAP['animations'] = animations_property;\nNODE_BLUEPRINT_PROPERTY_MAP['checked'] = checked_property;\nNODE_BLUEPRINT_PROPERTY_MAP['class'] = class_property;\nNODE_BLUEPRINT_PROPERTY_MAP['disabled'] = disabled_property;\nNODE_BLUEPRINT_PROPERTY_MAP['if'] = if_property;\nNODE_BLUEPRINT_PROPERTY_MAP['module'] = module_property;\nNODE_BLUEPRINT_PROPERTY_MAP['on'] = on_property;\nNODE_BLUEPRINT_PROPERTY_MAP['repeat'] = repeat_property;\nNODE_BLUEPRINT_PROPERTY_MAP['selected'] = selected_property;\nNODE_BLUEPRINT_PROPERTY_MAP['style'] = style_property;\nNODE_BLUEPRINT_PROPERTY_MAP['style_3'] = style_3_property;\nNODE_BLUEPRINT_PROPERTY_MAP['style_8'] = style_8_property;\nNODE_BLUEPRINT_PROPERTY_MAP['value.config'] = value_config_property;\nNODE_BLUEPRINT_PROPERTY_MAP['value'] = value_property;\nNODE_BLUEPRINT_PROPERTY_MAP['visible'] = visible_property;\nNODE_BLUEPRINT_PROPERTY_MAP['_create'] = {\n  type: 'prop',\n  key: '_create',\n  getSetter: () => EMPTY_CALL\n};\n\nNODE_BLUEPRINT_PROPERTY_MAP['_render'] = {\n  type: 'prop',\n  key: '_render',\n  getSetter: () => EMPTY_CALL\n};\n\nNODE_BLUEPRINT_PROPERTY_MAP['_destroy'] = {\n  type: 'prop',\n  key: '_destroy',\n  getSetter: () => EMPTY_CALL\n};\n\nNODE_BLUEPRINT_PROPERTY_MAP['renderConfig'] = {\n  type: 'prop',\n  key: 'renderConfig'\n};\n\nconst REFERENCE_TO_THIS = {\n  value: this,\n  configurable: false,\n  enumerable: false\n};\n\nconst __NODE__ = {\n  value: null,\n  configurable: false,\n  enumerable: false,\n  writable: true\n};\n\nfunction insert_before(parentNode, newNode, referenceNode) {\n  parentNode.insertBefore(newNode, referenceNode);\n}\n\nfunction remove_child(node, child) {\n  node.removeChild(child);\n}\n\nfunction remove_self(destroy) {\n  const viewNode = this;\n\n  if (destroy) {\n    // Destroy\n    viewNode.node.parentNode && remove_child(viewNode.node.parentNode, viewNode.node);\n    viewNode.placeholder.parentNode && remove_child(viewNode.placeholder.parentNode, viewNode.placeholder);\n    viewNode.garbage.forEach(function (node) {\n      remove_self.call(node, true);\n    });\n    viewNode.hasBeenDestroyed();\n  } else {\n    // Detach\n    if (!viewNode.placeholder.parentNode) {\n      insert_before(viewNode.node.parentNode, viewNode.placeholder, viewNode.node);\n    }\n\n    if (viewNode.node.parentNode) {\n      remove_child(viewNode.node.parentNode, viewNode.node);\n    }\n\n    viewNode.garbage.forEach(function (node) {\n      remove_self.call(node, true);\n    });\n  }\n\n  viewNode.garbage = [];\n}\n\n/**\n *\n * @typedef {Object} RenderConfig\n * @property {boolean} [applyClassListAfterRender] - Indicates whether classlist applies after the render.\n * @property {boolean} [renderDetached] - Make the node to be rendered in a detached mode.\n */\n\n/**\n *\n * @type {RenderConfig}\n */\nViewNode.GLOBAL_RENDER_CONFIG = {\n  applyClassListAfterRender: false,\n  renderDetached: false\n};\n\n/**\n *\n * @param blueprints\n * @memberOf Galaxy.ViewNode\n * @static\n */\nViewNode.cleanReferenceNode = function (blueprints) {\n  if (blueprints instanceof Array) {\n    blueprints.forEach(function (node) {\n      ViewNode.cleanReferenceNode(node);\n    });\n  } else if (blueprints instanceof Object) {\n    blueprints.node = null;\n    ViewNode.cleanReferenceNode(blueprints.children);\n  }\n};\n\nViewNode.createIndex = function (i) {\n  if (i < 0) return '0';\n  if (i < 10) return i + '';\n\n  let r = '9';\n  let res = i - 10;\n  while (res >= 10) {\n    r += '9';\n    res -= 10;\n  }\n\n  return r + res;\n};\n\n/**\n * @typedef {Object} Blueprint\n * @memberOf Galaxy\n * @property {RenderConfig} [renderConfig]\n * @property {string|Node} [tag]\n * @property {function} [_create]\n * @property {function} [_render]\n * @property {function} [_destroy]\n */\n\n/**\n *\n * @param {Blueprint} blueprint\n * @param {Galaxy.ViewNode|null} parent\n * @param {Galaxy.View} view\n * @param {any} [nodeData]\n * @constructor\n * @memberOf Galaxy\n */\nfunction ViewNode(blueprint, parent, view, nodeData) {\n  const _this = this;\n  _this.view = view;\n  if (blueprint.tag instanceof Node) {\n    _this.node = blueprint.tag;\n    blueprint.tag = blueprint.tag.tagName;\n  } else {\n    _this.node = create_elem(blueprint.tag || 'div', parent);\n  }\n\n  // if node does not have style property, then it doesn't have processEnterAnimation\n  if (!('style' in _this.node)) {\n    _this.processEnterAnimation = EMPTY_CALL;\n  }\n\n  /**\n   *\n   * @type {Blueprint}\n   */\n  _this.blueprint = blueprint;\n  _this.data = nodeData instanceof Scope ? {} : nodeData;\n  _this.localPropertyNames = new Set();\n  _this.inputs = {};\n  _this.virtual = false;\n  _this.visible = true;\n  _this.placeholder = create_comment(blueprint.tag || 'div');\n  _this.properties = new Set();\n  _this.inDOM = false;\n  _this.setters = {};\n  _this.parent = parent;\n  _this.finalize = [];\n  _this.origin = false;\n  _this.destroyOrigin = 0;\n  _this.transitory = false;\n  _this.garbage = [];\n  _this.leaveWithParent = false;\n  _this.onLeaveComplete = remove_self.bind(_this, true);\n\n  const cache = {};\n  def_prop(_this, 'cache', {\n    enumerable: false,\n    configurable: false,\n    value: cache\n  });\n\n  _this.rendered = new Promise(function (done) {\n    if ('style' in _this.node) {\n      _this.hasBeenRendered = function () {\n        _this.rendered.resolved = true;\n        _this.node.style.removeProperty('display');\n        if (_this.blueprint._render) {\n          _this.blueprint._render.call(_this, _this.data);\n        }\n        done(_this);\n      };\n    } else {\n      _this.hasBeenRendered = function () {\n        _this.rendered.resolved = true;\n        done();\n      };\n    }\n  });\n  _this.rendered.resolved = false;\n\n  _this.destroyed = new Promise(function (done) {\n    _this.hasBeenDestroyed = function () {\n      _this.destroyed.resolved = true;\n      if (_this.blueprint._destroy) {\n        _this.blueprint._destroy.call(_this, _this.data);\n      }\n      done();\n    };\n  });\n  _this.destroyed.resolved = false;\n\n  /**\n   *\n   * @type {RenderConfig}\n   */\n  _this.blueprint.renderConfig = Object.assign({}, ViewNode.GLOBAL_RENDER_CONFIG, blueprint.renderConfig || {});\n\n  __NODE__.value = this.node;\n  def_prop(_this.blueprint, 'node', __NODE__);\n\n  REFERENCE_TO_THIS.value = this;\n  if (!_this.node.__vn__) {\n    def_prop(_this.node, '__vn__', REFERENCE_TO_THIS);\n    def_prop(_this.placeholder, '__vn__', REFERENCE_TO_THIS);\n  }\n\n  if (_this.blueprint._create) {\n    _this.blueprint._create.call(_this, _this.data);\n  }\n}\n\nViewNode.prototype = {\n  onLeaveComplete: null,\n\n  dump: function () {\n    let original = this.parent;\n    let targetGarbage = this.garbage;\n    // Find the garbage of the origin if\n    while (original.transitory) {\n      if (original.blueprint.hasOwnProperty('if') && !this.blueprint.hasOwnProperty('if')) {\n        targetGarbage = original.garbage;\n      }\n      if (original.parent && original.parent.transitory) {\n        original = original.parent;\n      } else {\n        break;\n      }\n    }\n    targetGarbage.push(this);\n\n    this.garbage = [];\n  },\n  query: function (selectors) {\n    return this.node.querySelector(selectors);\n  },\n\n  dispatchEvent: function (event) {\n    this.node.dispatchEvent(event);\n  },\n\n  cloneBlueprint: function () {\n    const blueprintClone = Object.assign({}, this.blueprint);\n    ViewNode.cleanReferenceNode(blueprintClone);\n\n    def_prop(blueprintClone, 'mother', {\n      value: this.blueprint,\n      writable: false,\n      enumerable: false,\n      configurable: false\n    });\n\n    return blueprintClone;\n  },\n\n  virtualize: function () {\n    this.placeholder.nodeValue = JSON.stringify(this.blueprint, (k, v) => {\n      return k === 'children' ? '<children>' : k === 'animations' ? '<animations>' : v;\n    }, 2);\n    this.virtual = true;\n    this.setInDOM(false);\n  },\n\n  processEnterAnimation: function () {\n    this.node.style.display = null;\n  },\n\n  processLeaveAnimation: EMPTY_CALL,\n\n  populateHideSequence: function () {\n    this.node.style.display = 'none';\n  },\n\n  /**\n   *\n   * @param {boolean} flag\n   */\n  setInDOM: function (flag) {\n    const _this = this;\n    if (_this.blueprint.renderConfig.renderDetached) {\n      create_in_next_frame(_this.index, (_next) => {\n        _this.blueprint.renderConfig.renderDetached = false;\n        _this.hasBeenRendered();\n        _next();\n      });\n      return;\n    }\n\n    _this.inDOM = flag;\n    if (_this.virtual) return;\n\n    if (flag) {\n      if ('style' in _this.node) {\n        _this.node.style.setProperty('display', 'none');\n      }\n\n      if (!_this.node.parentNode) {\n        insert_before(_this.placeholder.parentNode, _this.node, _this.placeholder.nextSibling);\n      }\n\n      if (_this.placeholder.parentNode) {\n        remove_child(_this.placeholder.parentNode, _this.placeholder);\n      }\n\n      create_in_next_frame(_this.index, (_next) => {\n        _this.hasBeenRendered();\n        _this.processEnterAnimation();\n        _next();\n      });\n\n      const children = _this.getChildNodesAsc();\n      const len = children.length;\n      for (let i = 0; i < len; i++) {\n        // console.log(children[i].node);\n        children[i].setInDOM(true);\n      }\n    } else if (!flag && _this.node.parentNode) {\n      _this.origin = true;\n      _this.transitory = true;\n      const defaultProcessLeaveAnimation = _this.processLeaveAnimation;\n      const children = _this.getChildNodes();\n      _this.prepareLeaveAnimation(_this.hasAnimation(children), children);\n      destroy_in_next_frame(_this.index, (_next) => {\n        _this.processLeaveAnimation(remove_self.bind(_this, false));\n        _this.origin = false;\n        _this.transitory = false;\n        _this.processLeaveAnimation = defaultProcessLeaveAnimation;\n        _next();\n      });\n    }\n  },\n\n  setVisibility: function (flag) {\n    const _this = this;\n    _this.visible = flag;\n\n    if (flag && !_this.virtual) {\n      create_in_next_frame(_this.index, (_next) => {\n        _this.node.style.display = null;\n        _this.processEnterAnimation();\n        _next();\n      });\n    } else if (!flag && _this.node.parentNode) {\n      _this.origin = true;\n      _this.transitory = true;\n      destroy_in_next_frame(_this.index, (_next) => {\n        _this.populateHideSequence();\n        _this.origin = false;\n        _this.transitory = false;\n        _next();\n      });\n    }\n  },\n\n  /**\n   *\n   * @param {Galaxy.ViewNode} childNode\n   * @param position\n   */\n  registerChild: function (childNode, position) {\n    this.node.insertBefore(childNode.placeholder, position);\n  },\n\n  createNode: function (blueprint, localScope) {\n    this.view.createNode(blueprint, localScope, this);\n  },\n\n  /**\n   * @param {string} propertyKey\n   * @param {Galaxy.View.ReactiveData} reactiveData\n   * @param {Function} expression\n   */\n  registerActiveProperty: function (propertyKey, reactiveData, expression) {\n    this.properties.add(reactiveData);\n    activate_property_for_node(this, propertyKey, reactiveData, expression);\n  },\n\n  snapshot: function (animations) {\n    const rect = this.node.getBoundingClientRect();\n    const node = this.node.cloneNode(true);\n    const style = {\n      margin: '0',\n      width: rect.width + 'px',\n      height: rect.height + ' px',\n      top: rect.top + 'px',\n      left: rect.left + 'px',\n      position: 'fixed',\n    };\n    Object.assign(node.style, style);\n\n    return {\n      tag: node,\n      style: style\n    };\n  },\n\n  hasAnimation: function (children) {\n    if (this.processLeaveAnimation && this.processLeaveAnimation !== EMPTY_CALL) {\n      return true;\n    }\n\n    for (let i = 0, len = children.length; i < len; i++) {\n      const node = children[i];\n      if (node.hasAnimation(node.getChildNodes())) {\n        return true;\n      }\n    }\n\n    return false;\n  },\n\n  prepareLeaveAnimation: function (hasAnimation, children) {\n    const _this = this;\n\n    if (hasAnimation) {\n      if (_this.processLeaveAnimation === EMPTY_CALL) {\n        if (_this.origin) {\n          _this.processLeaveAnimation = function () {\n            remove_self.call(_this, false);\n          };\n        }\n          // if a child has an animation and this node is being removed directly, then we need to remove this node\n        // in order for element to get removed properly\n        else if (_this.destroyOrigin === 1) {\n          remove_self.call(_this, true);\n        }\n      } else if (_this.processLeaveAnimation !== EMPTY_CALL && !_this.origin) {\n        // Children with leave animation should not get removed from dom for visual purposes.\n        // Since their this node already has a leave animation and eventually will be removed from dom.\n        // this is not the case for when this node is being detached by if\n        // const children = _this.getChildNodes();\n        for (let i = 0, len = children.length; i < len; i++) {\n          children[i].onLeaveComplete = EMPTY_CALL;\n        }\n      }\n    } else {\n      _this.processLeaveAnimation = function () {\n        remove_self.call(_this, !_this.origin);\n      };\n    }\n  },\n\n  destroy: function (hasAnimation) {\n    const _this = this;\n    _this.transitory = true;\n    if (_this.parent.destroyOrigin === 0) {\n      // destroy() has been called on this node\n      _this.destroyOrigin = 1;\n    } else {\n      // destroy() has been called on a parent node\n      _this.destroyOrigin = 2;\n    }\n\n    if (_this.inDOM) {\n      const children = _this.getChildNodes();\n      hasAnimation = hasAnimation || _this.hasAnimation(children);\n      _this.prepareLeaveAnimation(hasAnimation, children);\n      _this.clean(hasAnimation, children);\n    }\n\n    _this.properties.forEach((reactiveData) => reactiveData.removeNode(_this));\n    let len = _this.finalize.length;\n    for (let i = 0; i < len; i++) {\n      _this.finalize[i].call(_this);\n    }\n\n    destroy_in_next_frame(_this.index, (_next) => {\n      _this.processLeaveAnimation(_this.destroyOrigin === 2 ? EMPTY_CALL : _this.onLeaveComplete);\n      _this.localPropertyNames.clear();\n      _this.properties.clear();\n      _this.finalize = [];\n      _this.inDOM = false;\n      _this.inputs = {};\n      _this.view = null;\n      _this.parent = null;\n      Reflect.deleteProperty(_this.blueprint, 'node');\n      _next();\n    });\n  },\n\n  getChildNodes: function () {\n    const nodes = [];\n    const cn = arr_slice.call(this.node.childNodes, 0);\n    for (let i = cn.length - 1; i >= 0; i--) {\n      // All the nodes that are ViewNode\n      const node = cn[i];\n      if ('__vn__' in node) {\n        nodes.push(node['__vn__']);\n      }\n    }\n\n    return nodes;\n  },\n\n  getChildNodesAsc: function () {\n    const nodes = [];\n    const cn = arr_slice.call(this.node.childNodes, 0);\n    for (let i = 0; i < cn.length; i++) {\n      // All the nodes that are ViewNode\n      const node = cn[i];\n      if ('__vn__' in node) {\n        nodes.push(node['__vn__']);\n      }\n    }\n\n    return nodes;\n  },\n\n  /**\n   *\n   */\n  clean: function (hasAnimation, children) {\n    children = children || this.getChildNodes();\n    destroy_nodes(children, hasAnimation);\n\n    destroy_in_next_frame(this.index, (_next) => {\n      let len = this.finalize.length;\n      for (let i = 0; i < len; i++) {\n        this.finalize[i].call(this);\n      }\n      this.finalize = [];\n      _next();\n    });\n  },\n\n  createNext: function (act) {\n    create_in_next_frame(this.index, act);\n  },\n\n  get index() {\n    const parent = this.parent;\n\n    // This solution is very performant but might not be reliable\n    if (parent) {\n      let prevNode = this.placeholder.parentNode ? this.placeholder.previousSibling : this.node.previousSibling;\n      if (prevNode) {\n        if (!prevNode.hasOwnProperty('__index__')) {\n          let i = 0;\n          let node = this.node;\n          while ((node = node.previousSibling) !== null) ++i;\n          prevNode.__index__ = i;\n        }\n        this.node.__index__ = prevNode.__index__ + 1;\n      } else {\n        this.node.__index__ = 0;\n      }\n\n      return parent.index + ',' + ViewNode.createIndex(this.node.__index__);\n    }\n\n    return '0';\n  },\n\n  get anchor() {\n    if (this.inDOM) {\n      return this.node;\n    }\n\n    return this.placeholder;\n  }\n};\n\nexport default ViewNode;\n","import { set_prop } from '../view.js';\n\nexport default function prop_setter(viewNode, property, expression) {\n  const propName = property.key;\n  const updateFn = property.update || set_prop;\n  const setter = create_prop_setter(updateFn, viewNode, propName);\n  if (expression) {\n    return function P_EXP() {\n      const expressionValue = expression();\n      setter(expressionValue);\n    };\n  }\n\n  return setter;\n};\n\nfunction create_prop_setter(updateFn, viewNode, propName) {\n  return function P(value) {\n    if (value instanceof Promise) {\n      const asyncCall = function (asyncValue) {\n        updateFn(viewNode, asyncValue, propName);\n      };\n      value.then(asyncCall).catch(asyncCall);\n    } else if (value instanceof Function) {\n      const result = value.call(viewNode, viewNode.data);\n      updateFn(viewNode, result, propName);\n    } else {\n      updateFn(viewNode, value, propName);\n    }\n  };\n}\n","import { set_attr } from '../view.js';\n\nexport default function attr_setter(viewNode, property, expression) {\n  const attrName = property.key;\n  const updateFn = property.update || set_attr;\n  const setter = create_attr_setter(updateFn, viewNode, attrName);\n\n  if (expression) {\n    return function A_EXP() {\n      const expressionValue = expression();\n      setter(expressionValue);\n    };\n  }\n\n  return setter;\n};\n\nfunction create_attr_setter(updateFn, viewNode, attrName) {\n  return function A(value) {\n    if (value instanceof Promise) {\n      const asyncCall = function (asyncValue) {\n        updateFn(viewNode, asyncValue, attrName);\n      };\n      value.then(asyncCall).catch(asyncCall);\n    } else if (value instanceof Function) {\n      const result = value.call(viewNode, viewNode.data);\n      updateFn(viewNode, result, attrName);\n    } else {\n      updateFn(viewNode, value, attrName);\n    }\n  };\n}\n","export default function reactive_setter (viewNode, property, expression, scope) {\n    const propertyName = property.key;\n    const updateFn = property.update;\n    const config = viewNode.cache[propertyName];\n\n    return create_reactive_setter(updateFn, viewNode, config, expression, scope);\n  };\n\n  function create_reactive_setter(updateFn, vn, config, expression, scope) {\n    const nodeUpdateFn = updateFn.bind(vn);\n    return function R(value) {\n      return nodeUpdateFn(config, value, expression, scope);\n    };\n  }\n","import ArrayChange from './array-change.js';\nimport ViewNode from './view-node.js';\nimport Observer from './observer.js';\nimport Scope from './scope.js';\nimport { EMPTY_CALL } from './utils.js';\n\nconst ARRAY_PROTO = Array.prototype;\nconst ARRAY_MUTATOR_METHODS = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n];\n\nconst KEYS_TO_REMOVE_FOR_ARRAY = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse',\n  'changes',\n  '__rd__'\n];\nconst obj_keys = Object.keys;\nconst def_prop = Object.defineProperty;\nconst scope_builder = function (id) {\n  return {\n    id: id || 'Scope',\n    shadow: {},\n    data: {},\n    notify: function () {\n    },\n    notifyDown: function () {\n    },\n    sync: function () {\n    },\n    makeReactiveObject: function () {\n    },\n    addKeyToShadow: function () {\n    }\n  };\n};\n\nconst get_keys = function (obj) {\n  if (obj instanceof Array) {\n    const keys = ['length'];\n    if (obj.hasOwnProperty('changes')) {\n      keys.push('changes');\n    }\n    return keys;\n  } else {\n    return Object.keys(obj);\n  }\n};\n\nfunction create_array_value(arr, method, initialChanges) {\n  const originalMethod = ARRAY_PROTO[method];\n  return function array_value() {\n    const __rd__ = this.__rd__;\n\n    let i = arguments.length;\n    const args = new Array(i);\n    while (i--) {\n      args[i] = arguments[i];\n    }\n\n    const returnValue = originalMethod.apply(this, args);\n    const changes = new ArrayChange();\n    const _original = changes.original = arr;\n    changes.type = method;\n    changes.params = args;\n    changes.returnValue = returnValue;\n    changes.init = initialChanges;\n\n    switch (method) {\n      case 'push':\n      case 'reset':\n      case 'unshift':\n        const _length = _original.length - 1;\n        for (let i = 0, len = changes.params.length; i < len; i++) {\n          const item = changes.params[i];\n          if (item !== null && typeof item === 'object') {\n            new ReactiveData(_length + i, item, __rd__);\n          }\n        }\n        break;\n\n      case 'pop':\n      case 'shift':\n        if (returnValue !== null && typeof returnValue === 'object' && '__rd__' in returnValue) {\n          returnValue.__rd__.removeMyRef();\n        }\n        break;\n\n      case 'splice':\n        changes.params.slice(2).forEach(function (item) {\n          if (item !== null && typeof item === 'object') {\n            new ReactiveData(_original.indexOf(item), item, __rd__);\n          }\n        });\n        break;\n    }\n\n    // repeat reactive property uses array.changes to detect the type of the mutation on array and react properly.\n    arr.changes = changes;\n    __rd__.notifyDown('length');\n    __rd__.notifyDown('changes');\n    __rd__.notify(__rd__.keyInParent, this);\n\n    return returnValue;\n  };\n}\n\nconst SYNC_NODE = {\n  _(node, key, value) {\n    // Pass a copy of the ArrayChange to every bound\n    if (value instanceof ArrayChange) {\n      value = value.getInstance();\n    }\n\n    if (node instanceof ViewNode) {\n      node.setters[key](value);\n    } else {\n      node[key] = value;\n    }\n\n    Observer.notify(node, key, value);\n  },\n  self(node, key, value, sameObjectValue, fromChild) {\n    if (fromChild || sameObjectValue)\n      return;\n\n    SYNC_NODE._(node, key, value);\n  },\n  props(node, key, value, sameObjectValue, fromChild) {\n    if (!fromChild)\n      return;\n\n    SYNC_NODE._(node, key, value);\n  },\n};\n\nfunction NodeMap() {\n  this.keys = [];\n  this.nodes = [];\n  this.types = [];\n}\n\n/**\n *\n * @param nodeKey\n * @param node\n * @param bindType\n */\nNodeMap.prototype.push = function (nodeKey, node, bindType) {\n  this.keys.push(nodeKey);\n  this.nodes.push(node);\n  this.types.push(bindType);\n};\n\n/**\n * @param {string|number|null} id\n * @param {Object} data\n * @param {Galaxy.View.ReactiveData} p\n * @constructor\n * @memberOf Galaxy.View\n */\nfunction ReactiveData(id, data, p) {\n  const parent = p instanceof ReactiveData ? p : scope_builder(p);\n  this.data = data;\n  this.id = parent.id + (id ? '.' + id : '|Scope');\n  this.keyInParent = id;\n  this.nodesMap = Object.create(null);\n  this.parent = parent;\n  this.refs = [];\n  this.shadow = Object.create(null);\n  this.nodeCount = -1;\n\n  if (this.data && this.data.hasOwnProperty('__rd__')) {\n    this.refs = this.data.__rd__.refs;\n    const refExist = this.getRefById(this.id);\n    if (refExist) {\n      // Sometimes an object is already reactive, but its parent is dead, meaning all references to it are lost\n      // In such a case that parent con be replace with a live parent\n      if (refExist.parent.isDead) {\n        refExist.parent = parent;\n      }\n\n      this.fixHierarchy(id, refExist);\n      return refExist;\n    }\n\n    this.refs.push(this);\n  } else {\n    this.refs.push(this);\n    // data === null means that parent does not have this id\n    if (this.data === null) {\n      // if a property with same id already exist in the parent shadow, then return it instead of making a new one\n      if (this.parent.shadow[id]) {\n        return this.parent.shadow[id];\n      }\n\n      this.data = {};\n      if (this.parent.data[id]) {\n        new ReactiveData(id, this.parent.data[id], this.parent);\n      } else {\n        this.parent.makeReactiveObject(this.parent.data, id, true);\n      }\n    }\n\n    if (!Object.isExtensible(this.data)) {\n      return;\n    }\n\n    def_prop(this.data, '__rd__', {\n      enumerable: false,\n      configurable: true,\n      value: this\n    });\n\n    if (this.data instanceof Scope || this.data.__scope__) {\n      this.addKeyToShadow = EMPTY_CALL;\n    }\n\n    if (this.data instanceof Scope) {\n      this.walkOnScope(this.data);\n    } else {\n      this.walk(this.data);\n    }\n  }\n\n  this.fixHierarchy(id, this);\n}\n\nReactiveData.prototype = {\n  get isDead() {\n    return this.nodeCount === 0 && this.refs.length === 1 && this.refs[0] === this;\n  },\n  // If parent data is an array, then this would be an item inside the array\n  // therefore its keyInParent should NOT be its index in the array but the\n  // array's keyInParent. This way we redirect each item in the array to the\n  // array's reactive data\n  fixHierarchy: function (id, reference) {\n    if (this.parent.data instanceof Array) {\n      this.keyInParent = this.parent.keyInParent;\n    } else {\n      this.parent.shadow[id] = reference;\n    }\n  },\n  setData: function (data) {\n    this.removeMyRef();\n\n    if (!(data instanceof Object)) {\n      this.data = {};\n\n      for (let key in this.shadow) {\n        // Cascade changes down to all children reactive data\n        if (this.shadow[key] instanceof ReactiveData) {\n          this.shadow[key].setData(data);\n        } else {\n          // changes should only propagate downward\n          this.notifyDown(key);\n        }\n      }\n\n      return;\n    }\n\n    this.data = data;\n    if (data.hasOwnProperty('__rd__')) {\n      this.data.__rd__.addRef(this);\n      this.refs = this.data.__rd__.refs;\n\n      if (this.data instanceof Array) {\n        this.sync('length', this.data.length, false, false);\n        this.sync('changes', this.data.changes, false, false);\n      } else {\n        this.syncAll();\n      }\n    } else {\n      def_prop(this.data, '__rd__', {\n        enumerable: false,\n        configurable: true,\n        value: this\n      });\n\n      this.walk(this.data);\n    }\n\n    this.setupShadowProperties(get_keys(this.data));\n  },\n  /**\n   *\n   * @param data\n   */\n  walk: function (data) {\n    if (data instanceof Node) return;\n\n    if (data instanceof Array) {\n      this.makeReactiveArray(data);\n    } else if (data instanceof Object) {\n      for (let key in data) {\n        this.makeReactiveObject(data, key, false);\n      }\n    }\n  },\n\n  walkOnScope: function (scope) {\n    // this.makeReactiveObject(scope, 'data');\n  },\n  /**\n   *\n   * @param data\n   * @param {string} key\n   * @param shadow\n   */\n  makeReactiveObject: function (data, key, shadow) {\n    let value = data[key];\n    if (typeof value === 'function') {\n      return;\n    }\n\n    const property = Object.getOwnPropertyDescriptor(data, key);\n    const getter = property && property.get;\n    const setter = property && property.set;\n\n    def_prop(data, key, {\n      get: function () {\n        return getter ? getter.call(data) : value;\n      },\n      set: function (val) {\n        const thisRD = data.__rd__;\n        setter && setter.call(data, val);\n        if (value === val) {\n          // If value is array, then sync should be called so nodes that are listening to array itself get updated\n          if (val instanceof Array) {\n            thisRD.sync(key, val, true, false);\n          } else if (val instanceof Object) {\n            thisRD.notifyDown(key);\n          }\n\n          return;\n        }\n\n        value = val;\n\n        // This means that the property suppose to be an object and there is probably an active binds to it\n        // the active bind could be in one of the ref, so we have to check all the ref shadows\n        for (let i = 0, len = thisRD.refs.length; i < len; i++) {\n          const ref = thisRD.refs[i];\n          if (ref.shadow[key]) {\n            ref.makeKeyEnum(key);\n            // setData provide downward data flow\n            ref.shadow[key].setData(val);\n          }\n        }\n\n        thisRD.notify(key, value);\n      },\n      enumerable: !shadow,\n      configurable: true\n    });\n\n    if (this.shadow[key]) {\n      this.shadow[key].setData(value);\n    } else {\n      this.shadow[key] = null;\n    }\n\n    // Update the ui for this key\n    // This is for when the makeReactive method has been called by setData\n    this.sync(key, value, false, false);\n  },\n  /**\n   *\n   * @param arr\n   * @returns {*}\n   */\n  makeReactiveArray: function (arr) {\n    if (arr.hasOwnProperty('changes')) {\n      return arr.changes.init;\n    }\n\n    const _this = this;\n    const initialChanges = new ArrayChange();\n    initialChanges.original = arr;\n    initialChanges.type = 'reset';\n    initialChanges.params = arr;\n    for (let i = 0, len = initialChanges.params.length; i < len; i++) {\n      const item = initialChanges.params[i];\n      if (item !== null && typeof item === 'object') {\n        new ReactiveData(initialChanges.original.indexOf(item), item, _this);\n      }\n    }\n\n    _this.sync('length', arr.length, false, false);\n    initialChanges.init = initialChanges;\n    def_prop(arr, 'changes', {\n      enumerable: false,\n      configurable: false,\n      writable: true,\n      value: initialChanges\n    });\n\n    // We override all the array methods which mutate the array\n    ARRAY_MUTATOR_METHODS.forEach(function (method) {\n      def_prop(arr, method, {\n        value: create_array_value(arr, method, initialChanges),\n        writable: false,\n        configurable: true\n      });\n    });\n\n    return initialChanges;\n  },\n  /**\n   *\n   * @param {string} key\n   * @param {any} value\n   * @param refs\n   * @param {boolean} fromChild\n   */\n  notify: function (key, value, refs, fromChild) {\n    if (this.refs === refs) {\n      this.sync(key, value, false, fromChild);\n      return;\n    }\n\n    for (let i = 0, len = this.refs.length; i < len; i++) {\n      const ref = this.refs[i];\n      if (this === ref) {\n        continue;\n      }\n\n      ref.notify(key, value, this.refs, fromChild);\n    }\n\n    this.sync(key, value, false, fromChild);\n    for (let i = 0, len = this.refs.length; i < len; i++) {\n      const ref = this.refs[i];\n      const keyInParent = ref.keyInParent;\n      const refParent = ref.parent;\n      ref.parent.notify(keyInParent, refParent.data[keyInParent], null, true);\n    }\n  },\n\n  notifyDown: function (key) {\n    const value = this.data[key];\n    this.notifyRefs(key, value);\n    this.sync(key, value, false, false);\n  },\n\n  notifyRefs: function (key, value) {\n    for (let i = 0, len = this.refs.length; i < len; i++) {\n      const ref = this.refs[i];\n      if (this === ref) {\n        continue;\n      }\n\n      ref.notify(key, value, this.refs);\n    }\n  },\n  /**\n   *\n   * @param {string} propertyKey\n   * @param {*} value\n   * @param {boolean} sameValueObject\n   * @param {boolean} fromChild\n   */\n  sync: function (propertyKey, value, sameValueObject, fromChild) {\n    const _this = this;\n    const map = _this.nodesMap[propertyKey];\n    // notify the observers on the data\n    Observer.notify(_this.data, propertyKey, value);\n\n    if (map) {\n      for (let i = 0, len = map.nodes.length; i < len; i++) {\n        _this.syncNode(map.types[i], map.nodes[i], map.keys[i], value, sameValueObject, fromChild);\n      }\n    }\n  },\n  /**\n   *\n   */\n  syncAll: function () {\n    const _this = this;\n    const keys = obj_keys(_this.data);\n    for (let i = 0, len = keys.length; i < len; i++) {\n      _this.sync(keys[i], _this.data[keys[i]], false, false);\n    }\n  },\n  /**\n   *\n   * @param {string} bindType\n   * @param node\n   * @param {string} key\n   * @param {*} value\n   * @param {boolean} sameObjectValue\n   * @param {boolean} fromChild\n   */\n  syncNode: function (bindType, node, key, value, sameObjectValue, fromChild) {\n    SYNC_NODE[bindType].call(null, node, key, value, sameObjectValue, fromChild);\n  },\n  /**\n   *\n   * @param {Galaxy.View.ReactiveData} reactiveData\n   */\n  addRef: function (reactiveData) {\n    if (this.refs.indexOf(reactiveData) === -1) {\n      this.refs.push(reactiveData);\n    }\n  },\n  /**\n   *\n   * @param {Galaxy.View.ReactiveData} reactiveData\n   */\n  removeRef: function (reactiveData) {\n    const index = this.refs.indexOf(reactiveData);\n    if (index !== -1) {\n      this.refs.splice(index, 1);\n    }\n  },\n  /**\n   *\n   */\n  removeMyRef: function () {\n    if (!this.data || !this.data.hasOwnProperty('__rd__')) return;\n    // if I am not the original reference, then remove me from the refs\n    if (this.data.__rd__ !== this) {\n      this.refs = [this];\n      this.data.__rd__.removeRef(this);\n    }\n    // if I am the original reference and the only one, then remove the __rd__ and reactive functionalities\n    else if (this.refs.length === 1) {\n      const _data = this.data;\n      if (_data instanceof Array) {\n        for (const method of KEYS_TO_REMOVE_FOR_ARRAY) {\n          Reflect.deleteProperty(_data, method);\n        }\n      }\n      // This cause an issue since the properties are still reactive\n      // else if (_data instanceof Object) {\n      //   Reflect.deleteProperty(_data, '__rd__');\n      // }\n      // TODO: Should be tested as much as possible to make sure it works with no bug\n      // TODO: We either need to return the object to its original state or do nothing\n    }\n    // if I am the original reference and not the only one\n    else {\n      this.data.__rd__.removeRef(this);\n      const nextOwner = this.refs[0];\n      def_prop(this.data, '__rd__', {\n        enumerable: false,\n        configurable: true,\n        value: nextOwner\n      });\n\n      this.refs = [this];\n    }\n\n  },\n  /**\n   *\n   * @param {string} id\n   * @returns {*}\n   */\n  getRefById: function (id) {\n    return this.refs.filter(function (ref) {\n      return ref.id === id;\n    })[0];\n  },\n  /**\n   *\n   * @param {Galaxy.ViewNode} node\n   * @param {string} nodeKey\n   * @param {string} dataKey\n   * @param {string} bindType\n   * @param expression\n   */\n  addNode: function (node, nodeKey, dataKey, bindType, expression) {\n    let map = this.nodesMap[dataKey];\n    if (!map) {\n      map = this.nodesMap[dataKey] = new NodeMap();\n    }\n\n    bindType = bindType || '_';\n\n    if (this.nodeCount === -1) this.nodeCount = 0;\n\n    const index = map.nodes.indexOf(node);\n    // Check if the node with the same property already exist\n    // Ensure that same node with different property bind can exist\n    if (index === -1 || map.keys[index] !== nodeKey) {\n      this.nodeCount++;\n      if (node instanceof ViewNode && !node.setters[nodeKey]) {\n        node.registerActiveProperty(nodeKey, this, expression);\n      }\n\n      map.push(nodeKey, node, bindType);\n\n      // map.keys.push(nodeKey);\n      // map.nodes.push(node);\n      // map.types.push(bindType);\n\n      let initValue = this.data[dataKey];\n      // if the value is an instance of Array, then we should set its change property to its initial state\n      if (initValue instanceof Array && initValue.changes) {\n        if (initValue.hasOwnProperty('changes')) {\n          initValue.changes = initValue.changes.init;\n        } else {\n          def_prop(initValue, 'changes', {\n            enumerable: false,\n            configurable: false,\n            writable: true,\n            value: initValue.changes.init\n          });\n        }\n      }\n\n      // if initValue is a change object, then we have to use its init for nodes that are newly being added\n      // if the dataKey is length then ignore this line and use initValue which represent the length of array\n      if (this.data instanceof Array && dataKey !== 'length' && initValue) {\n        initValue = initValue.init;\n      }\n\n      this.syncNode('_', node, nodeKey, initValue, false, false);\n    }\n  },\n  /**\n   *\n   * @param node\n   */\n  removeNode: function (node) {\n    for (let i = 0, len = this.refs.length; i < len; i++) {\n      this.removeNodeFromRef(this.refs[i], node);\n    }\n  },\n  /**\n   *\n   * @param ref\n   * @param node\n   */\n  removeNodeFromRef: function (ref, node) {\n    let map;\n    for (let key in ref.nodesMap) {\n      map = ref.nodesMap[key];\n\n      let index = -1;\n      while ((index = map.nodes.indexOf(node)) !== -1) {\n        map.nodes.splice(index, 1);\n        map.keys.splice(index, 1);\n        map.types.splice(index, 1);\n        this.nodeCount--;\n      }\n    }\n  },\n  /**\n   *\n   * @param {string} key\n   * @param {boolean} isArray\n   */\n  addKeyToShadow: function (key, isArray) {\n    // Don't empty the shadow object if it exists\n    if (!(key in this.shadow)) {\n      if (isArray) {\n        this.shadow[key] = new ReactiveData(key, [], this);\n      } else {\n        this.shadow[key] = null;\n      }\n    }\n\n    if (!this.data.hasOwnProperty(key)) {\n      this.makeReactiveObject(this.data, key, false);\n    }\n  },\n  /**\n   *\n   */\n  setupShadowProperties: function (keys) {\n    for (let key in this.shadow) {\n      // Only reactive properties should be added to data\n      if (this.shadow[key] instanceof ReactiveData) {\n        if (!this.data.hasOwnProperty(key)) {\n          this.makeReactiveObject(this.data, key, true);\n        }\n        this.shadow[key].setData(this.data[key]);\n      } else if (keys.indexOf(key) === -1) {\n        // This will make sure that UI is updated properly\n        // for properties that has been removed from data\n        this.sync(key, undefined, false, false);\n      }\n    }\n  },\n  /**\n   *\n   * @param {string} key\n   */\n  makeKeyEnum: function (key) {\n    const desc = Object.getOwnPropertyDescriptor(this.data, key);\n    if (desc && desc.enumerable === false) {\n      desc.enumerable = true;\n      def_prop(this.data, key, desc);\n    }\n  }\n};\n\nexport default ReactiveData;\n","import { arr_concat, clone, def_prop, EMPTY_CALL, obj_keys } from './utils.js';\nimport Scope from './scope.js';\nimport ViewNode from './view-node.js';\nimport ArrayChange from './array-change.js';\nimport { NODE_BLUEPRINT_PROPERTY_MAP, VALID_TAG_NAMES } from './constants.js';\nimport prop_setter from './setters/prop.js';\nimport attr_setter from './setters/attr.js';\nimport reactive_setter from './setters/reactive.js';\nimport { text_property, text_3_property, text_8_property } from './properties/text.property.js';\nimport { data_property } from './properties/data.reactive.js';\nimport { animations_property } from './properties/animations.property.js';\nimport { checked_property } from './properties/checked.property.js';\nimport { class_property } from './properties/class.reactive.js';\nimport { disabled_property } from './properties/disabled.property.js';\nimport { if_property } from './properties/if.reactive.js';\nimport { module_property } from './properties/module.reactive.js';\nimport { on_property } from './properties/on.property.js';\nimport { repeat_property } from './properties/repeat.reactive.js';\nimport { selected_property } from './properties/selected.property.js';\nimport { style_3_property, style_8_property, style_property } from './properties/style.reactive.js';\nimport { value_config_property, value_property } from './properties/value.property.js';\nimport { visible_property } from './properties/visible.reactive.js';\nimport ReactiveData from './reactive-data.js';\n\nconst ARG_BINDING_SINGLE_QUOTE_RE = /=\\s*'<([^\\[\\]<>]*)>(.*)'/m;\nconst ARG_BINDING_DOUBLE_QUOTE_RE = /=\\s*'=\\s*\"<([^\\[\\]<>]*)>(.*)\"/m;\nconst FUNCTION_HEAD_RE = /^\\(\\s*([^)]+?)\\s*\\)|^function.*\\(\\s*([^)]+?)\\s*\\)/m;\nconst BINDING_RE = /^<([^\\[\\]<>]*)>\\s*([^<>]*)\\s*$|^=\\s*([^\\[\\]<>]*)\\s*$/;\nconst PROPERTY_NAME_SPLITTER_RE = /\\.|\\[([^\\[\\]\\n]+)]|([^.\\n\\[\\]]+)/g;\n\nconst REACTIVE_BEHAVIORS = {};\n\nfor (const key in NODE_BLUEPRINT_PROPERTY_MAP) {\n  if (NODE_BLUEPRINT_PROPERTY_MAP[key].type === 'reactive') {\n    REACTIVE_BEHAVIORS[key] = true;\n  }\n}\n\nconst PROPERTY_SETTERS = {\n  'none': function () {\n    return EMPTY_CALL;\n  },\n  'prop': prop_setter,\n  'attr': attr_setter,\n  'reactive': reactive_setter\n};\n\nexport function max_index() {\n  return '@' + performance.now();\n}\n\n// let opt_count = 0;\n// const _next_batch = function (_jump, dirty) {\n//   if (dirty) {\n//     return _jump();\n//   }\n//\n//   if (opt_count > 233) {\n//     opt_count = 0;\n//     // console.log(performance.now());\n//     return requestAnimationFrame(() => {\n//       if (dirty) {\n//         return _jump();\n//       }\n//\n//       if (this.length) {\n//         this.shift()(_next_batch.bind(this, _jump));\n//       } else {\n//         _jump();\n//       }\n//     });\n//   }\n//\n//   opt_count++;\n//   if (this.length) {\n//     this.shift()(_next_batch.bind(this, _jump));\n//   } else {\n//     _jump();\n//   }\n// };\n\nfunction parse_bind_exp_string(propertyKey, clean) {\n  const matches = propertyKey.match(PROPERTY_NAME_SPLITTER_RE);\n  const result = matches.filter(a => a !== '' && a !== '.');\n\n  if (clean) {\n    return result.map(p => {\n      if (p.indexOf('[') === 0) {\n        return p.substring(1, p.length - 1);\n      }\n      return p;\n    });\n  }\n\n  return result;\n}\n\n/**\n *\n * @param data\n * @param {string} properties\n * @return {*}\n */\nfunction safe_property_lookup(data, properties) {\n  const propertiesArr = parse_bind_exp_string(properties, true);\n  let property = propertiesArr[0];\n  const original = data;\n  let target = data;\n  let temp = data;\n  // var nestingLevel = 0;\n  if (data[property] === undefined) {\n    while (temp.__parent__) {\n      if (temp.__parent__.hasOwnProperty(property)) {\n        target = temp.__parent__;\n        break;\n      }\n\n      temp = temp.__parent__;\n    }\n\n    // if the property is not found in the parents then return the original object as the context\n    if (target[property] === undefined) {\n      target = original;\n    }\n  }\n\n  target = target || {};\n  const lastIndex = propertiesArr.length - 1;\n  propertiesArr.forEach(function (key, i) {\n    target = target[key];\n\n    if (i !== lastIndex && !(target instanceof Object)) {\n      target = {};\n    }\n  });\n\n  if (target instanceof ArrayChange) {\n    return target.getInstance();\n  }\n\n  return target === undefined ? null : target;\n}\n\nconst dom_manipulation_table = View.DOM_MANIPLATION = {};\nconst create_order = [], destroy_order = [];\nlet dom_manipulation_order = [];\nlet manipulation_done = true, dom_manipulations_dirty = false;\nlet diff = 0, preTS = 0, too_many_jumps;\n\nconst next_action = function (_jump, dirty) {\n  if (dirty) {\n    return _jump();\n  }\n\n  if (this.length) {\n    this.shift()(next_action.bind(this, _jump));\n  } else {\n    _jump();\n  }\n};\n\nconst next_batch_body = function () {\n  if (this.length) {\n    let key = this.shift();\n    let batch = dom_manipulation_table[key];\n    if (!batch.length) {\n      return next_batch.call(this);\n    }\n\n    next_action.call(batch, next_batch.bind(this), dom_manipulations_dirty);\n  } else {\n    manipulation_done = true;\n    preTS = 0;\n    diff = 0;\n  }\n};\n\nconst next_batch = function () {\n  if (dom_manipulations_dirty) {\n    dom_manipulations_dirty = false;\n    diff = 0;\n    return next_batch.call(dom_manipulation_order);\n  }\n\n  const now = performance.now();\n  preTS = preTS || now;\n  diff = diff + (now - preTS);\n  preTS = now;\n\n  if (diff > 2) {\n    diff = 0;\n    if (too_many_jumps) {\n      clearTimeout(too_many_jumps);\n      too_many_jumps = null;\n    }\n\n    too_many_jumps = setTimeout((ts) => {\n      preTS = ts;\n      next_batch_body.call(this);\n    });\n  } else {\n    next_batch_body.call(this);\n  }\n};\n\nfunction comp_asc(a, b) {\n  return a > b;\n}\n\nfunction comp_desc(a, b) {\n  return a < b;\n}\n\nfunction binary_search(array, key, _fn) {\n  let start = 0;\n  let end = array.length - 1;\n  let index = 0;\n\n  while (start <= end) {\n    let middle = Math.floor((start + end) / 2);\n    let midVal = array[middle];\n\n    if (_fn(key, midVal)) {\n      // continue searching to the right\n      index = start = middle + 1;\n    } else {\n      // search searching to the left\n      index = middle;\n      end = middle - 1;\n    }\n  }\n\n  return index;\n}\n\nfunction pos_asc(array, el) {\n  if (el < array[0]) {\n    return 0;\n  }\n\n  if (el > array[array.length - 1]) {\n    return array.length;\n  }\n\n  return binary_search(array, el, comp_asc);\n}\n\nfunction pos_desc(array, el) {\n  if (el > array[0]) {\n    return 0;\n  }\n\n  if (el < array[array.length - 1]) {\n    return array.length;\n  }\n\n  return binary_search(array, el, comp_desc);\n}\n\nfunction add_dom_manipulation(index, act, order, search) {\n  if (index in dom_manipulation_table) {\n    dom_manipulation_table[index].push(act);\n  } else {\n    dom_manipulation_table[index] = [act];\n    order.splice(search(order, index), 0, index);\n  }\n}\n\nlet last_dom_manipulation_id = 0;\n\nfunction update_dom_manipulation_order() {\n  if (last_dom_manipulation_id !== 0) {\n    clearTimeout(last_dom_manipulation_id);\n    last_dom_manipulation_id = 0;\n  }\n\n  dom_manipulation_order = arr_concat(destroy_order, create_order);\n  last_dom_manipulation_id = setTimeout(() => {\n    if (manipulation_done) {\n      manipulation_done = false;\n      next_batch.call(dom_manipulation_order);\n    }\n  });\n}\n\n// function update_on_animation_frame() {\n//   if (last_dom_manipulation_id) {\n//     clearTimeout(last_dom_manipulation_id);\n//     last_dom_manipulation_id = null;\n//   }\n//\n//   dom_manipulation_order = arrConcat(destroy_order, create_order);\n//   last_dom_manipulation_id = setTimeout(() => {\n//     if (manipulation_done) {\n//       manipulation_done = false;\n//       next_batch.call(dom_manipulation_order);\n//     }\n//   });\n// }\n//\n// function update_on_timeout() {\n//   if (last_dom_manipulation_id) {\n//     cancelAnimationFrame(last_dom_manipulation_id);\n//     last_dom_manipulation_id = null;\n//   }\n//\n//   dom_manipulation_order = arrConcat(destroy_order, create_order);\n//   last_dom_manipulation_id = requestAnimationFrame(() => {\n//     if (manipulation_done) {\n//       manipulation_done = false;\n//       next_batch.call(dom_manipulation_order);\n//     }\n//   });\n// }\n\n/**\n *\n * @param {string} index\n * @param {Function} action\n * @memberOf Galaxy.View\n * @static\n */\nexport function destroy_in_next_frame(index, action) {\n  dom_manipulations_dirty = true;\n  add_dom_manipulation('<' + index, action, destroy_order, pos_desc);\n  update_dom_manipulation_order();\n}\n\n/**\n *\n * @param {string} index\n * @param {Function} action\n * @memberOf Galaxy.View\n * @static\n */\nexport function create_in_next_frame(index, action) {\n  dom_manipulations_dirty = true;\n  add_dom_manipulation('>' + index, action, create_order, pos_asc);\n  update_dom_manipulation_order();\n}\n\n/**\n *\n * @param {Array<Galaxy.ViewNode>} toBeRemoved\n * @param {boolean} hasAnimation\n * @memberOf Galaxy.View\n * @static\n */\nexport function destroy_nodes(toBeRemoved, hasAnimation) {\n  let remove = null;\n\n  for (let i = 0, len = toBeRemoved.length; i < len; i++) {\n    remove = toBeRemoved[i];\n    remove.destroy(hasAnimation);\n  }\n}\n\n/**\n *\n * @param {Galaxy.ViewNode} viewNode\n * @param value\n * @param name\n */\nexport function set_attr(viewNode, value, name) {\n  if (value !== null && value !== undefined && value !== false) {\n    viewNode.node.setAttribute(name, value === true ? '' : value);\n  } else {\n    viewNode.node.removeAttribute(name);\n  }\n}\n\nexport function set_prop(viewNode, value, name) {\n  viewNode.node[name] = value;\n}\n\nexport function create_child_scope(parent) {\n  let result = {};\n\n  def_prop(result, '__parent__', {\n    enumerable: false,\n    value: parent\n  });\n\n  def_prop(result, '__scope__', {\n    enumerable: false,\n    value: parent.__scope__ || parent\n  });\n\n  return result;\n}\n\n/**\n *\n * @param {string|Array} value\n * @return {{propertyKeys: *[], propertyValues: *[], bindTypes: *[], isExpression: boolean, expressionFn: null}}\n */\nexport function get_bindings(value) {\n  let propertyKeys = [];\n  let propertyValues = [];\n  let bindTypes = [];\n  let isExpression = false;\n  const valueType = typeof (value);\n  let expressionFunction = null;\n\n  if (valueType === 'string') {\n    const props = value.match(BINDING_RE);\n    if (props) {\n      bindTypes = [props[1]];\n      propertyKeys = [props[2]];\n      propertyValues = [value];\n    }\n  } else if (valueType === 'function') {\n    isExpression = true;\n    expressionFunction = value;\n    const matches = value.toString().match(FUNCTION_HEAD_RE);\n    if (matches) {\n      const args = matches[1] || matches [2];\n      propertyValues = args.split(',').map(a => {\n        const argDef = a.indexOf('\"') === -1 ? a.match(ARG_BINDING_SINGLE_QUOTE_RE) : a.match(ARG_BINDING_DOUBLE_QUOTE_RE);\n        if (argDef) {\n          bindTypes.push(argDef[1]);\n          propertyKeys.push(argDef[2]);\n          return '<>' + argDef[2];\n        } else {\n          return undefined;\n        }\n      });\n    }\n  }\n\n  return {\n    propertyKeys: propertyKeys,\n    propertyValues: propertyValues,\n    bindTypes: bindTypes,\n    handler: expressionFunction,\n    isExpression: isExpression,\n    expressionFn: null\n  };\n}\n\nexport function property_lookup(data, key) {\n  const propertiesArr = parse_bind_exp_string(key, true);\n  let firstKey = propertiesArr[0];\n  const original = data;\n  let target = data;\n  let temp = data;\n  let nestingLevel = 0;\n  let parent;\n  if (data[firstKey] === undefined) {\n    while (temp.__parent__) {\n      parent = temp.__parent__;\n      if (parent.hasOwnProperty(firstKey)) {\n        target = parent;\n        break;\n      }\n\n      if (nestingLevel++ >= 1000) {\n        throw Error('Maximum nested property lookup has reached `' + firstKey + '`\\n' + data);\n      }\n\n      temp = parent;\n    }\n\n    // if the property is not found in the parents then return the original object as the context\n    if (target[firstKey] === undefined) {\n      return original;\n    }\n  }\n\n  return target;\n};\n\n/**\n *\n * @param data\n * @param absoluteKey\n * @returns {Galaxy.View.ReactiveData}\n */\nexport function property_rd_lookup(data, absoluteKey) {\n  const keys = absoluteKey.split('.');\n  const li = keys.length - 1;\n  let target = data;\n  keys.forEach(function (p, i) {\n    target = property_lookup(target, p);\n\n    if (i !== li) {\n      if (!target[p]) {\n        const rd = target.__rd__.refs.filter(ref => ref.shadow[p])[0];\n        target = rd.shadow[p].data;\n      } else {\n        target = target[p];\n      }\n    }\n  });\n\n  return target.__rd__;\n}\n\nconst EXPRESSION_ARGS_FUNC_CACHE = {};\n\nexport function create_args_provider_fn(propertyValues) {\n  const id = propertyValues.join();\n\n  if (EXPRESSION_ARGS_FUNC_CACHE[id]) {\n    return EXPRESSION_ARGS_FUNC_CACHE[id];\n  }\n\n  let functionContent = 'return [';\n  let middle = [];\n  for (let i = 0, len = propertyValues.length; i < len; i++) {\n    const val = propertyValues[i];\n    if (typeof val === 'string') {\n      if (val.indexOf('<>this.') === 0) {\n        middle.push('_prop(this.data, \"' + val.replace('<>this.', '') + '\")');\n      } else if (val.indexOf('<>') === 0) {\n        middle.push('_prop(scope, \"' + val.replace('<>', '') + '\")');\n      }\n    } else {\n      middle.push('_var[' + i + ']');\n    }\n  }\n  functionContent += middle.join(',') + ']';\n\n  const func = new Function('scope, _prop , _var', functionContent);\n  EXPRESSION_ARGS_FUNC_CACHE[id] = func;\n\n  return func;\n}\n\nexport function create_expression_fn(host, scope, handler, keys, values) {\n  if (!values[0]) {\n    if (host instanceof ViewNode) {\n      values[0] = host.data;\n    } else {\n      values[0] = scope;\n    }\n  }\n\n  const getExpressionArguments = create_args_provider_fn(values);\n\n  return function () {\n    let args = [];\n    try {\n      args = getExpressionArguments.call(host, scope, safe_property_lookup, values);\n    } catch (ex) {\n      console.error('Can\\'t find the property: \\n' + keys.join('\\n'), '\\n\\nIt is recommended to inject the parent object instead' +\n        ' of its property.\\n\\n', scope, '\\n', ex);\n    }\n\n    return handler.apply(host, args);\n  };\n}\n\n/**\n *\n * @param bindings\n * @param target\n * @param scope\n * @returns {Function|boolean}\n */\nexport function get_expression_fn(bindings, target, scope) {\n  if (!bindings.isExpression) {\n    return false;\n  }\n\n  if (bindings.expressionFn) {\n    return bindings.expressionFn;\n  }\n\n  // Generate expression arguments\n  try {\n    bindings.expressionFn = create_expression_fn(target, scope, bindings.handler, bindings.propertyKeys, bindings.propertyValues);\n    return bindings.expressionFn;\n  } catch (exception) {\n    throw Error(exception.message + '\\n' + bindings.propertyKeys);\n  }\n}\n\n/**\n *\n * @param {Galaxy.ViewNode | Object} target\n * @param {String} targetKeyName\n * @param {Galaxy.View.ReactiveData} hostReactiveData\n * @param {Galaxy.View.ReactiveData} scopeData\n * @param {Object} bindings\n * @param {Galaxy.ViewNode | undefined} root\n */\nexport function make_binding(target, targetKeyName, hostReactiveData, scopeData, bindings, root) {\n  const propertyKeys = bindings.propertyKeys;\n  const expressionFn = get_expression_fn(bindings, root, scopeData);\n\n  let propertyScopeData = scopeData;\n  let propertyKey = null;\n  let childPropertyKeyPath = null;\n  let initValue = null;\n  let propertyKeyPathItems = [];\n  for (let i = 0, len = propertyKeys.length; i < len; i++) {\n    propertyKey = propertyKeys[i];\n    childPropertyKeyPath = null;\n    const bindType = bindings.bindTypes[i];\n    // let matches = propertyKey.match(PROPERTY_NAME_SPLITTER_RE);\n    // propertyKeyPathItems = matches.filter(a => a !== '' && a !== '.');\n    propertyKeyPathItems = parse_bind_exp_string(propertyKey);\n\n    if (propertyKeyPathItems.length > 1) {\n      propertyKey = propertyKeyPathItems[0];\n      childPropertyKeyPath = propertyKeyPathItems.slice(1).join('.');\n    }\n\n    if (!hostReactiveData && scopeData /*&& !(scopeData instanceof G.Scope)*/) {\n      if ('__rd__' in scopeData) {\n        hostReactiveData = scopeData.__rd__;\n      } else {\n        hostReactiveData = new ReactiveData(null, scopeData, scopeData instanceof Scope ? scopeData.systemId : 'child');\n      }\n    }\n\n    if (propertyKeyPathItems[0] === 'Scope') {\n      throw new Error('`Scope` keyword must be omitted when it is used  used in bindings: ' + propertyKeys.join('.'));\n    }\n\n    if (propertyKey.indexOf('[') === 0) {\n      propertyKey = propertyKey.substring(1, propertyKey.length - 1);\n    }\n\n    // If the property name is `this` and its index is zero, then it is pointing to the ViewNode.data property\n    if (propertyKeyPathItems[0] === 'this' && propertyKey === 'this' && root instanceof ViewNode) {\n      propertyKey = propertyKeyPathItems[1];\n      bindings.propertyKeys = propertyKeyPathItems.slice(2);\n      childPropertyKeyPath = null;\n      hostReactiveData = new ReactiveData('data', root.data, 'this');\n      propertyScopeData = property_lookup(root.data, propertyKey);\n    } else if (propertyScopeData) {\n      // Look for the property host object in scopeData hierarchy\n      propertyScopeData = property_lookup(propertyScopeData, propertyKey);\n    }\n\n    initValue = propertyScopeData;\n    if (propertyScopeData !== null && typeof propertyScopeData === 'object') {\n      initValue = propertyScopeData[propertyKey];\n    }\n\n    let reactiveData;\n    if (initValue instanceof Object) {\n      reactiveData = new ReactiveData(propertyKey, initValue, hostReactiveData || scopeData.__scope__.__rd__);\n    } else if (childPropertyKeyPath) {\n      reactiveData = new ReactiveData(propertyKey, null, hostReactiveData);\n    } else if (hostReactiveData) {\n      // if the propertyKey is used for a repeat reactive property, then we assume its type is Array.\n      hostReactiveData.addKeyToShadow(propertyKey, targetKeyName === 'repeat');\n    }\n\n    if (childPropertyKeyPath === null) {\n      if (!(target instanceof ViewNode)) {\n        def_prop(target, targetKeyName, {\n          set: function ref_set(newValue) {\n            // console.warn('It is not allowed', hostReactiveData, targetKeyName);\n            // Not sure about this part\n            // This will provide binding to primitive data types as well.\n            if (expressionFn) {\n              // console.log(newValue, target[targetKeyName], targetKeyName, propertyKey);\n              // console.warn('It is not allowed to set value for an expression', targetKeyName, newValue);\n              return;\n            }\n\n            if (hostReactiveData.data[propertyKey] === newValue) {\n              return;\n            }\n\n            hostReactiveData.data[propertyKey] = newValue;\n          },\n          get: function ref_get() {\n            if (expressionFn) {\n              return expressionFn();\n            }\n\n            return hostReactiveData.data[propertyKey];\n          },\n          enumerable: true,\n          configurable: true\n        });\n      }\n\n      if (hostReactiveData && scopeData instanceof Scope) {\n        // If the propertyKey is referring to some local value then there is no error\n        if (target instanceof ViewNode && target.localPropertyNames.has(propertyKey)) {\n          return;\n        }\n\n        // throw new Error('Binding to Scope direct properties is not allowed.\\n' +\n        //   'Try to define your properties on Scope.data.{property_name}\\n' + 'path: ' + scopeData.uri.parsedURL + '\\nProperty name: `' +\n        //   propertyKey + '`\\n');\n      }\n\n      hostReactiveData.addNode(target, targetKeyName, propertyKey, bindType, expressionFn);\n    }\n\n    if (childPropertyKeyPath !== null) {\n      make_binding(target, targetKeyName, reactiveData, initValue, Object.assign({}, bindings, { propertyKeys: [childPropertyKeyPath] }), root);\n    }\n  }\n}\n\n/**\n * Bind subjects to the data and takes care of dependent objects\n * @param viewNode\n * @param subjects\n * @param data\n * @param cloneSubject\n * @returns {*}\n */\nexport function bind_subjects_to_data(viewNode, subjects, data, cloneSubject) {\n  const keys = obj_keys(subjects);\n  let attributeName;\n  let attributeValue;\n  const subjectsClone = cloneSubject ? clone(subjects) : subjects;\n\n  let parentReactiveData;\n  if (!(data instanceof Scope)) {\n    parentReactiveData = new ReactiveData(null, data, 'BSTD');\n  }\n\n  for (let i = 0, len = keys.length; i < len; i++) {\n    attributeName = keys[i];\n    attributeValue = subjectsClone[attributeName];\n\n    // Object that have __singleton property will be ignored\n    if (attributeValue.__singleton__) {\n      continue;\n    }\n\n    // if (attributeValue instanceof Galaxy.Router) {\n    //   console.log(attributeName, attributeValue)\n    //   continue;\n    // }\n\n    const bindings = get_bindings(attributeValue);\n    if (bindings.propertyKeys.length) {\n      make_binding(subjectsClone, attributeName, parentReactiveData, data, bindings, viewNode);\n      if (viewNode) {\n        bindings.propertyKeys.forEach(function (path) {\n          try {\n            const rd = property_rd_lookup(data, path);\n            viewNode.finalize.push(() => {\n              rd.removeNode(subjectsClone);\n            });\n          } catch (error) {\n            console.error('bind_subjects_to_data -> Could not find: ' + path + '\\n in', data, error);\n          }\n        });\n      }\n    }\n\n    if (attributeValue && typeof attributeValue === 'object' && !(attributeValue instanceof Array)) {\n      bind_subjects_to_data(viewNode, attributeValue, data);\n    }\n  }\n\n  return subjectsClone;\n}\n\n/**\n *\n * @param {Galaxy.ViewNode} node\n * @param scopeData\n * @param {string} key\n * @param {any} value\n * @return boolean\n */\nexport function install_property_for_node(node, scopeData, key, value) {\n  if (key in REACTIVE_BEHAVIORS) {\n    if (value === null || value === undefined) {\n      return false;\n    }\n\n    const reactiveProperty = NODE_BLUEPRINT_PROPERTY_MAP[key];\n    const data = reactiveProperty.getConfig.call(node, scopeData, node.blueprint[key]);\n    if (data !== undefined) {\n      node.cache[key] = data;\n    }\n\n    return reactiveProperty.install.call(node, data);\n  }\n\n  return true;\n}\n\n/**\n *\n * @param viewNode\n * @param {string} propertyKey\n * @param {Galaxy.View.ReactiveData} scopeProperty\n * @param expression\n */\nexport function activate_property_for_node(viewNode, propertyKey, scopeProperty, expression) {\n  /**\n   *\n   * @type {Galaxy.View.BlueprintProperty}\n   */\n  const property = NODE_BLUEPRINT_PROPERTY_MAP[propertyKey] || { type: 'attr' };\n  property.key = property.key || propertyKey;\n  if (typeof property.beforeActivate !== 'undefined') {\n    property.beforeActivate(viewNode, scopeProperty, propertyKey, expression);\n  }\n\n  viewNode.setters[propertyKey] = get_property_setter_for_node(property, viewNode, scopeProperty, expression);\n}\n\n/**\n *\n * @param {Galaxy.View.BlueprintProperty} blueprintProperty\n * @param {Galaxy.ViewNode} viewNode\n * @param [scopeProperty]\n * @param {Function} [expression]\n * @returns {Galaxy.View.EMPTY_CALL|(function())}\n */\nexport function get_property_setter_for_node(blueprintProperty, viewNode, scopeProperty, expression) {\n  // if viewNode is virtual, then the expression should be ignored\n  if (blueprintProperty.type !== 'reactive' && viewNode.virtual) {\n    return EMPTY_CALL;\n  }\n  // This is the lowest level where the developer can modify the property setter behavior\n  // By defining 'createSetter' for the property you can implement your custom functionality for setter\n  if (typeof blueprintProperty.getSetter !== 'undefined') {\n    return blueprintProperty.getSetter(viewNode, blueprintProperty, blueprintProperty, expression);\n  }\n\n  return PROPERTY_SETTERS[blueprintProperty.type](viewNode, blueprintProperty, expression);\n}\n\n/**\n *\n * @param {Galaxy.ViewNode} viewNode\n * @param {string} propertyKey\n * @param {*} value\n */\nexport function set_property_for_node(viewNode, propertyKey, value) {\n  const bpKey = propertyKey + '_' + viewNode.node.nodeType;\n  let property = NODE_BLUEPRINT_PROPERTY_MAP[bpKey] || NODE_BLUEPRINT_PROPERTY_MAP[propertyKey];\n  if (!property) {\n    property = { type: 'prop' };\n    if (!(propertyKey in viewNode.node) && 'setAttribute' in viewNode.node) {\n      property = { type: 'attr' };\n    }\n\n    NODE_BLUEPRINT_PROPERTY_MAP[bpKey] = property;\n  }\n\n  property.key = property.key || propertyKey;\n\n  switch (property.type) {\n    case 'attr':\n    case 'prop':\n    case 'reactive':\n      get_property_setter_for_node(property, viewNode)(value, null);\n      break;\n\n    case 'event':\n      viewNode.node[propertyKey] = function (event) {\n        value.call(viewNode, event, viewNode.data);\n      };\n      break;\n  }\n}\n\nView.COMPONENTS = {};\n\n/**\n *\n * @param {Galaxy.Scope} scope\n * @constructor\n * @memberOf Galaxy\n */\nfunction View(scope) {\n  const _this = this;\n  _this.scope = scope;\n\n  if (scope.element instanceof ViewNode) {\n    _this.container = scope.element;\n    // Nested views should inherit components from their parent view\n    _this._components = Object.assign({}, scope.element.view._components);\n  } else {\n    _this.container = new ViewNode({\n      tag: scope.element\n    }, null, _this);\n\n    _this.container.setInDOM(true);\n  }\n}\n\nfunction TimelineControl(type) {\n  this.type = type;\n}\n\nTimelineControl.prototype.startKeyframe = function (timeline, position) {\n  if (!timeline) {\n    throw new Error('Argument Missing: view.' + this.type + '.startKeyframe(timeline:string) needs a `timeline`');\n  }\n\n  position = position || '+=0';\n\n  const animations = {\n    [this.type]: {\n      // keyframe: true,\n      to: {\n        data: 'timeline:start',\n        duration: 0.001\n      },\n      timeline,\n      position\n    }\n  };\n\n  return {\n    tag: 'comment',\n    text: ['', this.type + ':timeline:start', 'position: ' + position, 'timeline: ' + timeline, ''].join('\\n'),\n    animations\n  };\n};\n\nTimelineControl.prototype.keyframe = function (onComplete, timeline, position) {\n  if (!timeline) {\n    throw new Error('Argument Missing: view.' + this.type + '.addKeyframe(timeline:string) needs a `timeline`');\n  }\n\n  const animations = {\n    [this.type]: {\n      // keyframe: true,\n      to: {\n        duration: 0.001,\n        onComplete\n      },\n      timeline,\n      position,\n    }\n  };\n\n  return {\n    tag: 'comment',\n    text: this.type + ':timeline:keyframe',\n    animations\n  };\n};\n\nTimelineControl.prototype.waitKeyframe = function (timeline, position) {\n  if (!timeline) {\n    throw new Error('Argument Missing: view.' + this.type + '.addKeyframe(timeline:string) needs a `timeline`');\n  }\n\n  const animations = {\n    [this.type]: {\n      to: {\n        duration: 0.001\n      },\n      timeline,\n      position,\n    }\n  };\n\n  return {\n    tag: 'comment',\n    text: this.type + ':timeline:waitKeyframe',\n    animations\n  };\n};\n\nView.prototype = {\n  _components: {},\n  components: function (map) {\n    for (const key in map) {\n      const comp = map[key];\n      if (typeof comp !== 'function') {\n        throw new Error('Component must be type of function: ' + key);\n      }\n\n      this._components[key] = comp;\n    }\n  },\n  /**\n   *\n   */\n  entering: new TimelineControl('enter'),\n\n  leaving: new TimelineControl('leave'),\n\n  /**\n   *\n   * @param {string} key\n   * @param blueprint\n   * @param {Galaxy.Scope|Object} scopeData\n   * @returns {*}\n   */\n  getComponent: function (key, blueprint, scopeData) {\n    let componentScope = scopeData;\n    let componentBlueprint = blueprint;\n    if (key) {\n      if (key in this._components) {\n        if (blueprint.props && typeof blueprint.props !== 'object') {\n          throw new Error('The `props` must be a literal object.');\n        }\n\n        componentScope = create_child_scope(scopeData);\n        Object.assign(componentScope, blueprint.props || {});\n\n        bind_subjects_to_data(null, componentScope, scopeData);\n        componentBlueprint = this._components[key].call(null, componentScope, blueprint, this);\n        if (blueprint instanceof Array) {\n          throw new Error('A component\\'s blueprint can NOT be an array. A component must have only one root node.');\n        }\n      } else if (VALID_TAG_NAMES.indexOf(key) === -1) {\n        console.warn('Invalid component/tag: ' + key);\n      }\n    }\n\n    return {\n      blueprint: Object.assign(blueprint, componentBlueprint),\n      scopeData: componentScope\n    };\n  },\n\n  /**\n   *\n   * @param {{enter?: AnimationConfig, leave?:AnimationConfig}} animations\n   * @returns Blueprint\n   */\n  addTimeline: function (animations) {\n    return {\n      tag: 'comment',\n      text: 'timeline',\n      animations\n    };\n  },\n\n  /**\n   *\n   * @param {Blueprint|Blueprint[]} blueprint\n   * @return {Galaxy.ViewNode|Array<Galaxy.ViewNode>}\n   */\n  blueprint: function (blueprint) {\n    const _this = this;\n    return this.createNode(blueprint, _this.scope, _this.container, null);\n  },\n  /**\n   *\n   * @param {boolean} [hasAnimation]\n   */\n  clean: function (hasAnimation) {\n    this.container.clean(hasAnimation);\n  },\n  dispatchEvent: function (event) {\n    this.container.dispatchEvent(event);\n  },\n  /**\n   *\n   * @param {Object} blueprint\n   * @param {Object} scopeData\n   * @param {Galaxy.ViewNode} parent\n   * @param {Node|Element|null} position\n   * @return {Galaxy.ViewNode|Array<Galaxy.ViewNode>}\n   */\n  createNode: function (blueprint, scopeData, parent, position) {\n    const _this = this;\n    let i = 0, len = 0;\n    if (typeof blueprint === 'string') {\n      const content = document.createElement('div');\n      content.innerHTML = blueprint;\n      const nodes = Array.prototype.slice.call(content.childNodes);\n      nodes.forEach(function (node) {\n        // parent.node.appendChild(node);\n        const viewNode = new ViewNode({ tag: node }, parent, _this);\n        parent.registerChild(viewNode, position);\n        node.parentNode.removeChild(node);\n        set_property_for_node(viewNode, 'animations', {});\n        viewNode.setInDOM(true);\n      });\n\n      return nodes;\n    } else if (typeof blueprint === 'function') {\n      return blueprint.call(_this);\n    } else if (blueprint instanceof Array) {\n      const result = [];\n      for (i = 0, len = blueprint.length; i < len; i++) {\n        result.push(_this.createNode(blueprint[i], scopeData, parent, null));\n      }\n\n      return result;\n    } else if (blueprint instanceof Object) {\n      const component = _this.getComponent(blueprint.tag, blueprint, scopeData);\n      let propertyValue, propertyKey;\n      const _blueprint = component.blueprint;\n      const keys = obj_keys(_blueprint);\n      const needInitKeys = [];\n      const viewNode = new ViewNode(_blueprint, parent, _this, component.scopeData);\n      parent.registerChild(viewNode, position);\n\n      // Behaviors installation stage\n      for (i = 0, len = keys.length; i < len; i++) {\n        propertyKey = keys[i];\n        propertyValue = _blueprint[propertyKey];\n\n        const needValueAssign = install_property_for_node(viewNode, component.scopeData, propertyKey, propertyValue);\n        if (needValueAssign === false) {\n          continue;\n        }\n\n        needInitKeys.push(propertyKey);\n      }\n\n      // Value assignment stage\n      for (i = 0, len = needInitKeys.length; i < len; i++) {\n        propertyKey = needInitKeys[i];\n        if (propertyKey === 'children') continue;\n\n        propertyValue = _blueprint[propertyKey];\n        const bindings = get_bindings(propertyValue);\n        if (bindings.propertyKeys.length) {\n          make_binding(viewNode, propertyKey, null, component.scopeData, bindings, viewNode);\n        } else {\n          set_property_for_node(viewNode, propertyKey, propertyValue);\n        }\n      }\n\n      if (!viewNode.virtual) {\n        viewNode.setInDOM(true);\n        if (_blueprint.children) {\n          _this.createNode(_blueprint.children, component.scopeData, viewNode, null);\n        }\n      }\n\n      return viewNode;\n    } else {\n      throw Error('blueprint should NOT be null');\n    }\n  },\n\n  loadStyle(path) {\n    if (path.indexOf('./') === 0) {\n      path = path.replace('./', this.scope.uri.path);\n    }\n  }\n};\n\nexport default View;\n","import { EMPTY_CALL } from './utils.js';\nimport { create_in_next_frame, max_index } from './view.js';\n\nfunction prepare_route(routeConfig, parentScopeRouter, fullPath) {\n  if (routeConfig instanceof Array) {\n    const routes = routeConfig.map((r) => prepare_route(r, parentScopeRouter, fullPath));\n    if (parentScopeRouter) {\n      parentScopeRouter.activeRoute.children = routes;\n    }\n\n    return routes;\n  }\n\n  return {\n    ...routeConfig,\n    fullPath: fullPath + routeConfig.path,\n    active: false,\n    hidden: routeConfig.hidden || Boolean(routeConfig.redirectTo) || false,\n    viewports: routeConfig.viewports || {},\n    parent: parentScopeRouter ? parentScopeRouter.activeRoute : null,\n    children: routeConfig.children || []\n  };\n}\n\nfunction extract_dynamic_routes(routesPath) {\n  return routesPath.map(function (route) {\n    const paramsNames = [];\n\n    // Find all the parameters names in the route\n    let match = Router.PARAMETER_NAME_REGEX.exec(route);\n    while (match) {\n      paramsNames.push(match[1]);\n      match = Router.PARAMETER_NAME_REGEX.exec(route);\n    }\n\n    if (paramsNames.length) {\n      return {\n        id: route,\n        paramNames: paramsNames,\n        paramFinderExpression: new RegExp(route.replace(Router.PARAMETER_NAME_REGEX, Router.PARAMETER_NAME_REPLACEMENT))\n      };\n    }\n\n    return null;\n  }).filter(Boolean);\n}\n\nRouter.TITLE_SEPARATOR = '  ';\nRouter.PARAMETER_NAME_REGEX = new RegExp(/[:*](\\w+)/g);\nRouter.PARAMETER_NAME_REPLACEMENT = '([^/]+)';\nRouter.BASE_URL = '/';\nRouter.currentPath = {\n  handlers: [],\n  subscribe: function (handler) {\n    this.handlers.push(handler);\n    handler(location.pathname);\n  },\n  update: function () {\n    this.handlers.forEach((h) => {\n      h(location.pathname);\n    });\n  }\n};\n\nRouter.mainListener = function (e) {\n  Router.currentPath.update();\n};\n\nwindow.addEventListener('popstate', Router.mainListener);\n\n/**\n *\n * @param {Galaxy.Scope} scope\n * @constructor\n * @memberOf Galaxy\n */\nfunction Router(scope) {\n  const _this = this;\n  _this.__singleton__ = true;\n  _this.config = {\n    baseURL: Router.BASE_URL\n  };\n\n  _this.scope = scope;\n  _this.routes = [];\n  // Find active parent router\n  _this.parentScope = scope.parentScope;\n  _this.parentRouter = scope.parentScope ? scope.parentScope.__router__ : null;\n\n  // ToDo: bug\n  // Find the next parent router if there is no direct parent router\n  if (_this.parentScope && (!_this.parentScope.router || !_this.parentScope.router.activeRoute)) {\n    let _parentScope = _this.parentScope;\n    while (!_parentScope.router || !_parentScope.router.activeRoute) {\n      _parentScope = _parentScope.parentScope;\n    }\n    // This line cause a bug\n    // _this.config.baseURL = _parentScope.router.activePath;\n    _this.parentScope = _parentScope;\n    _this.parentRouter = _parentScope.__router__;\n  }\n\n  const hasParentRouter = _this.parentScope && _this.parentScope.router;\n  _this.title = hasParentRouter ? this.parentScope.router.activeRoute.title : '';\n  _this.path = hasParentRouter ? _this.parentScope.router.activeRoute.path : '/';\n  _this.fullPath = this.config.baseURL === '/' ? this.path : this.config.baseURL + this.path;\n  _this.parentRoute = hasParentRouter ? this.parentScope.router.activeRoute : null;\n  _this.oldURL = '';\n  _this.resolvedRouteValue = null;\n  _this.resolvedDynamicRouteValue = null;\n  _this.routesMap = null;\n  _this.data = {\n    routes: [],\n    navs: [],\n    activeRoute: null,\n    activePath: null,\n    activeModule: null,\n    viewports: {\n      main: null,\n    },\n    parameters: _this.parentScope && _this.parentScope.router ? _this.parentScope.router.parameters : {}\n  };\n  _this.onTransitionFn = EMPTY_CALL;\n  _this.onInvokeFn = EMPTY_CALL;\n  _this.onLoadFn = EMPTY_CALL;\n  _this.viewports = {\n    main: {\n      tag: 'div',\n      module: '<>router.activeModule'\n    }\n  };\n\n  Object.defineProperty(this, 'urlParts', {\n    get: function () {\n      return _this.oldURL.split('/').slice(1);\n    },\n    enumerable: true\n  });\n\n  if (scope.systemId === '@root') {\n    Router.currentPath.update();\n  }\n}\n\nRouter.prototype = {\n  setup: function (routeConfigs) {\n    this.routes = prepare_route(routeConfigs, this.parentScope ? this.parentScope.router : null, this.fullPath === '/' ? '' : this.fullPath);\n    // if (this.parentScope && this.parentScope.router) {\n    //   this.parentRoute = this.parentScope.router.activeRoute;\n    // }\n\n    this.routes.forEach(route => {\n      const viewportNames = route.viewports ? Object.keys(route.viewports) : [];\n      viewportNames.forEach(vp => {\n        if (vp === 'main' || this.viewports[vp]) return;\n\n        this.viewports[vp] = {\n          tag: 'div',\n          module: '<>router.viewports.' + vp\n        };\n      });\n    });\n\n    this.data.routes = this.routes;\n    this.data.navs = this.routes.filter(r => !r.hidden);\n\n    return this;\n  },\n\n  start: function () {\n    this.listener = this.detect.bind(this);\n    window.addEventListener('popstate', this.listener);\n    this.detect();\n  },\n\n  setTitle(title) {\n    this.title = title;\n  },\n\n  getTitle(route) {\n    const titles = [];\n    if (route.pageTitle) {\n      return route.pageTitle;\n    }\n\n    if (this.parentRouter) {\n      // if parentRoute has a pageTitle, then that pageTitle will be the starting title\n      const parentPageTitle = this.parentRoute.pageTitle;\n      if (parentPageTitle) {\n        titles.push(parentPageTitle);\n        if (route.title) {\n          titles.push(route.title);\n        }\n\n        return titles.join(Router.TITLE_SEPARATOR);\n      }\n\n      titles.push(this.parentRouter.title);\n    }\n\n    if (this.title) {\n      titles.push(this.title);\n    }\n\n    if (route.title) {\n      titles.push(route.title);\n    }\n\n    return titles.join(Router.TITLE_SEPARATOR);\n  },\n\n  /**\n   *\n   * @param {string} path\n   * @param {boolean} replace\n   */\n  navigateToPath: function (path, replace) {\n    if (typeof path !== 'string') {\n      throw new Error('Invalid argument(s) for `navigateToPath`: path must be a string. ' + typeof path + ' is given');\n    }\n\n    if (path.indexOf('/') !== 0) {\n      throw new Error('Invalid argument(s) for `navigateToPath`: path must be starting with a `/`\\nPlease use `/' + path + '` instead of `' + path + '`');\n    }\n\n    if (path.indexOf(this.config.baseURL) !== 0) {\n      path = this.config.baseURL + path;\n    }\n\n    const currentPath = window.location.pathname;\n    if (currentPath === path /*&& this.resolvedRouteValue === path*/) {\n      return;\n    }\n\n    if (replace) {\n      history.replaceState({}, '', path);\n    } else {\n      history.pushState({}, '', path);\n    }\n\n    dispatchEvent(new PopStateEvent('popstate', { state: {} }));\n  },\n\n  navigate: function (path, replace) {\n    if (typeof path !== 'string') {\n      throw new Error('Invalid argument(s) for `navigate`: path must be a string. ' + typeof path + ' is given');\n    }\n\n    if (path.indexOf('/') !== 0) {\n      throw new Error('Invalid argument(s) for `navigate`: path must be starting with a `/`\\nPlease use `/' + path + '` instead of `' + path + '`');\n    }\n\n    if (path.indexOf(this.path) !== 0) {\n      path = this.path + path;\n    }\n\n    this.navigateToPath(path, replace);\n  },\n\n  navigateToRoute: function (route, replace) {\n    let path = route.path;\n    if (route.parent) {\n      path = route.parent.path + route.path;\n    }\n\n    this.navigate(path, replace);\n  },\n\n  notFound: function () {\n\n  },\n\n  normalizeHash: function (hash) {\n    if (hash.indexOf('#!/') === 0) {\n      throw new Error('Please use `#/` instead of `#!/` for you hash');\n    }\n\n    let normalizedHash = hash;\n    if (hash.indexOf('#/') !== 0) {\n      if (hash.indexOf('/') !== 0) {\n        normalizedHash = '/' + hash;\n      } else if (hash.indexOf('#') === 0) {\n        normalizedHash = hash.split('#').join('#/');\n      }\n    }\n\n    // if (this.config.baseURL !== '/') {\n    //   normalizedHash = normalizedHash.replace(this.config.baseURL, '');\n    // }\n    return normalizedHash.replace(this.fullPath, '/').replace('//', '/') || '/';\n  },\n\n  onTransition: function (handler) {\n    this.onTransitionFn = handler;\n    return this;\n  },\n\n  onInvoke: function (handler) {\n    this.onInvokeFn = handler;\n    return this;\n  },\n\n  onLoad: function (handler) {\n    this.onLoadFn = handler;\n    return this;\n  },\n\n  findMatchRoute: function (routes, hash, parentParams) {\n    const _this = this;\n    let matchCount = 0;\n    const normalizedHash = _this.normalizeHash(hash);\n    const routesPath = routes.map(item => item.path);\n    const dynamicRoutes = extract_dynamic_routes(routesPath);\n    const staticRoutes = routes.filter(r => dynamicRoutes.indexOf(r) === -1 && normalizedHash.indexOf(r.path) === 0);\n    const targetStaticRoute = staticRoutes.length ? staticRoutes.reduce((a, b) => a.path.length > b.path.length ? a : b) : false;\n\n    if (targetStaticRoute && !(normalizedHash !== '/' && targetStaticRoute.path === '/')) {\n      const routeValue = normalizedHash.slice(0, targetStaticRoute.path.length);\n\n      if (_this.resolvedRouteValue === routeValue) {\n        // static routes don't have parameters\n        return Object.assign(_this.data.parameters, _this.createClearParameters());\n      }\n\n      _this.resolvedDynamicRouteValue = null;\n      _this.resolvedRouteValue = routeValue;\n\n      if (targetStaticRoute.redirectTo) {\n        return this.navigate(targetStaticRoute.redirectTo, true);\n      }\n\n      matchCount++;\n      return _this.callRoute(targetStaticRoute, normalizedHash, _this.createClearParameters(), parentParams);\n    }\n\n    for (let i = 0, len = dynamicRoutes.length; i < len; i++) {\n      const targetDynamicRoute = dynamicRoutes[i];\n      const match = targetDynamicRoute.paramFinderExpression.exec(normalizedHash);\n\n      if (!match) {\n        continue;\n      }\n\n      matchCount++;\n      const params = _this.createParamValueMap(targetDynamicRoute.paramNames, match.slice(1));\n\n      if (_this.resolvedDynamicRouteValue === hash) {\n        return Object.assign(_this.data.parameters, params);\n      }\n\n      _this.resolvedDynamicRouteValue = hash;\n      _this.resolvedRouteValue = null;\n      const routeIndex = routesPath.indexOf(targetDynamicRoute.id);\n      const pathParameterPlaceholder = targetDynamicRoute.id.split('/').filter(t => t.indexOf(':') !== 0).join('/');\n      const parts = hash.replace(pathParameterPlaceholder, '').split('/');\n      return _this.callRoute(routes[routeIndex], parts.join('/'), params, parentParams);\n    }\n\n    if (matchCount === 0) {\n      console.warn('No associated route has been found', hash);\n    }\n  },\n\n  callRoute: function (newRoute, hash, params, parentParams) {\n    const oldRoute = this.data.activeRoute;\n    const oldPath = this.data.activePath;\n    this.data.activeRoute = newRoute;\n    this.data.activePath = newRoute.path;\n\n    this.onTransitionFn.call(this, oldPath, newRoute.path, oldRoute, newRoute);\n    if (!newRoute.redirectTo) {\n      // if current route's path starts with the old route's path, then the old route should stay active\n      if (oldRoute && newRoute.path.indexOf(oldPath) !== 0) {\n        oldRoute.active = false;\n\n        if (typeof oldRoute.onLeave === 'function') {\n          oldRoute.onLeave.call(null, oldPath, newRoute.path, oldRoute, newRoute);\n        }\n      }\n\n      newRoute.active = true;\n    }\n\n    if (typeof newRoute.onEnter === 'function') {\n      newRoute.onEnter.call(null, oldPath, newRoute.path, oldRoute, newRoute);\n    }\n\n    document.title = this.getTitle(newRoute);\n    if (typeof newRoute.handle === 'function') {\n      return newRoute.handle.call(this, params, parentParams);\n    } else {\n      this.populateViewports(newRoute);\n\n      create_in_next_frame(max_index(), (_next) => {\n        Object.assign(this.data.parameters, params);\n        _next();\n      });\n    }\n\n    return false;\n  },\n\n  populateViewports: function (route) {\n    let viewportFound = false;\n    const allViewports = this.data.viewports;\n    for (const key in allViewports) {\n      let value = route.viewports[key];\n      if (value === undefined) {\n        continue;\n      }\n\n      if (typeof value === 'string') {\n        value = {\n          path: value,\n          onInvoke: this.onInvokeFn.bind(this, value, key),\n          onLoad: this.onLoadFn.bind(this, value, key)\n        };\n        viewportFound = true;\n      }\n\n      if (key === 'main') {\n        this.data.activeModule = value;\n      }\n\n      this.data.viewports[key] = value;\n    }\n\n    if (!viewportFound && this.parentRouter) {\n      this.parentRouter.populateViewports(route);\n    }\n  },\n\n  createClearParameters: function () {\n    const clearParams = {};\n    const keys = Object.keys(this.data.parameters);\n    keys.forEach(k => clearParams[k] = undefined);\n    return clearParams;\n  },\n\n  createParamValueMap: function (names, values) {\n    const params = {};\n    names.forEach(function (name, i) {\n      params[name] = values[i];\n    });\n\n    return params;\n  },\n\n  detect: function () {\n    const pathname = window.location.pathname;\n    const hash = pathname ? pathname.substring(-1) !== '/' ? pathname + '/' : pathname : '/';\n    // const hash = pathname || '/';\n    const path = this.config.baseURL === '/' ? this.path : this.config.baseURL + this.path;\n\n    if (hash.indexOf(path) === 0) {\n      if (hash !== this.oldURL) {\n        this.oldURL = hash;\n        this.findMatchRoute(this.routes, hash, {});\n      }\n    }\n  },\n\n  getURLParts: function () {\n    return this.oldURL.split('/').slice(1);\n  },\n\n  destroy: function () {\n    if (this.parentRoute) {\n      this.parentRoute.children = [];\n    }\n    window.removeEventListener('popstate', this.listener);\n  }\n};\nexport default Router;\n","import Router from './router.js';\n\nexport function EMPTY_CALL() {}\n\nexport const def_prop = Object.defineProperty;\nexport const del_prop = Reflect.deleteProperty;\n\nexport const obj_keys = Object.keys;\nexport const arr_concat = Array.prototype.concat.bind([]);\n\nexport const arr_slice = Array.prototype.slice;\n\nexport function clone(obj) {\n  let cloned = obj instanceof Array ? [] : {};\n  cloned.__proto__ = obj.__proto__;\n  for (let i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      const v = obj[i];\n      // Some objects can not be cloned and must be passed by reference\n      if (v instanceof Promise || v instanceof Router) {\n        cloned[i] = v;\n      } else if (typeof (v) === 'object' && v !== null) {\n        if (i === 'animations' && v && typeof v === 'object') {\n          cloned[i] = v;\n        } else {\n          cloned[i] = clone(v);\n        }\n      } else {\n        cloned[i] = v;\n      }\n    }\n  }\n\n  return cloned;\n}\n\nconst COMMENT_NODE = document.createComment('');\n\nexport function create_comment(t) {\n  const n = COMMENT_NODE.cloneNode();\n  n.textContent = t;\n  return n;\n}\n/**\n *\n * @param {string} tagName\n * @param {Galaxy.ViewNode} parentViewNode\n * @returns {HTMLElement|Comment}\n */\nexport function create_elem(tagName, parentViewNode) {\n  if (tagName === 'svg' || (parentViewNode && parentViewNode.blueprint.tag === 'svg')) {\n    return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n  }\n\n  if (tagName === 'comment') {\n    return document.createComment('ViewNode');\n  }\n\n  return document.createElement(tagName);\n}\n","import { def_prop, del_prop } from './utils';\nimport GalaxyURI from './uri.js';\nimport Observer from './observer.js';\nimport { bind_subjects_to_data } from './view.js';\n\n/**\n *\n * @param {Galaxy} context\n * @param {Object} module\n * @param [element]\n * @constructor\n * @memberOf Galaxy\n */\nfunction Scope(context, module, element) {\n  const _this = this;\n  _this.context = context;\n  _this.systemId = module.systemId;\n  _this.parentScope = module.parentScope || null;\n  _this.element = element || null;\n  _this.export = {};\n\n  _this.uri = new GalaxyURI(module.path);\n  _this.eventHandlers = {};\n  _this.observers = [];\n  const _data = _this.element.data ? bind_subjects_to_data(_this.element, _this.element.data, _this.parentScope, true) : {};\n  def_prop(_this, 'data', {\n    enumerable: true,\n    configurable: true,\n    get: function () {\n      return _data;\n    },\n    set: function (value) {\n      if (value === null || typeof value !== 'object') {\n        throw Error('The `Scope.data` property must be type of object and can not be null.');\n      }\n\n      Object.assign(_data, value);\n    }\n  });\n\n  _this.on('module.destroy', this.destroy.bind(_this));\n}\n\nScope.prototype = {\n  data: null,\n  systemId: null,\n  parentScope: null,\n\n  importAsText: function (libId) {\n    // return this.import(libId + '#text');\n    if (libId.indexOf('./') === 0) {\n      libId = libId.replace('./', this.uri.path);\n    }\n\n    return fetch(libId, {\n      headers: {\n        'Content-Type': 'text/plain'\n      }\n    }).then(response => {\n      return response.text();\n    });\n  },\n  /**\n   *\n   */\n  destroy: function () {\n    del_prop(this, 'data');\n    this.observers.forEach(function (observer) {\n      observer.remove();\n    });\n  },\n\n  kill: function () {\n    throw Error('Scope.kill() should not be invoked at the runtime');\n  },\n  /**\n   *\n   * @param {Galaxy.ModuleMetaData} moduleMeta\n   * @param {*} config\n   * @returns {*}\n   */\n  load: function (moduleMeta, config) {\n    const newModuleMetaData = Object.assign({}, moduleMeta, config || {});\n\n    if (newModuleMetaData.path.indexOf('./') === 0) {\n      newModuleMetaData.path = this.uri.path + moduleMeta.path.substr(2);\n    }\n\n    newModuleMetaData.parentScope = this;\n    return this.context.load(newModuleMetaData);\n  },\n  /**\n   *\n   * @param moduleMetaData\n   * @param viewNode\n   * @returns {*|PromiseLike<T>|Promise<T>}\n   */\n  loadModuleInto: function (moduleMetaData, viewNode) {\n    return this.load(moduleMetaData, {\n      element: viewNode\n    }).then(function (module) {\n      module.start();\n      return module;\n    });\n  },\n  /**\n   *\n   * @param {string} event\n   * @param {Function} handler\n   */\n  on: function (event, handler) {\n    if (!this.eventHandlers[event]) {\n      this.eventHandlers[event] = [];\n    }\n\n    if (this.eventHandlers[event].indexOf(handler) === -1) {\n      this.eventHandlers[event].push(handler);\n    }\n  },\n  /**\n   *\n   * @param {string} event\n   * @param {*} data\n   */\n  trigger: function (event, data) {\n    if (this.eventHandlers[event]) {\n      this.eventHandlers[event].forEach(function (handler) {\n        handler.call(null, data);\n      });\n    }\n  },\n  /**\n   *\n   * @param object\n   * @returns {Galaxy.Observer}\n   */\n  observe: function (object) {\n    const observer = new Observer(object);\n    this.observers.push(observer);\n\n    return observer;\n  }\n};\n\nexport default Scope;\n","/**\n *\n * @param {object} module\n * @param {Galaxy.Scope} scope\n * @constructor\n * @memberOf Galaxy\n */\nfunction Module(module, scope) {\n  this.id = module.id;\n  this.systemId = module.systemId;\n  this.source = typeof module.source === 'function' ? module.source : null;\n  this.path = module.path || null;\n  this.importId = module.importId || module.path;\n  // this.addOns = module.addOns || {};\n  // this.addOnProviders = {};\n  this.scope = scope;\n  // this.native = native || false;\n}\n\nModule.prototype = {\n  init: function () {\n    // const providers = this.addOnProviders;\n    Reflect.deleteProperty(this, 'source');\n    Reflect.deleteProperty(this, 'addOnProviders');\n\n    // for (let addOnName in this.addOns) {\n    //   providers[addOnName].startInstance(this.addOns[addOnName], this);\n    // }\n\n    this.scope.trigger('module.init');\n  },\n\n  start: function () {\n    this.scope.trigger('module.start');\n  },\n\n  destroy: function () {\n    this.scope.trigger('module.destroy');\n  },\n};\n\nexport default Module;\n","import Scope from './scope.js';\nimport Module from './module.js';\nimport View from './view.js';\nimport Router from './router.js';\n\nexport function convertToURIString(obj, prefix) {\n  let str = [], p;\n  for (p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      let k = prefix ? prefix + '[' + p + ']' : p, v = obj[p];\n      str.push((v !== null && typeof v === 'object') ? convertToURIString(v, k) : encodeURIComponent(k) + '=' +\n        encodeURIComponent(v));\n    }\n  }\n\n  return str.join('&');\n}\n\n/**\n *\n * @param {Galaxy} galaxy\n * @param {Galaxy.ModuleMetaData} moduleMetaData\n * @returns {Galaxy.Module}\n */\nexport function createModule(galaxy, moduleMetaData) {\n  const scope = new Scope(galaxy, moduleMetaData, moduleMetaData.element || this.rootElement);\n  return new Module(moduleMetaData, scope);\n}\n\n/**\n *\n * @param {Galaxy.Module}  module\n * @return {Promise<any>}\n */\nexport function executeCompiledModule(module) {\n  return new Promise(async function (resolve, reject) {\n    try {\n      const source = module.source || (await import(/* @vite-ignore */'/' + module.path)).default;\n\n      let moduleSource = source;\n      if (typeof source !== 'function') {\n        moduleSource = function () {\n          console.error('Can\\'t find default function in %c' + module.path, 'font-weight: bold;');\n        };\n      }\n\n      const output = moduleSource.call(null, module.scope) || null;\n      const proceed = () => {\n        module.init();\n        return resolve(module);\n      };\n\n      // if the function is not async, output would be undefined\n      if (output) {\n        output.then(proceed);\n      } else {\n        proceed();\n      }\n    } catch (error) {\n      console.error(error.message + ': ' + module.path);\n      // console.warn('Search for es6 features in your code and remove them if your browser does not support them, e.g. arrow function');\n      console.trace(error);\n      reject();\n    }\n  });\n}\n\n\n/**\n *\n * @memberOf Galaxy.Scope\n * @returns {Galaxy.View}\n */\nScope.prototype.useView = function () {\n  return new View(this);\n}\n\n/**\n * @memberOf Galaxy.Scope\n * @returns {Galaxy.Router}\n */\nScope.prototype.useRouter = function () {\n  const router = new Router(this);\n  if (this.systemId !== '@root') {\n    this.on('module.destroy', () => router.destroy());\n  }\n\n  this.__router__ = router;\n  this.router = router.data;\n\n  return router;\n};\n","/**\n *\n * @typedef {Object} Galaxy.ModuleMetaData\n * @property {Function} [constructor]\n * @property {Function|string} [source]\n * @property {string} [id]\n * @property {string} [systemId]\n * @property {string} [path]\n * @property {Galaxy.Scope} [parentScope]\n * @property {Node} [element]\n */\n\nimport { createModule, executeCompiledModule } from './src/core.js';\nimport { setupTimeline } from './src/properties/animations.property.js';\n\nArray.prototype.unique = function () {\n  const a = this.concat();\n  for (let i = 0, lenI = a.length; i < lenI; ++i) {\n    for (let j = i + 1, lenJ = a.length; j < lenJ; ++j) {\n      if (a[i] === a[j]) {\n        a.splice(j--, 1);\n      }\n    }\n  }\n\n  return a;\n};\n\n/**\n * @namespace Galaxy\n */\nconst Galaxy = {\n  moduleContents: {},\n  addOnProviders: [],\n  rootElement: null,\n  bootModule: null,\n  /**\n   *\n   * @param {Object} out\n   * @returns {*|{}}\n   */\n  extend: function (out) {\n    let result = out || {}, obj;\n    for (let i = 1; i < arguments.length; i++) {\n      obj = arguments[i];\n\n      if (!obj) {\n        continue;\n      }\n\n      for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          if (obj[key] instanceof Array) {\n            result[key] = this.extend(result[key] || [], obj[key]);\n          } else if (typeof obj[key] === 'object' && obj[key] !== null) {\n            result[key] = this.extend(result[key] || {}, obj[key]);\n          } else {\n            result[key] = obj[key];\n          }\n        }\n      }\n    }\n\n    return result;\n  },\n\n  /**\n   *\n   * @param {Galaxy.ModuleMetaData} moduleMeta\n   * @return {Promise<any>}\n   */\n  load: function (moduleMeta) {\n    if (!moduleMeta) {\n      throw new Error('Module meta data or constructor is missing');\n    }\n\n    const _this = this;\n    return new Promise(function (resolve, reject) {\n      if (moduleMeta.hasOwnProperty('constructor') && typeof moduleMeta.constructor === 'function') {\n        moduleMeta.path = moduleMeta.id = 'internal/' + (new Date()).valueOf() + '-' + Math.round(performance.now());\n        moduleMeta.systemId = moduleMeta.parentScope ? moduleMeta.parentScope.systemId + '/' + moduleMeta.id : moduleMeta.id;\n        moduleMeta.source = moduleMeta.constructor;\n\n        return executeCompiledModule(createModule(_this, moduleMeta)).then(resolve);\n      }\n\n      moduleMeta.path = moduleMeta.path.indexOf('/') === 0 ? moduleMeta.path.substring(1) : moduleMeta.path;\n      if (!moduleMeta.id) {\n        moduleMeta.id = '@' + moduleMeta.path;\n      }\n      moduleMeta.systemId = moduleMeta.parentScope ? moduleMeta.parentScope.systemId + '/' + moduleMeta.id : moduleMeta.id;\n\n      let url = moduleMeta.path /*+ '?' + _this.convertToURIString(module.params || {})*/;\n      // contentFetcher makes sure that any module gets loaded from network only once\n      let contentFetcher = _this.moduleContents[url];\n      if (!contentFetcher) {\n        _this.moduleContents[url] = contentFetcher = fetch(url).then((response) => {\n          if (!response.ok) {\n            console.error(response.statusText, url);\n            return reject(response.statusText);\n          }\n\n          return response;\n        }).catch(reject);\n      }\n\n      contentFetcher = contentFetcher.then(response => {\n        return response.clone().text();\n      });\n\n      contentFetcher.then(text => {\n        return executeCompiledModule(createModule(_this, moduleMeta));\n      }).then(resolve).catch(reject);\n    });\n  },\n};\n\n/**\n *\n * @param {Galaxy.ModuleMetaData} bootModule\n * @return {Promise<any>}\n */\nfunction boot(bootModule) {\n  Galaxy.rootElement = bootModule.element;\n\n  bootModule.id = '@root';\n\n  if (!Galaxy.rootElement) {\n    throw new Error('element property is mandatory');\n  }\n\n  return new Promise(function (resolve, reject) {\n    Galaxy.load(bootModule).then(function (module) {\n      // Replace galaxy temporary bootModule with user specified bootModule\n      Galaxy.bootModule = module;\n      resolve(module);\n    }).catch(function (error) {\n      console.error('Something went wrong', error);\n      reject();\n    });\n  });\n}\n\nexport {\n  boot,\n  setupTimeline\n};\n\n"],"names":["NODE_BLUEPRINT_PROPERTY_MAP","VALID_TAG_NAMES","Observer","obj","key","value","observers","observer","context","__observers__","def_prop","index","_this","action","subject","apply_node_dataset","node","stringifyValue","val","data_property","scope","config","bind_subjects_to_data","expression","text_3_property","text_8_property","text_property","viewNode","textValue","nativeNode","textNode","tn","animations_property","setupTimeline","animationDescriptions","onComplete","props","style","keys","i","len","has_parent_enter_animation","parent","clear_tweens","tweens","t","process_enter_animation","animationConfig","_node","document_body","AnimationMeta","process_leave_animation","finalize","leave_with_parent","withParentResult","rect","process_class_animation","viewNodeCache","tweenKey","addOrRemove","className","create_in_next_frame","destroy_in_next_frame","_next","tweenExist","get_class_based_animation_config","animations","type","animationKey","name","EMPTY_CALL","p","exist","labels","TIMELINE_SETUP_MAP","enter","leave","classes","oldHash","newHash","from","to","userDefinedOnComplete","tween","stepDescription","step","description","descriptions","newConfig","timelineName","animationMeta","parentTimeline","pauseTween","removeAwait","_pause","children","label","newLabel","position","tChildren","firstChild","checked_property","scopeReactiveData","prop","id","get_bindings","data","nativeValue","class_property","reactiveClasses","gsapExist","k","applyClasses","getClasses","newClasses","currentClasses","disabled_property","attr","input","set_attr","if_property","GalaxyURI","url","urlParser","match","module_property","cache","newModuleMeta","clean_content","module_loader","vn","moduleMeta","tempURI","moduleScope","currentScope","Scope","module","response","on_property","events","handler","event","lastId","ArrayChange","instance","repeat_property","bindings","make_binding","path","rd","property_rd_lookup","error","setter","get_property_setter_for_node","changes","initialChanges","output","processChanges","prepareChanges","hasAnimation","trackByKey","newTrackMap","item","hasBeenRemoved","newChanges","destroy_nodes","nodesToBeRemoved","parentNode","positions","placeholders","nodeScopeData","trackMap","as","indexAs","nodes","templateBlueprint","defaultPosition","newItems","onEachAction","d","changeParams","removedItems","startingIndex","lastItem","firstItem","view","newItemsCopy","newItemCopy","createNode","createItemDataScope","itemData","itemDataScope","create_child_scope","cns","clone","selected_property","style_3_property","style_8_property","style_property","reactiveStyle","setStyle","_value","v","IGNORE_TYPES","value_config_property","value_property","createHandler","createNumberHandler","_rd","_id","visible_property","REFERENCE_TO_THIS","this","__NODE__","insert_before","newNode","referenceNode","remove_child","child","remove_self","destroy","ViewNode","blueprints","r","res","blueprint","nodeData","create_elem","create_comment","done","original","targetGarbage","selectors","blueprintClone","flag","defaultProcessLeaveAnimation","childNode","localScope","propertyKey","reactiveData","activate_property_for_node","cn","arr_slice","act","prevNode","prop_setter","property","propName","updateFn","set_prop","create_prop_setter","expressionValue","asyncCall","asyncValue","result","attr_setter","attrName","create_attr_setter","reactive_setter","propertyName","create_reactive_setter","nodeUpdateFn","ARRAY_PROTO","ARRAY_MUTATOR_METHODS","KEYS_TO_REMOVE_FOR_ARRAY","obj_keys","scope_builder","get_keys","create_array_value","arr","method","originalMethod","__rd__","args","returnValue","_original","_length","ReactiveData","SYNC_NODE","sameObjectValue","fromChild","NodeMap","nodeKey","bindType","refExist","reference","shadow","getter","thisRD","ref","refs","keyInParent","refParent","sameValueObject","map","_data","nextOwner","dataKey","initValue","isArray","desc","ARG_BINDING_SINGLE_QUOTE_RE","ARG_BINDING_DOUBLE_QUOTE_RE","FUNCTION_HEAD_RE","BINDING_RE","PROPERTY_NAME_SPLITTER_RE","REACTIVE_BEHAVIORS","PROPERTY_SETTERS","max_index","parse_bind_exp_string","clean","a","safe_property_lookup","properties","propertiesArr","target","temp","lastIndex","dom_manipulation_table","View","create_order","destroy_order","dom_manipulation_order","manipulation_done","dom_manipulations_dirty","diff","preTS","too_many_jumps","next_action","_jump","dirty","next_batch_body","batch","next_batch","now","ts","comp_asc","b","comp_desc","binary_search","array","_fn","start","end","middle","midVal","pos_asc","el","pos_desc","add_dom_manipulation","order","search","last_dom_manipulation_id","update_dom_manipulation_order","arr_concat","toBeRemoved","remove","propertyKeys","propertyValues","bindTypes","isExpression","valueType","expressionFunction","matches","argDef","property_lookup","firstKey","nestingLevel","absoluteKey","li","EXPRESSION_ARGS_FUNC_CACHE","create_args_provider_fn","functionContent","func","create_expression_fn","host","values","getExpressionArguments","ex","get_expression_fn","exception","targetKeyName","hostReactiveData","scopeData","root","expressionFn","propertyScopeData","childPropertyKeyPath","propertyKeyPathItems","newValue","subjects","cloneSubject","attributeName","attributeValue","subjectsClone","parentReactiveData","install_property_for_node","reactiveProperty","scopeProperty","blueprintProperty","set_property_for_node","bpKey","TimelineControl","timeline","comp","componentScope","componentBlueprint","content","component","propertyValue","_blueprint","needInitKeys","prepare_route","routeConfig","parentScopeRouter","fullPath","routes","extract_dynamic_routes","routesPath","route","paramsNames","Router","h","_parentScope","hasParentRouter","routeConfigs","vp","title","titles","parentPageTitle","replace","hash","normalizedHash","parentParams","matchCount","dynamicRoutes","staticRoutes","targetStaticRoute","routeValue","targetDynamicRoute","params","routeIndex","pathParameterPlaceholder","parts","newRoute","oldRoute","oldPath","viewportFound","allViewports","clearParams","names","pathname","del_prop","cloned","COMMENT_NODE","n","tagName","parentViewNode","element","libId","newModuleMetaData","moduleMetaData","object","Module","createModule","galaxy","executeCompiledModule","resolve","reject","source","moduleSource","proceed","router","lenI","j","lenJ","Galaxy","out","contentFetcher","text","boot","bootModule"],"mappings":"AAeO,MAAMA,IAA8B;AAAA,EACzC,KAAK;AAAA,IACH,MAAM;AAAA,EACP;AAAA,EACD,MAAM;AAAA,IACJ,MAAM;AAAA,EACP;AAAA,EACD,OAAO;AAAA,IACL,MAAM;AAAA,EACP;AAAA,EACD,UAAU;AAAA,IACR,MAAM;AAAA,EACP;AAAA,EACD,QAAQ;AAAA,IACN,MAAM;AAAA,IACN,KAAK;AAAA,EACN;AAAA,EACD,QAAQ;AAAA,IACN,MAAM;AAAA,IACN,KAAK;AAAA,EACN;AAAA,EACD,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,KAAK;AAAA,EACN;AAAA,EACD,UAAU;AAAA,IACR,MAAM;AAAA,EACP;AAAA,EACD,SAAS;AAAA,IACP,MAAM;AAAA,EACP;AAAA,EACD,YAAY;AAAA,IACV,MAAM;AAAA,EACP;AAAA,EACD,aAAa;AAAA,IACX,MAAM;AAAA,EACP;AAAA,EACD,YAAY;AAAA,IACV,MAAM;AAAA,EACP;AAAA,EACD,WAAW;AAAA,IACT,MAAM;AAAA,EACP;AAAA,EACD,YAAY;AAAA,IACV,MAAM;AAAA,EACP;AAAA,EACD,SAAS;AAAA,IACP,MAAM;AAAA,EACP;AAAA,EACD,aAAa;AAAA,IACX,MAAM;AAAA,EACP;AAAA,EACD,WAAW;AAAA,IACT,MAAM;AAAA,EACP;AAAA,EACD,QAAQ;AAAA,IACN,MAAM;AAAA,EACP;AAAA,EACD,SAAS;AAAA,IACP,MAAM;AAAA,EACP;AAAA,EACD,SAAS;AAAA,IACP,MAAM;AAAA,EACP;AAAA,EACD,SAAS;AAAA,IACP,MAAM;AAAA,EACP;AAAA,EACD,QAAQ;AAAA,IACN,MAAM;AAAA,EACP;AAAA,EACD,SAAS;AAAA,IACP,MAAM;AAAA,EACP;AAAA,EACD,UAAU;AAAA,IACR,MAAM;AAAA,EACP;AACH,GAGaC,KAAkB;AAAA,EAC7B;AAAA,EACA;AAAA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA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"}